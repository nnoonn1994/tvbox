<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TVBOX接口配置编辑器</title>
    <style>
        :root {
            --primary-color: #4a6baf;
            --secondary-color: #5a8dee;
            --accent-color: #ff7043;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --light-color: #f5f7fa;
            --dark-color: #263238;
            --text-color: #455a64;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            touch-action: manipulation;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 15px var(--shadow-color);
            overflow: hidden;
            padding: 25px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .warning {
            color: var(--danger-color);
            background-color: rgba(244, 67, 54, 0.1);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        
        /* 修改：回到底部按钮样式 - 改为白色半透明背景，箭头居中 */
        .scroll-to-bottom-btn {
            position: fixed;
            right: 30px;
            bottom: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8); /* 改为白色半透明背景 */
            border: 1px solid rgba(204, 204, 204, 0.5); /* 半透明灰色边框 */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            z-index: 999;
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            backdrop-filter: blur(5px); /* 毛玻璃效果 */
            -webkit-backdrop-filter: blur(5px); /* Safari支持 */
        }
        
        .scroll-to-bottom-btn.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .scroll-to-bottom-btn:hover {
            background-color: rgba(255, 255, 255, 0.9); /* 悬停时稍微增加不透明度 */
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .scroll-to-bottom-btn:active {
            transform: translateY(0);
        }
        
        .scroll-to-bottom-btn i {
            color: #333333; /* 深灰色箭头 */
            font-size: 20px;
            transition: transform 0.3s ease;
            /* 确保箭头居中 */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        .scroll-to-bottom-btn:hover i {
            transform: translateY(2px);
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 8px;
            background-color: var(--light-color);
            padding: 8px;
            border-radius: 6px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-color);
        }
        
        .tab-btn:hover {
            background-color: rgba(74, 107, 175, 0.1);
            color: var(--primary-color);
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(74, 107, 175, 0.3);
        }
        
        .instruction {
            color: var(--text-color);
            background-color: rgba(90, 141, 238, 0.1);
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 15px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .config-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .config-section.active {
            display: block;
        }
        
        /* 快速匹配信息样式 */
        .quick-match-container {
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .quick-match-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .quick-match-header:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }
        
        .quick-match-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
        }
        
        .quick-match-header .icon {
            transition: transform 0.3s ease;
            font-size: 14px;
            color: white;
        }
        
        .quick-match-header.expanded .icon {
            transform: rotate(180deg);
        }
        
        .quick-match-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background-color: var(--light-color);
        }
        
        .quick-match-content.expanded {
            padding: 15px;
            max-height: 500px;
        }
        
        .quick-match-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 12px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        .quick-match-textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        .quick-match-buttons {
            display: flex;
            gap: 10px;
        }
        
        .quick-match-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
        }
        
        .quick-match-btn:hover {
            background-color: #43a047;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .quick-match-clear-btn {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .quick-match-clear-btn:hover {
            background-color: #f57c00;
            box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
        }
        
        /* 点播源导航栏样式 - 修复布局问题 */
        .vod-navigation {
            margin-top: 20px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            position: relative;
        }
        
        .vod-navigation h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
        }
        
        .vod-navigation h4 i {
            margin-right: 8px;
            font-size: 18px;
        }
        
        /* 修改：清除配置按钮移动到标题后面 */
        .vod-nav-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .vod-nav-title {
            color: var(--primary-color);
            font-size: 16px;
            display: flex;
            align-items: center;
            font-weight: 600;
            gap: 8px;
        }
        
        .vod-nav-title i {
            font-size: 18px;
        }
        
        /* 修改：清除配置按钮新样式 - 电视图标后面 */
        .clear-config-btn-small {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 12px;
            white-space: nowrap;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-left: 8px;
        }
        
        .clear-config-btn-small:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(244, 67, 54, 0.3);
        }
        
        /* 新增：编辑按钮样式 */
        .edit-nav-btn-small {
            background-color: var(--info-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 12px;
            white-space: nowrap;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-left: 8px;
        }
        
        .edit-nav-btn-small:hover {
            background-color: #1976d2;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
        }
        
        /* 新增：编辑模式下的取消编辑按钮 */
        .cancel-edit-nav-btn-small {
            background-color: var(--warning-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 12px;
            white-space: nowrap;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-left: 8px;
        }
        
        .cancel-edit-nav-btn-small:hover {
            background-color: #f57c00;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
        }
        
        .vod-nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
        }
        
        .vod-nav-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            user-select: none;
            position: relative;
            text-align: center;
            min-height: 36px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .vod-nav-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        .vod-nav-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .vod-nav-btn.dragging {
            opacity: 0.5;
            border: 2px dashed var(--primary-color);
            z-index: 10;
            transform: none !important;
        }
        
        .vod-nav-btn.drag-over {
            border: 2px solid var(--primary-color);
            background-color: rgba(74, 107, 175, 0.1);
        }
        
        /* 新增：编辑模式下的导航按钮样式 */
        .vod-nav-btn.edit-mode {
            position: relative;
            padding-right: 30px;
        }
        
        /* 新增：删除按钮样式 */
        .vod-nav-delete-btn {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 0;
            line-height: 1;
        }
        
        .vod-nav-delete-btn:hover {
            background-color: #d32f2f;
            transform: translateY(-50%) scale(1.1);
        }
        
        /* 新增：点播源选择按钮样式 */
        .vod-select-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            user-select: none;
            position: relative;
            text-align: center;
            min-height: 36px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .vod-select-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        .vod-select-btn.selected {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        /* 原清除配置按钮样式（保留但不使用） */
        .clear-config-btn {
            background-color: var(--danger-color) !important;
            color: white !important;
            margin-top: 10px;
            width: 100%;
        }
        
        .clear-config-btn:hover {
            background-color: #d32f2f !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3) !important;
        }
        
        /* 确认对话框样式 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .confirm-dialog.hidden {
            display: none;
        }
        
        .confirm-content {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease;
        }
        
        .confirm-content h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .confirm-content p {
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 10px 25px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
            font-size: 15px;
        }
        
        .confirm-yes {
            background-color: var(--danger-color);
            color: white;
        }
        
        .confirm-yes:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }
        
        .confirm-no {
            background-color: var(--primary-color);
            color: white;
        }
        
        .confirm-no:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* 加解密工具样式 */
        .crypto-wrapper {
            display: flex;
            gap: 20px;
            align-items: stretch;
        }
        
        .crypto-textarea-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .crypto-textarea-group textarea {
            flex: 1;
            min-height: 200px;
            font-family: monospace;
        }
        
        .crypto-control-group {
            width: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .crypto-form-control {
            margin-bottom: 15px;
        }
        
        .crypto-form-control label {
            display: none; /* 隐藏标签文字 */
        }
        
        .crypto-form-control input[type="text"] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        
        .crypto-btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .crypto-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
        }
        
        .crypto-btn-encrypt {
            background-color: var(--success-color);
            color: white;
        }
        
        .crypto-btn-decrypt {
            background-color: var(--info-color);
            color: white;
        }
        
        .crypto-btn-copy {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .crypto-btn-clear {
            background-color: var(--danger-color);
            color: white;
        }
        
        .crypto-btn-upload {
            background-color: var(--primary-color) !important;
            color: white !important;
        }
        
        .crypto-btn-process {
            background-color: var(--success-color);
            color: white;
        }
        
        /* 自定义一键配置样式 */
        .custom-batch-config {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: 8px;
            border-left: 4px solid var(--warning-color);
        }
        
        .custom-batch-config h4 {
            color: var(--warning-color);
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
        }
        
        .custom-batch-config h4 i {
            margin-right: 8px;
            font-size: 18px;
        }
        
        .custom-batch-fields {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .custom-batch-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .custom-batch-field label {
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .custom-batch-field input {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        .custom-batch-field input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        .custom-batch-btn {
            background-color: var(--warning-color);
            color: var(--dark-color);
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
            width: 100%;
        }
        
        .custom-batch-btn:hover {
            background-color: #f57c00;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(255, 152, 0, 0.3);
        }
        
        /* 新增：点播源选择区域样式 */
        .vod-selection-area {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: 8px;
            border-left: 4px solid var(--success-color);
            display: none;
        }
        
        .vod-selection-area h4 {
            color: var(--success-color);
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .vod-selection-area h4 i {
            margin-right: 8px;
            font-size: 18px;
        }
        
        .vod-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .selection-buttons {
            display: flex;
            gap: 10px;
        }
        
        .selection-controls {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .hidden {
            display: none !important;
        }
        
        /* 其他原有样式保持不变 */
        .config-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 20px;
        }
        
        .config-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .config-label {
            min-width: 120px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            flex: 1;
            min-width: 250px;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        textarea {
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            line-height: 1.5;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .button-edit {
            background-color: var(--info-color);
        }
        
        .button-cancel {
            background-color: var(--danger-color);
        }
        
        .button-success {
            background-color: var(--success-color);
        }
        
        .button-warning {
            background-color: var(--warning-color);
        }
        
        .source-list {
            margin-top: 25px;
            width: 100%;
        }
        
        /* 修改：点播源项目样式 - 移除手柄图标，添加位置控制按钮 */
        .source-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
            position: relative;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .source-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .source-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        /* 新增：位置控制按钮容器 */
        .position-controls {
            position: absolute;
            top: -12px;
            left: 15px;
            display: flex;
            gap: 5px;
            z-index: 5;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 2px;
            border: 1px solid var(--border-color);
        }
        
        /* 新增：位置控制按钮样式 */
        .position-btn {
            background-color: #2c3e50; /* 深蓝色 */
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 500;
            font-size: 11px;
            padding: 3px 6px;
            min-width: 36px;
            height: 22px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .position-btn:hover {
            background-color: #34495e;
            transform: translateY(-1px);
            box-shadow: 0 1px 3px rgba(44, 62, 80, 0.3);
        }
        
        .position-btn:active {
            transform: translateY(0);
        }
        
        /* 禁用状态的按钮 */
        .position-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* 移除原有的拖动手柄样式 */
        .drag-handle {
            display: none;
        }
        
        .source-item h4 {
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 16px;
            margin-top: 5px; /* 为位置控制按钮留出空间 */
        }
        
        .source-item p {
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .source-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .category-config {
            margin-top: 20px;
            width: 100%;
        }
        
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .category-tag {
            background-color: rgba(90, 141, 238, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 13px;
            color: var(--primary-color);
        }
        
        .category-tag button {
            margin-left: 8px;
            padding: 2px 6px;
            background-color: var(--danger-color);
            font-size: 12px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            min-width: auto;
        }
        
        .url-list {
            margin-top: 15px;
            width: 100%;
        }
        
        .url-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .url-item input {
            flex: 1;
        }
        
        .url-item button {
            padding: 8px 12px;
            min-width: auto;
        }
        
        .json-output {
            margin-top: 30px;
            width: 100%;
        }
        
        .json-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .json-header h3 {
            color: var(--primary-color);
            font-size: 18px;
        }
        
        #config-json {
            width: 100%;
            height: 200px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            /* 移除默认隐藏，改为通过class控制 */
        }
        
        .json-toggle-btn {
            margin-left: 10px;
            background-color: var(--primary-color) !important; /* 确保颜色与复制按钮一致 */
        }
        
        .channel-item,
        .parse-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
        }
        
        .channel-item.dragging,
        .parse-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .channel-item p,
        .parse-item p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .channel-item-actions,
        .parse-item-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 8px;
        }
        
        .ijk-option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .ijk-option-item select,
        .ijk-option-item input {
            flex: 1;
            min-width: 200px;
        }
        
        .ijk-option-item button {
            padding: 8px 12px;
            min-width: auto;
        }

        /* 新增自定义字段样式 */
        .custom-fields-container {
            margin-top: 15px;
            width: 100%;
        }

        .custom-field-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .custom-field-item input[type="text"] {
            flex: 1;
            min-width: 200px;
        }

        .custom-field-item button {
            padding: 8px 12px;
            min-width: auto;
        }

        .add-custom-field-btn {
            margin-top: 10px;
        }
        
        /* 自定义分类输入框样式 */
        .custom-category-input {
            flex: 1;
            min-width: 200px;
        }
        
        /* 修改点播源列表位置 */
        .vod-items-container {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        /* 上传文件按钮样式 */
        .upload-json-btn {
            background-color: var(--info-color) !important;
        }
        
        .upload-json-input {
            display: none;
        }
        
        /* 新增英文标签样式 */
        .english-label {
            color: #999;
            font-size: 12px;
            margin-left: 8px;
            font-weight: normal;
        }
        
        /* 文本编辑器样式 */
        .text-editor-container {
            background-color: white;
            padding: 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            height: 700px;
            display: flex;
            flex-direction: column;
        }
        
        /* 顶部栏样式 */
        .text-editor-header {
            height: 50px;
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 0 50px;
            flex-shrink: 0;
        }

        .text-editor-back-btn {
            position: absolute;
            left: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: transparent;
            font-size: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
        }

        .text-editor-back-btn:hover {
            background-color: var(--item-hover);
        }

        .text-editor-header-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* 菜单按钮样式 */
        .text-editor-menu-btn {
            position: absolute;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: transparent;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
        }

        .text-editor-menu-btn:hover {
            background-color: var(--item-hover);
        }

        /* 菜单弹窗样式 - 修改：移除选择选项，只保留导入和新建文件 */
        .text-editor-menu-popup {
            position: absolute;
            top: 55px;
            right: 20px;
            width: 200px;
            background-color: var(--modal-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px var(--shadow-color);
            overflow: hidden;
            display: none;
            z-index: 1000;
            border: 1px solid var(--border-color);
        }

        .text-editor-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            color: var(--text-color);
        }

        .text-editor-menu-item:hover {
            background-color: var(--item-hover);
        }

        .text-editor-menu-item i {
            margin-right: 8px;
            font-size: 16px;
        }

        /* 文件列表容器 */
        .text-editor-file-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            position: relative;
            -webkit-overflow-scrolling: touch;
            flex-shrink: 1;
        }

        /* 文件项样式 */
        .text-editor-file-list-wrapper {
            padding: 16px;
        }

        .text-editor-file-item-wrapper {
            position: relative;
            width: 100%;
            height: 60px;
            margin-bottom: 8px;
            overflow: hidden;
            border-radius: 8px;
        }

        /* 修改：文件项样式 - 带透明背景框 */
        .text-editor-file-item {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8); /* 半透明背景 */
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
            z-index: 2;
            touch-action: pan-y;
            border: 1px solid rgba(0, 0, 0, 0.1); /* 轻微边框 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* 轻微阴影 */
        }

        .text-editor-file-info {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
        }

        .text-editor-file-icon {
            font-size: 20px;
            margin-right: 12px;
            color: var(--primary-color);
            flex-shrink: 0;
        }

        .text-editor-file-name {
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
            padding-right: 8px;
        }

        /* 修改：文件操作按钮样式 - 增加间距 */
        .text-editor-file-actions {
            display: flex;
            align-items: center;
            gap: 10px; /* 增加间距：从6px改为10px */
            margin-left: auto;
            flex-shrink: 0;
        }

        /* 修改：文件操作按钮 - 更小的图标，无背景 */
        .text-editor-file-action-btn {
            width: 20px;
            height: 20px;
            border: none;
            background-color: transparent;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--text-color);
            opacity: 0.6;
            transition: opacity 0.3s ease, color 0.3s ease;
            padding: 0;
            margin: 0;
        }

        /* 分享按钮 - 橙色 */
        .text-editor-file-share-btn {
            color: var(--warning-color);
        }

        .text-editor-file-share-btn:hover {
            opacity: 1;
            color: var(--warning-color);
        }

        /* 重命名按钮 - 蓝色 */
        .text-editor-file-rename-btn {
            color: var(--info-color);
        }

        .text-editor-file-rename-btn:hover {
            opacity: 1;
            color: var(--info-color);
        }

        /* 删除按钮 - 红色 */
        .text-editor-file-delete-btn {
            color: var(--danger-color);
        }

        .text-editor-file-delete-btn:hover {
            opacity: 1;
            color: var(--danger-color);
        }

        /* 已移除选择模式相关样式 */
        .text-editor-select-mode-header {
            display: none !important;
        }

        .text-editor-select-btn, .text-editor-complete-btn {
            display: none !important;
        }

        .text-editor-file-item.selectable {
            padding-left: 16px !important;
        }

        .text-editor-file-checkbox {
            display: none !important;
        }

        .text-editor-delete-bar {
            display: none !important;
        }

        .text-editor-delete-all-btn {
            display: none !important;
        }

        /* 文本编辑器样式 */
        .text-editor-editor-container {
            flex: 1;
            display: none;
            flex-direction: column;
            position: relative;
        }

        .text-editor-editor-header {
            height: 50px;
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            flex-shrink: 0;
        }

        /* 编辑器返回按钮样式 */
        .text-editor-editor-back-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: transparent;
            font-size: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            margin-right: 10px;
            flex-shrink: 0;
        }

        .text-editor-editor-back-btn:hover {
            background-color: var(--item-hover);
        }

        .text-editor-editor-title-container {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
            justify-content: center;
            margin: 0 60px;
        }

        .text-editor-editor-title {
            font-size: 16px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
        }

        .text-editor-save-btn {
            padding: 6px 16px;
            border-radius: 20px;
            border: none;
            background-color: var(--primary-color);
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .text-editor-editor-tools {
            height: 40px;
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .text-editor-char-count {
            font-size: 13px;
            color: #86868b;
        }

        .text-editor-search-btn {
            padding: 4px 10px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            background-color: transparent;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: var(--text-color);
        }

        .text-editor-search-btn i {
            margin-right: 6px;
            font-size: 14px;
        }

        /* 编辑器内容 */
        .text-editor-editor-content {
            flex: 1;
            padding: 20px;
            background-color: var(--item-bg);
            border: none;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
            outline: none;
            color: var(--text-color);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            tab-size: 4;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            overflow-y: auto;
            min-height: 0;
            flex-shrink: 1;
        }

        /* 弹窗通用样式 */
        .text-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .text-editor-modal-content {
            background-color: var(--modal-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            border: 1px solid var(--border-color);
        }

        .text-editor-modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-color);
        }

        .text-editor-modal-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 16px;
            margin-bottom: 20px;
            background-color: var(--item-bg);
            color: var(--text-color);
        }

        .text-editor-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .text-editor-cancel-btn, .text-editor-confirm-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            font-size: 14px;
            cursor: pointer;
        }

        .text-editor-cancel-btn {
            background-color: var(--item-hover);
            color: var(--text-color);
        }

        .text-editor-confirm-btn {
            background-color: var(--primary-color);
            color: #fff;
        }

        /* 查找弹窗样式 - 修复查找框布局 */
        .text-editor-search-modal-content {
            background-color: var(--modal-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 16px;
            border: 1px solid var(--border-color);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1);
            transform-origin: center;
            z-index: 999;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .text-editor-search-input-container {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            align-items: center;
        }

        .text-editor-search-input {
            flex: 1;
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 14px;
            background-color: var(--item-bg);
            color: var(--text-color);
            min-width: 0; /* 修复：允许缩小 */
        }

        /* 修改：查找结果字体颜色为黑色，提高可读性 */
        .text-editor-search-result {
            font-size: 13px;
            color: #000000; /* 改为黑色 */
            margin-bottom: 12px;
            font-weight: 500;
        }

        .text-editor-search-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .text-editor-search-nav-btn {
            flex: 1;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--item-bg);
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            text-align: center;
        }

        .text-editor-search-nav-btn:hover {
            background-color: var(--item-hover);
        }

        /* 查找弹窗搜索按钮样式 */
        .text-editor-search-confirm-btn {
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            background-color: var(--primary-color);
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .config-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .config-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            input[type="text"],
            input[type="number"],
            select,
            textarea {
                width: 100%;
                min-width: 100%;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
            
            .json-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .ijk-option-item select,
            .ijk-option-item input {
                width: 100%;
                min-width: 100%;
            }
            
            /* 响应式加解密工具样式 */
            .crypto-wrapper {
                flex-direction: column;
            }
            
            .crypto-control-group {
                width: 100%;
                order: -1;
                margin-bottom: 15px;
            }

            /* 响应式自定义字段样式 */
            .custom-field-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .custom-field-item input[type="text"] {
                width: 100%;
                min-width: 100%;
            }
            
            /* 响应式自定义分类样式 */
            .custom-category-input {
                width: 100%;
                min-width: 100%;
            }
            
            /* 响应式英文标签样式 */
            .english-label {
                margin-left: 5px;
                font-size: 11px;
            }
            
            /* 响应式点播源导航样式 - 保持三排布局 */
            .vod-nav-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .vod-nav-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            /* 响应式快速匹配按钮样式 */
            .quick-match-buttons {
                flex-direction: column;
            }
            
            /* 响应式确认对话框按钮 */
            .confirm-buttons {
                flex-direction: column;
            }
            
            .confirm-btn {
                width: 100%;
            }
            
            /* 响应式自定义一键配置样式 */
            .custom-batch-fields {
                gap: 10px;
            }
            
            .custom-batch-field {
                flex-direction: column;
            }
            
            /* 响应式点播源选择区域 */
            .vod-selection-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .selection-buttons {
                width: 100%;
                justify-content: flex-start;
            }
            
            /* 响应式点播源导航标题 */
            .vod-nav-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .clear-config-btn-small {
                font-size: 11px;
                padding: 3px 8px;
                height: 24px;
            }
            
            /* 新增：响应式编辑按钮 */
            .edit-nav-btn-small, .cancel-edit-nav-btn-small {
                font-size: 11px;
                padding: 3px 8px;
                height: 24px;
            }
            
            /* 响应式文本编辑器样式 */
            .text-editor-header {
                padding: 0 20px;
            }
            
            .text-editor-back-btn {
                left: 10px;
            }
            
            .text-editor-menu-btn {
                right: 10px;
            }
            
            .text-editor-editor-title-container {
                margin: 0 40px;
            }
            
            /* 响应式文件操作按钮 - 增加间距 */
            .text-editor-file-actions {
                gap: 8px; /* 在手机上保持适当间距 */
            }
            
            .text-editor-file-action-btn {
                width: 18px;
                height: 18px;
                font-size: 12px;
            }
            
            /* 响应式回到底部按钮 */
            .scroll-to-bottom-btn {
                right: 20px;
                bottom: 20px;
                width: 44px;
                height: 44px;
            }
            
            .scroll-to-bottom-btn i {
                font-size: 18px;
            }
        }
        
        @media (max-width: 480px) {
            /* 在超小屏幕上保持三排布局 */
            .vod-nav-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .vod-nav-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .vod-select-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            /* 超小屏幕上的清除按钮 */
            .clear-config-btn-small {
                font-size: 10px;
                padding: 2px 6px;
                height: 22px;
            }
            
            /* 新增：超小屏幕上的编辑按钮 */
            .edit-nav-btn-small, .cancel-edit-nav-btn-small {
                font-size: 10px;
                padding: 2px 6px;
                height: 22px;
            }
            
            .text-editor-header-title {
                font-size: 16px;
            }
            
            .text-editor-editor-title {
                font-size: 15px;
            }
            
            /* 超小屏幕上的查找框布局 */
            .text-editor-search-input-container {
                flex-wrap: wrap;
            }
            
            .text-editor-search-input {
                min-width: 100%;
            }
            
            .text-editor-search-confirm-btn {
                width: 100%;
                margin-top: 8px;
            }
            
            /* 超小屏幕上的文件操作按钮 - 保持间距 */
            .text-editor-file-actions {
                gap: 6px; /* 在超小屏幕上保持适当间距 */
            }
            
            .text-editor-file-action-btn {
                width: 16px;
                height: 16px;
                font-size: 11px;
            }
            
            /* 超小屏幕上的回到底部按钮 */
            .scroll-to-bottom-btn {
                right: 15px;
                bottom: 15px;
                width: 40px;
                height: 40px;
            }
            
            .scroll-to-bottom-btn i {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- 确认对话框 -->
    <div class="confirm-dialog hidden" id="confirm-dialog">
        <div class="confirm-content">
            <h3>确认清除配置</h3>
            <p>您确定要清除所有配置吗？此操作不可撤销，所有已添加的点播源、直播源、解析地址等配置都将被清空。</p>
            <div class="confirm-buttons">
                <button class="confirm-btn confirm-yes" id="confirm-yes">是</button>
                <button class="confirm-btn confirm-no" id="confirm-no">否</button>
            </div>
        </div>
    </div>
    
    <!-- 修改：回到底部按钮 - 白色半透明背景，深灰色箭头居中 -->
    <div class="scroll-to-bottom-btn" id="scrollToBottomBtn">
        <i class="fas fa-chevron-down"></i>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>TVBOX接口配置编辑器</h1>
            <div class="warning">返回或者关闭浏览器将会丢失记录，谨慎操作！</div>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="vod">点播源</button>
            <button class="tab-btn" data-tab="live">直播源</button>
            <button class="tab-btn" data-tab="parse">解析地址</button>
            <button class="tab-btn" data-tab="vip">VIP解析标识</button>
            <button class="tab-btn" data-tab="ijk">IJK解码配置</button>
            <button class="tab-btn" data-tab="ad">解析广告过滤</button>
            <button class="tab-btn" data-tab="wallpaper">全局自定义字段/壁纸</button>
            <button class="tab-btn" data-tab="custom-batch">自定义一键配置</button>
            <button class="tab-btn" data-tab="crypto">加解密工具</button>
            <button class="tab-btn" data-tab="text-editor">文本编辑</button>
        </div>

        <div class="instruction">
            <i class="icon-info"></i> 配置好后点击"添加点播源"按钮，然后复制到剪贴板即可！
        </div>

        <!-- 修改后的点播源配置部分 -->
        <div class="config-section active" id="vod-config">
            <!-- 新增快速匹配信息功能 -->
            <div class="quick-match-container">
                <div class="quick-match-header" id="quick-match-header">
                    <h3>
                        <span class="icon">▼</span>
                        <span style="color: #fff;">快速匹配信息</span>
                    </h3>
                </div>
                <div class="quick-match-content" id="quick-match-content">
                    <textarea class="quick-match-textarea" id="quick-match-textarea" placeholder="请在此处粘贴点播源JSON配置，例如：
{
  &quot;key&quot;: &quot;example&quot;,
  &quot;name&quot;: &quot;示例源&quot;,
  &quot;type&quot;: 1,
  &quot;api&quot;: &quot;http://example.com/api&quot;,
  &quot;searchable&quot;: 1,
  &quot;quickSearch&quot;: 1,
  &quot;filterable&quot;: 1,
  &quot;jar&quot;: &quot;&quot;,
  &quot;ext&quot;: &quot;&quot;
}"></textarea>
                    <div class="quick-match-buttons">
                        <button class="quick-match-btn" id="quick-match-btn">
                            <span>确定</span>
                        </button>
                        <button class="quick-match-btn quick-match-clear-btn" id="quick-match-clear-btn">
                            <span>清除</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 原有点播源配置内容 -->
            <h3>点播源配置</h3>
            <div class="config-row">
                <div class="config-label">Spider:</div>
                <input type="text" id="global-spider" placeholder="自定义爬虫jar代码包(不需要留空即可)">
            </div>
            <div class="config-row">
                <div class="config-label">Key:</div>
                <input type="text" id="vod-key" placeholder="点播源key">
            </div>
            <div class="config-row">
                <div class="config-label">Name:</div>
                <input type="text" id="vod-name" placeholder="点播源名称">
            </div>
            <div class="config-row">
                <div class="config-label">Type:</div>
                <select id="vod-type">
                    <option value="0">0-xml</option>
                    <option value="1" selected>1-json</option>
                    <option value="2">2-爬虫源</option>
                    <option value="3">3-自定义爬虫</option>
                    <option value="4">4-服务器爬虫</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">API:</div>
                <input type="text" id="vod-api" placeholder="API地址">
            </div>
            <div class="config-row">
                <div class="config-label">JAR:</div>
                <input type="text" id="vod-jar" placeholder="自定义JAR包地址(不需要留空即可)">
            </div>
            <div class="config-row">
                <div class="config-label">可搜索:<span class="english-label">(searchable)</span></div>
                <select id="vod-searchable">
                    <option value="1" selected>1-可以</option>
                    <option value="0">0-不可以</option>
                    <option value="-1">不显示</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">可快速搜索:<span class="english-label">(quickSearch)</span></div>
                <select id="vod-quickSearch">
                    <option value="1" selected>1-可以</option>
                    <option value="0">0-不可以</option>
                    <option value="-1">不显示</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">可筛选:<span class="english-label">(filterable)</span></div>
                <select id="vod-filterable">
                    <option value="1" selected>1-可以</option>
                    <option value="0">0-不可以</option>
                    <option value="-1">不显示</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">Ext:</div>
                <input type="text" id="vod-ext" placeholder="扩展参数(可选)">
            </div>
            
            <!-- 新增自定义字段区域 -->
            <div class="config-row">
                <div class="config-label">自定义字段:</div>
                <div style="flex: 1;">
                    <div class="custom-fields-container" id="vod-custom-fields-container">
                        <!-- 自定义字段将在这里动态添加 -->
                    </div>
                    <button id="add-vod-custom-field-btn" class="button-success add-custom-field-btn">添加自定义字段</button>
                </div>
            </div>
            
            <div class="category-config">
                <h3>分类配置</h3>
                <p>按顺序展示所配置的分类，不配置则默认展示所有分类</p>
                <div class="config-row">
                    <div class="config-label">添加分类:</div>
                    <div style="flex: 1; display: flex; gap: 10px; flex-wrap: wrap;">
                        <select id="category-select">
                            <option value="电影片">电影片</option>
                            <option value="连续剧">连续剧</option>
                            <option value="综艺片">综艺片</option>
                            <option value="动漫片">动漫片</option>
                            <option value="动作片">动作片</option>
                            <option value="喜剧片">喜剧片</option>
                            <option value="爱情片">爱情片</option>
                            <option value="科幻片">科幻片</option>
                            <option value="恐怖片">恐怖片</option>
                            <option value="剧情片">剧情片</option>
                            <option value="战争片">战争片</option>
                            <option value="国产剧">国产剧</option>
                            <option value="香港剧">香港剧</option>
                            <option value="韩国剧">韩国剧</option>
                            <option value="欧美剧">欧美剧</option>
                            <option value="纪录片">纪录片</option>
                            <option value="日本剧">日本剧</option>
                            <option value="海外剧">海外剧</option>
                            <option value="泰国剧">泰国剧</option>
                            <option value="大陆综艺">大陆综艺</option>
                            <option value="港台综艺">港台综艺</option>
                            <option value="日韩综艺">日韩综艺</option>
                            <option value="欧美综艺">欧美综艺</option>
                            <option value="国产动漫">国产动漫</option>
                            <option value="日韩动漫">日韩动漫</option>
                            <option value="欧美动漫">欧美动漫</option>
                            <option value="港台动漫">港台动漫</option>
                            <option value="海外动漫">海外动漫</option>
                            <option value="伦理片">伦理片</option>
                            <option value="短剧">短剧</option>
                        </select>
                        <input type="text" id="custom-category" class="custom-category-input" placeholder="或输入自定义分类">
                        <button id="add-category-btn">添加</button>
                    </div>
                </div>
                <div class="category-list" id="categories-list"></div>
            </div>

            <!-- 移动到此处的按钮组 -->
            <div class="button-group">
                <button id="add-vod-btn" class="button-success">添加点播源</button>
                <button id="upload-json-btn" class="upload-json-btn">上传JSON/TXT</button>
                <input type="file" id="upload-json-input" class="upload-json-input" accept=".json,.txt">
                <button id="update-vod-btn" class="button-edit" style="display:none;">更新点播源</button>
                <button id="cancel-edit-btn" class="button-cancel" style="display:none;">取消编辑</button>
            </div>

            <!-- 修改：点播源导航栏标题位置调整，去掉电视图标 -->
            <div class="vod-navigation" id="vod-navigation" style="display: none;">
                <div class="vod-nav-header">
                    <div class="vod-nav-title">
                        <!-- 修改：点播源导航标签替换电视图标 -->
                        <span>
点播源导航</span>
                        <button id="clear-config-btn-small" class="clear-config-btn-small">清除所有配置</button>
                        <!-- 新增：编辑按钮 -->
                        <button id="edit-nav-btn-small" class="edit-nav-btn-small">编辑</button>
                        <!-- 新增：取消编辑按钮（默认隐藏） -->
                        <button id="cancel-edit-nav-btn-small" class="cancel-edit-nav-btn-small" style="display: none;">取消编辑</button>
                    </div>
                </div>
                <div class="vod-nav-buttons" id="vod-nav-buttons">
                    <!-- 点播源导航按钮将在这里动态生成 -->
                </div>
            </div>

            <!-- 点播源列表容器 -->
            <div class="vod-items-container" id="vod-items"></div>

            <!-- 移动到此处的JSON输出部分 -->
            <div class="json-output">
                <div class="json-header">
                    <h3>生成的配置JSON</h3>
                    <div>
                        <button id="copy-btn" class="button-success">复制到剪贴板</button>
                        <button id="toggle-json-btn" class="button-success json-toggle-btn">显示JSON</button>
                    </div>
                </div>
                <textarea id="config-json" class="hidden" readonly></textarea>
            </div>
        </div>

        <!-- 修改后的直播源配置部分 -->
        <div class="config-section" id="live-config">
            <h3>直播源配置</h3>
            <!-- 修改：去掉组名栏，重新排序 -->
            <div class="config-row">
                <div class="config-label">频道名称:</div>
                <input type="text" id="live-channel-name" placeholder="name">
            </div>
            <div class="config-row">
                <div class="config-label">Type:</div>
                <select id="live-type">
                    <option value="0" selected>0-普通</option>
                    <option value="1">1-json</option>
                    <option value="2">2-多json</option>
                    <option value="3">3-m3u8</option>
                    <option value="4">4-rtmp</option>
                    <option value="5">5-flv</option>
                    <option value="6">6-其他格式</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">直播源Url:</div>
                <div style="flex: 1;">
                    <div class="url-list" id="live-urls-list">
                        <div class="url-item">
                            <input type="text" class="live-url" placeholder="直播源Url">
                            <button class="remove-url button-cancel">删除</button>
                        </div>
                    </div>
                    <button id="add-url-btn" class="button-success" style="margin-top: 10px;">添加Url</button>
                </div>
            </div>
            
            <!-- 新增：直播源自定义字段区域 -->
            <div class="config-row">
                <div class="config-label">自定义字段:</div>
                <div style="flex: 1;">
                    <div class="custom-fields-container" id="live-custom-fields-container">
                        <!-- 自定义字段将在这里动态添加 -->
                    </div>
                    <button id="add-live-custom-field-btn" class="button-success add-custom-field-btn">添加自定义字段</button>
                </div>
            </div>
            
            <div class="button-group">
                <button id="add-live-channel-btn" class="button-success">添加频道</button>
                <button id="update-live-channel-btn" class="button-edit" style="display:none;">更新频道</button>
                <button id="cancel-live-edit-btn" class="button-cancel" style="display:none;">取消编辑</button>
            </div>
            <div id="live-channels-list"></div>
        </div>

        <!-- 修改后的解析地址配置部分 -->
        <div class="config-section" id="parse-config">
            <h3>解析地址配置</h3>
            <div class="config-row">
                <div class="config-label">解析名称:</div>
                <input type="text" id="parse-name" placeholder="name">
            </div>
            <div class="config-row">
                <div class="config-label">解析类型:</div>
                <select id="parse-type">
                    <option value="0" selected>Type-0 (普通)</option>
                    <option value="1">Type-1 (json)</option>
                    <option value="2">Type-2 (多json)</option>
                    <option value="3">Type-3 (聚合)</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">解析URL:</div>
                <input type="text" id="parse-url" placeholder="解析URL">
            </div>
            <div class="config-row">
                <div class="config-label">Ext:</div>
                <input type="text" id="parse-ext" placeholder="扩展参数(可选)">
            </div>
            
            <!-- 新增：解析地址自定义字段区域 -->
            <div class="config-row">
                <div class="config-label">自定义字段:</div>
                <div style="flex: 1;">
                    <div class="custom-fields-container" id="parse-custom-fields-container">
                        <!-- 自定义字段将在这里动态添加 -->
                    </div>
                    <button id="add-parse-custom-field-btn" class="button-success add-custom-field-btn">添加自定义字段</button>
                </div>
            </div>
            
            <div class="button-group">
                <button id="add-parse-btn" class="button-success">添加解析</button>
                <button id="update-parse-btn" class="button-edit" style="display:none;">更新解析</button>
                <button id="cancel-parse-edit-btn" class="button-cancel" style="display:none;">取消编辑</button>
            </div>
            <div id="parse-list"></div>
        </div>

        <div class="config-section" id="vip-config">
            <!-- 原有VIP解析标识配置内容 -->
            <h3>VIP解析标识</h3>
            <div class="config-row">
                <div class="config-label">VIP标识:</div>
                <textarea id="vip-flags" placeholder="多个标识用逗号分隔">youku,qq,iqiyi,qiyi,letv,sohu,tudou,pptv,mgtv,wasu</textarea>
            </div>
        </div>

        <div class="config-section" id="ijk-config">
            <!-- 原有IJK解码配置内容 -->
            <h3>IJK解码配置</h3>
            <div class="config-row">
                <div class="config-label">解码组:</div>
                <select id="ijk-group">
                    <option value="soft">软解码</option>
                    <option value="hard">硬解码</option>
                </select>
            </div>
            
            <div class="config-row">
                <div class="config-label">添加解码选项:</div>
                <div style="flex: 1;">
                    <div id="ijk-new-options">
                        <div class="ijk-option-item">
                            <select class="ijk-category">
                                <option value="1">1-OPT_CATEGORY_FORMAT</option>
                                <option value="2">2-OPT_CATEGORY_CODEC</option>
                                <option value="3">3-OPT_CATEGORY_SWS</option>
                                <option value="4" selected>4-OPT_CATEGORY_PLAYER</option>
                            </select>
                            <input type="text" class="ijk-name" placeholder="属性名称" list="ijk-names">
                            <input type="text" class="ijk-value" placeholder="属性值">
                            <button class="add-ijk-option button-success">添加</button>
                            <button class="update-ijk-option button-edit" style="display:none;">更新</button>
                            <button class="cancel-ijk-edit button-cancel" style="display:none;">取消</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <datalist id="ijk-names">
                <option value="opensles">
                <option value="overlay-format">
                <option value="framedrop">
                <option value="soundtouch">
                <option value="start-on-prepared">
                <option value="http-detect-range-support">
                <option value="fflags">
                <option value="skip_loop_filter">
                <option value="reconnect">
                <option value="max-buffer-size">
                <option value="enable-accurate-seek">
                <option value="mediacodec">
                <option value="mediacodec-auto-rotate">
                <option value="mediacodec-handle-resolution-change">
                <option value="mediacodec-hevc">
            </datalist>
            
            <div class="config-row">
                <div class="config-label">当前解码选项:</div>
                <textarea id="ijk-options" placeholder="每行一个配置项，格式:category|name|value"></textarea>
            </div>
            
            <div id="ijk-options-list"></div>
        </div>

        <div class="config-section" id="ad-config">
            <!-- 原有解析广告过滤配置内容 -->
            <h3>解析广告过滤</h3>
            <div class="config-row">
                <div class="config-label">广告域名:</div>
                <textarea id="ad-domains" placeholder="每行一个广告域名">mimg.0c1q0l.cn
www.googletagmanager.com
www.google-analytics.com
mc.usihnbcq.cn
mg.g1mm3d.cn
mscs.svaeuzh.cn
cnzz.hhttm.top
tp.vinuxhome.com
cnzz.mmstat.com
www.baihuillq.com
s23.cnzz.com
z3.cnzz.com
c.cnzz.com
stj.v1vo.top
z12.cnzz.com
img.mosflower.cn
tips.gamevvip.com
ehwe.yhdtns.com
xdn.cqqc3.com
www.jixunkyy.cn
sp.chemacid.cn
hm.baidu.com
s9.cnzz.com
z6.cnzz.com
um.cavuc.com
mav.mavuz.com
wofwk.aoidf3.com
z5.cnzz.com
xc.hubeijieshikj.cn
tj.tianwenhu.com
xg.gars57.cn
k.jinxiuzhilv.com
cdn.bootcss.com
ppl.xunzhuo123.com
xomk.jiangjunmh.top
img.xunzhuo123.com
z1.cnzz.com
s13.cnzz.com
xg.huataisangao.cn
z7.cnzz.com
xg.huataisangao.cn
z2.cnzz.com
s96.cnzz.com
q11.cnzz.com
thy.dacedsfa.cn
xg.whsbpw.cn
s19.cnzz.com
z8.cnzz.com
s4.cnzz.com
f5w.as12df.top
ae01.alicdn.com
www.92424.cn
k.wudejia.com
vivovip.mmszxc.top
qiu.xixiqiu.com
cdnjs.hnfenxun.com
cms.qdwght.com</textarea>
            </div>
        </div>

        <!-- 修改：壁纸配置部分，添加全局自定义字段 -->
        <div class="config-section" id="wallpaper-config">
            <h3>壁纸配置</h3>
            <div class="config-row">
                <div class="config-label">壁纸URL:</div>
                <input type="text" id="wallpaper-url" placeholder="壁纸URL">
            </div>
            
            <!-- 新增：全局自定义字段区域 -->
            <div class="config-row">
                <div class="config-label">全局自定义字段:</div>
                <div style="flex: 1;">
                    <div class="custom-fields-container" id="global-custom-fields-container">
                        <!-- 全局自定义字段将在这里动态添加 -->
                    </div>
                    <button id="add-global-custom-field-btn" class="button-success add-custom-field-btn">添加全局字段</button>
                </div>
            </div>
        </div>

        <!-- 新增自定义一键配置部分 -->
        <div class="config-section" id="custom-batch-config">
            <h3>自定义一键配置</h3>
            <div class="custom-batch-config">
                <h4><i>⚙️</i> 自定义字段批量配置</h4>
                <div class="custom-batch-fields">
                    <div class="custom-batch-field">
                        <label for="custom-batch-field-name">字段名称 (如: jar):</label>
                        <input type="text" id="custom-batch-field-name" placeholder="输入字段名称，如: jar">
                    </div>
                    <div class="custom-batch-field">
                        <label for="custom-batch-field-value">字段值 (如: jar链接):</label>
                        <input type="text" id="custom-batch-field-value" placeholder="输入字段值，如: http://example.com/example.jar">
                    </div>
                </div>
                <button id="custom-batch-btn" class="custom-batch-btn">
                    <span>一键配置到所有点播源</span>
                </button>
                <button id="custom-batch-selected-btn" class="button-success" style="margin-top: 10px; width: 100%; display: none;">
                    <span>一键配置到选中点播源</span>
                </button>
                <p style="margin-top: 10px; font-size: 13px; color: var(--text-color);">
                    提示：点击"一键配置"按钮，会将上方配置的字段和值同步到所有点播源中。
                </p>
            </div>
            
            <!-- 新增点播源选择区域 -->
            <div class="vod-selection-area" id="vod-selection-area">
                <div class="vod-selection-header">
                    <h4><i>📋</i> 选择要配置的点播源 (可多选)</h4>
                    <div class="selection-buttons">
                        <button id="select-all-btn" class="button-success" style="font-size: 13px; padding: 6px 12px;">全选</button>
                        <button id="deselect-all-btn" class="button-cancel" style="font-size: 13px; padding: 6px 12px;">取消全选</button>
                    </div>
                </div>
                <div class="vod-nav-buttons" id="vod-selection-buttons">
                    <!-- 点播源选择按钮将在这里动态生成 -->
                </div>
                <div class="selection-controls">
                    <button id="confirm-selection-btn" class="button-success" style="width: 100%;">确认选择</button>
                </div>
            </div>
        </div>

        <!-- 修改后的加解密工具部分 -->
        <div class="config-section" id="crypto-config">
            <h3>TVBOX接口加解密工具</h3>
            <div class="crypto-wrapper">
                <!-- 左侧输入框 -->
                <div class="crypto-textarea-group">
                    <textarea id="crypto-input" placeholder="请输入要加密/解密的文本"></textarea>
                </div>
                
                <!-- 中间控制面板 -->
                <div class="crypto-control-group">
                    <div class="crypto-form-control">
                        <label for="crypto-operation">操作类型</label>
                        <select id="crypto-operation">
                            <option value="encrypt">加密</option>
                            <option value="decrypt">解密</option>
                        </select>
                    </div>
                    
                    <div class="crypto-form-control">
                        <label for="crypto-key">KEY/密码</label>
                        <input type="text" id="crypto-key" value="123456" maxlength="16" readonly>
                    </div>
                    
                    <div class="crypto-form-control">
                        <label for="crypto-iv">IV/向量</label>
                        <input type="text" id="crypto-iv" value="" maxlength="13" readonly>
                    </div>
                    
                    <div class="crypto-btn-group">
                        <button class="crypto-btn crypto-btn-upload" id="crypto-upload-btn">
                            上传文件
                        </button>
                        <button class="crypto-btn crypto-btn-process" id="crypto-process-btn">处理</button>
                    </div>
                    
                    <input type="file" id="crypto-file-input" style="display: none;">
                    
                    <div class="crypto-btn-group">
                        <button class="crypto-btn crypto-btn-copy" id="crypto-copy-btn">复制</button>
                        <button class="crypto-btn crypto-btn-clear" id="crypto-clear-btn">清除</button>
                    </div>
                </div>
                
                <!-- 右侧结果框 -->
                <div class="crypto-textarea-group">
                    <textarea id="crypto-output" placeholder="处理结果将显示在这里" readonly></textarea>
                </div>
            </div>
        </div>

        <!-- 新增文本编辑器部分 -->
        <div class="config-section" id="text-editor-config">
            <h3>文本编辑器</h3>
            <div class="text-editor-container" id="textEditorContainer">
                <!-- 已移除选择模式顶部栏 -->

                <!-- 顶部栏 -->
                <div class="text-editor-header">
                    <button class="text-editor-back-btn" id="textEditorBackBtn">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="text-editor-header-title" id="textEditorPageTitle">文件列表</div>
                    <button class="text-editor-menu-btn" id="textEditorMenuBtn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <!-- 修改：菜单弹窗移除选择选项，只保留导入和新建文件 -->
                    <div class="text-editor-menu-popup" id="textEditorMenuPopup">
                        <div class="text-editor-menu-item" id="textEditorImportItem">
                            <i class="fas fa-upload"></i> 导入
                        </div>
                        <div class="text-editor-menu-item" id="textEditorNewFileItem">
                            <i class="fas fa-file"></i> 新建文件
                        </div>
                    </div>
                </div>

                <!-- 文件列表容器 -->
                <div class="text-editor-file-list-container" id="textEditorFileListContainer">
                    <div class="text-editor-file-list-wrapper" id="textEditorFileListWrapper">
                        <!-- 文件项将通过JS动态生成 -->
                    </div>
                </div>

                <!-- 文本编辑器容器 -->
                <div class="text-editor-editor-container" id="textEditorEditorContainer">
                    <div class="text-editor-editor-header">
                        <button class="text-editor-editor-back-btn" id="textEditorEditorBackBtn">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="text-editor-editor-title-container">
                            <div class="text-editor-editor-title" id="textEditorFileName">未命名文件</div>
                        </div>
                        <button class="text-editor-save-btn" id="textEditorSaveBtn">保存</button>
                    </div>
                    <div class="text-editor-editor-tools">
                        <div class="text-editor-char-count" id="textEditorCharCount">字数: 0</div>
                        <button class="text-editor-search-btn" id="textEditorSearchBtn">
                            <i class="fas fa-search"></i> 查找
                        </button>
                    </div>
                    <textarea class="text-editor-editor-content" id="textEditorContent" placeholder="请输入文本内容..." spellcheck="false"></textarea>
                </div>

                <!-- 已移除删除底部栏 -->

                <!-- 新建文件弹窗 -->
                <div class="text-editor-modal" id="textEditorNewFileModal">
                    <div class="text-editor-modal-content">
                        <div class="text-editor-modal-title">新建文件</div>
                        <input type="text" class="text-editor-modal-input" id="textEditorNewFileName" placeholder="请输入文件名（可包含扩展名）">
                        <div class="text-editor-modal-buttons">
                            <button class="text-editor-cancel-btn" id="textEditorCancelNewFileBtn">取消</button>
                            <button class="text-editor-confirm-btn" id="textEditorConfirmNewFileBtn">确认</button>
                        </div>
                    </div>
                </div>

                <!-- 重命名弹窗 -->
                <div class="text-editor-modal" id="textEditorRenameModal">
                    <div class="text-editor-modal-content">
                        <div class="text-editor-modal-title">重命名</div>
                        <input type="text" class="text-editor-modal-input" id="textEditorRenameFileName" placeholder="请输入新名称">
                        <div class="text-editor-modal-buttons">
                            <button class="text-editor-cancel-btn" id="textEditorCancelRenameBtn">取消</button>
                            <button class="text-editor-confirm-btn" id="textEditorConfirmRenameBtn">确认</button>
                        </div>
                    </div>
                </div>

                <!-- 查找弹窗 - 已修复布局 -->
                <div class="text-editor-modal" id="textEditorSearchModal">
                    <div class="text-editor-search-modal-content">
                        <div class="text-editor-search-input-container">
                            <input type="text" class="text-editor-search-input" id="textEditorSearchInput" placeholder="请输入查找内容">
                            <button class="text-editor-search-confirm-btn" id="textEditorSearchConfirmBtn">查找</button>
                        </div>
                        <!-- 修改：查找结果字体颜色为黑色 -->
                        <div class="text-editor-search-result" id="textEditorSearchResult">找到 0 个匹配项</div>
                        <div class="text-editor-search-nav">
                            <button class="text-editor-search-nav-btn" id="textEditorPrevSearchBtn">上一个</button>
                            <button class="text-editor-search-nav-btn" id="textEditorNextSearchBtn">下一个</button>
                        </div>
                        <div class="text-editor-modal-buttons">
                            <button class="text-editor-cancel-btn" id="textEditorCancelSearchBtn">关闭</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入图标库 -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ==================== 修改：回到底部按钮功能 ====================
            const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
            let isScrolling = false;
            let scrollTimeout;
            
            // 初始化按钮可见性
            function checkScrollPosition() {
                const scrollPosition = window.scrollY;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                // 如果已经接近底部（距离底部小于100像素），隐藏按钮
                if (documentHeight - (scrollPosition + windowHeight) < 100) {
                    scrollToBottomBtn.classList.remove('visible');
                } else {
                    scrollToBottomBtn.classList.add('visible');
                }
            }
            
            // 滚动到底部函数
            function scrollToBottom() {
                window.scrollTo({
                    top: document.documentElement.scrollHeight,
                    behavior: 'smooth'
                });
                
                // 滚动完成后短暂隐藏按钮
                setTimeout(() => {
                    scrollToBottomBtn.classList.remove('visible');
                }, 500);
            }
            
            // 添加事件监听
            scrollToBottomBtn.addEventListener('click', scrollToBottom);
            window.addEventListener('scroll', checkScrollPosition);
            window.addEventListener('resize', checkScrollPosition);
            
            // 初始化检查
            checkScrollPosition();
            
            // ==================== 新增：点播源导航编辑模式状态 ====================
            let isNavEditMode = false;
            
            // ==================== 新增：点播源导航编辑按钮功能 ====================
            const editNavBtnSmall = document.getElementById('edit-nav-btn-small');
            const cancelEditNavBtnSmall = document.getElementById('cancel-edit-nav-btn-small');
            
            // 编辑按钮点击事件
            editNavBtnSmall.addEventListener('click', function() {
                enterNavEditMode();
            });
            
            // 取消编辑按钮点击事件
            cancelEditNavBtnSmall.addEventListener('click', function() {
                exitNavEditMode();
            });
            
            // 进入导航编辑模式
            function enterNavEditMode() {
                isNavEditMode = true;
                
                // 切换按钮显示
                editNavBtnSmall.style.display = 'none';
                cancelEditNavBtnSmall.style.display = 'flex';
                
                // 为所有导航按钮添加删除按钮
                addDeleteButtonsToNav();
            }
            
            // 退出导航编辑模式
            function exitNavEditMode() {
                isNavEditMode = false;
                
                // 切换按钮显示
                editNavBtnSmall.style.display = 'flex';
                cancelEditNavBtnSmall.style.display = 'none';
                
                // 移除所有导航按钮的删除按钮
                removeDeleteButtonsFromNav();
            }
            
            // 为导航按钮添加删除按钮
            function addDeleteButtonsToNav() {
                const navButtons = document.querySelectorAll('.vod-nav-btn');
                navButtons.forEach((btn, index) => {
                    // 添加编辑模式类
                    btn.classList.add('edit-mode');
                    
                    // 检查是否已有删除按钮，如果没有则添加
                    if (!btn.querySelector('.vod-nav-delete-btn')) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'vod-nav-delete-btn';
                        deleteBtn.innerHTML = '×';
                        deleteBtn.dataset.index = btn.dataset.index;
                        
                        // 添加删除事件
                        deleteBtn.addEventListener('click', function(e) {
                            e.stopPropagation(); // 防止触发按钮点击事件
                            const indexToDelete = parseInt(this.dataset.index);
                            deleteVodByNavIndex(indexToDelete);
                        });
                        
                        btn.appendChild(deleteBtn);
                    }
                    
                    // 在编辑模式下禁用拖拽功能
                    btn.draggable = false;
                    btn.classList.remove('dragging');
                    btn.classList.remove('drag-over');
                });
            }
            
            // 移除导航按钮的删除按钮
            function removeDeleteButtonsFromNav() {
                const navButtons = document.querySelectorAll('.vod-nav-btn');
                navButtons.forEach(btn => {
                    // 移除编辑模式类
                    btn.classList.remove('edit-mode');
                    
                    // 移除删除按钮
                    const deleteBtn = btn.querySelector('.vod-nav-delete-btn');
                    if (deleteBtn) {
                        deleteBtn.remove();
                    }
                    
                    // 恢复拖拽功能
                    btn.draggable = true;
                });
                
                // 重新初始化拖拽功能
                initVodNavigationDrag();
            }
            
            // 通过导航索引删除点播源
            function deleteVodByNavIndex(index) {
                if (index >= 0 && index < config.sites.length) {
                    // 从配置中删除
                    config.sites.splice(index, 1);
                    
                    // 更新UI
                    updateConfigJson();
                    loadVodItems();
                    updateVodNavigation();
                    updateVodSelectionButtons();
                    
                    // 如果删除后还有项目，保持在编辑模式
                    if (config.sites.length > 0) {
                        // 重新添加删除按钮（因为按钮已经重新生成）
                        setTimeout(() => {
                            if (isNavEditMode) {
                                addDeleteButtonsToNav();
                            }
                        }, 0);
                    } else {
                        // 如果没有项目了，退出编辑模式
                        exitNavEditMode();
                    }
                    
                    alert(`已删除点播源 #${index + 1}`);
                }
            }
            
            // ==================== 新增：增强的智能类型检测函数 ====================
            /**
             * 增强的智能类型检测函数，支持嵌套JSON对象
             * 输入：字符串值
             * 输出：{type: "string"/"number"/"boolean"/"json"/"object"/"array"/"null", value: 处理后的值}
             */
            function detectValueType(strValue) {
                if (strValue === undefined || strValue === null || strValue === '') {
                    return { type: 'string', value: '' };
                }
                
                const trimmed = strValue.trim();
                
                // 1. 尝试检测布尔值
                const lowerTrimmed = trimmed.toLowerCase();
                if (lowerTrimmed === 'true' || lowerTrimmed === 'false') {
                    return { type: 'boolean', value: lowerTrimmed === 'true' };
                }
                
                // 2. 尝试检测null
                if (lowerTrimmed === 'null') {
                    return { type: 'null', value: null };
                }
                
                // 3. 尝试检测JSON对象或数组（增强版，支持嵌套）
                if ((trimmed.startsWith('{') && trimmed.endsWith('}')) || 
                    (trimmed.startsWith('[') && trimmed.endsWith(']'))) {
                    try {
                        const parsed = JSON.parse(trimmed);
                        // 判断是对象还是数组
                        const type = Array.isArray(parsed) ? 'array' : 'object';
                        return { type: type, value: parsed };
                    } catch (e) {
                        // 如果JSON解析失败，继续尝试其他类型
                        console.log('JSON解析失败，继续尝试其他类型:', e.message);
                    }
                }
                
                // 4. 尝试检测数字（整数或小数）
                // 排除看起来像数字但包含多个点的情况
                const numMatch = trimmed.match(/^-?\d+(\.\d+)?$/);
                if (numMatch && !isNaN(parseFloat(trimmed)) && isFinite(trimmed)) {
                    const num = parseFloat(trimmed);
                    return { type: 'number', value: num };
                }
                
                // 5. 检查是否为整数（纯数字）
                const intMatch = trimmed.match(/^-?\d+$/);
                if (intMatch) {
                    const intNum = parseInt(trimmed, 10);
                    return { type: 'number', value: intNum };
                }
                
                // 6. 默认作为字符串处理
                return { type: 'string', value: trimmed };
            }
            
            /**
             * 将检测到的类型值转换为JSON输出
             * 输入：{type: "string"/"number"/"boolean"/"json"/"object"/"array"/"null", value: 值}
             * 输出：JSON字符串片段（不带引号或带引号）
             */
            function valueToJsonOutput(typeValue) {
                const { type, value } = typeValue;
                
                switch (type) {
                    case 'string':
                        return `"${escapeJsonString(value)}"`;
                    case 'number':
                        return value.toString();
                    case 'boolean':
                        return value.toString();
                    case 'null':
                        return 'null';
                    case 'object':
                    case 'array':
                    case 'json':
                        try {
                            return JSON.stringify(value, null, 2);
                        } catch (e) {
                            // 如果序列化失败，作为字符串处理
                            console.error('对象序列化失败:', e);
                            return `"${escapeJsonString(String(value))}"`;
                        }
                    default:
                        return `"${escapeJsonString(String(value))}"`;
                }
            }

            // ==================== 新增：全局自定义字段功能 ====================
            // DOM元素
            const globalCustomFieldsContainer = document.getElementById('global-custom-fields-container');
            const addGlobalCustomFieldBtn = document.getElementById('add-global-custom-field-btn');
            
            // 存储全局自定义字段
            let globalCustomFields = {};
            
            // 创建全局自定义字段元素
            function createGlobalCustomFieldElement(fieldId, fieldName = '', fieldValue = '') {
                const fieldItem = document.createElement('div');
                fieldItem.className = 'custom-field-item';
                fieldItem.dataset.id = fieldId;
                
                // 检测初始值的类型，添加类型提示
                const typeInfo = detectValueType(fieldValue);
                let typeHint = '';
                if (typeInfo.type !== 'string') {
                    typeHint = `<span class="type-hint" style="font-size: 11px; color: #666; margin-left: 5px;">(${typeInfo.type})</span>`;
                }
                
                fieldItem.innerHTML = `
                    <input type="text" class="custom-field-name" placeholder="字段名" value="${fieldName}">
                    <div style="flex: 1; display: flex; align-items: center;">
                        <input type="text" class="custom-field-value" placeholder="字段值" value="${fieldValue}" style="flex: 1;">
                        ${typeHint}
                    </div>
                    <button class="button-cancel remove-custom-field">删除</button>
                `;
                
                globalCustomFieldsContainer.appendChild(fieldItem);
                
                // 添加删除事件
                fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                    fieldItem.remove();
                    delete globalCustomFields[fieldId];
                    updateConfigJson();
                });
                
                // 添加输入事件 - 增强类型检测
                const nameInput = fieldItem.querySelector('.custom-field-name');
                const valueInput = fieldItem.querySelector('.custom-field-value');
                
                const updateCustomField = function() {
                    const fieldNameVal = nameInput.value.trim();
                    const fieldValueVal = valueInput.value.trim();
                    
                    if (fieldNameVal) {
                        // 检测值的类型
                        const typeInfo = detectValueType(fieldValueVal);
                        
                        // 更新类型提示
                        let typeHintElement = fieldItem.querySelector('.type-hint');
                        if (typeInfo.type !== 'string' && fieldValueVal) {
                            if (!typeHintElement) {
                                typeHintElement = document.createElement('span');
                                typeHintElement.className = 'type-hint';
                                typeHintElement.style.cssText = 'font-size: 11px; color: #666; margin-left: 5px;';
                                valueInput.parentNode.insertBefore(typeHintElement, valueInput.nextSibling);
                            }
                            typeHintElement.textContent = `(${typeInfo.type})`;
                        } else if (typeHintElement) {
                            typeHintElement.remove();
                        }
                        
                        // 存储原始值（字符串）和类型信息
                        globalCustomFields[fieldId] = {
                            name: fieldNameVal,
                            value: fieldValueVal, // 存储原始字符串值
                            detectedType: typeInfo.type, // 存储检测到的类型
                            processedValue: typeInfo.value // 存储处理后的值
                        };
                    } else {
                        delete globalCustomFields[fieldId];
                    }
                    updateConfigJson();
                };
                
                nameInput.addEventListener('input', updateCustomField);
                valueInput.addEventListener('input', updateCustomField);
                
                // 如果提供了初始值，立即更新
                if (fieldName && fieldValue) {
                    globalCustomFields[fieldId] = {
                        name: fieldName,
                        value: fieldValue,
                        detectedType: typeInfo.type,
                        processedValue: typeInfo.value
                    };
                }
                
                return fieldItem;
            }
            
            // 添加全局自定义字段按钮点击事件
            addGlobalCustomFieldBtn.addEventListener('click', function() {
                const fieldId = 'global-custom-field-' + Date.now();
                createGlobalCustomFieldElement(fieldId);
            });
            
            // ==================== 修改：自定义字段增强处理 ====================
            // 创建自定义字段元素（点播源）
            function createVodCustomFieldElement(fieldId, fieldName = '', fieldValue = '') {
                const fieldItem = document.createElement('div');
                fieldItem.className = 'custom-field-item';
                fieldItem.dataset.id = fieldId;
                
                // 检测初始值的类型，添加类型提示
                const typeInfo = detectValueType(fieldValue);
                let typeHint = '';
                if (typeInfo.type !== 'string') {
                    typeHint = `<span class="type-hint" style="font-size: 11px; color: #666; margin-left: 5px;">(${typeInfo.type})</span>`;
                }
                
                fieldItem.innerHTML = `
                    <input type="text" class="custom-field-name" placeholder="字段名" value="${fieldName}">
                    <div style="flex: 1; display: flex; align-items: center;">
                        <input type="text" class="custom-field-value" placeholder="字段值" value="${fieldValue}" style="flex: 1;">
                        ${typeHint}
                    </div>
                    <button class="button-cancel remove-custom-field">删除</button>
                `;
                
                vodCustomFieldsContainer.appendChild(fieldItem);
                
                // 添加删除事件
                fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                    fieldItem.remove();
                    delete vodCustomFields[fieldId];
                    updateConfigJson();
                });
                
                // 添加输入事件 - 增强类型检测
                const nameInput = fieldItem.querySelector('.custom-field-name');
                const valueInput = fieldItem.querySelector('.custom-field-value');
                
                const updateCustomField = function() {
                    const fieldNameVal = nameInput.value.trim();
                    const fieldValueVal = valueInput.value.trim();
                    
                    if (fieldNameVal) {
                        // 检测值的类型
                        const typeInfo = detectValueType(fieldValueVal);
                        
                        // 更新类型提示
                        let typeHintElement = fieldItem.querySelector('.type-hint');
                        if (typeInfo.type !== 'string' && fieldValueVal) {
                            if (!typeHintElement) {
                                typeHintElement = document.createElement('span');
                                typeHintElement.className = 'type-hint';
                                typeHintElement.style.cssText = 'font-size: 11px; color: #666; margin-left: 5px;';
                                valueInput.parentNode.insertBefore(typeHintElement, valueInput.nextSibling);
                            }
                            typeHintElement.textContent = `(${typeInfo.type})`;
                        } else if (typeHintElement) {
                            typeHintElement.remove();
                        }
                        
                        // 存储原始值（字符串）和类型信息
                        vodCustomFields[fieldId] = {
                            name: fieldNameVal,
                            value: fieldValueVal, // 存储原始字符串值
                            detectedType: typeInfo.type, // 存储检测到的类型
                            processedValue: typeInfo.value // 存储处理后的值
                        };
                    } else {
                        delete vodCustomFields[fieldId];
                    }
                    updateConfigJson();
                };
                
                nameInput.addEventListener('input', updateCustomField);
                valueInput.addEventListener('input', updateCustomField);
                
                // 如果提供了初始值，立即更新
                if (fieldName && fieldValue) {
                    vodCustomFields[fieldId] = {
                        name: fieldName,
                        value: fieldValue,
                        detectedType: typeInfo.type,
                        processedValue: typeInfo.value
                    };
                }
                
                return fieldItem;
            }
            
            // 创建直播源自定义字段元素
            function createLiveCustomFieldElement(fieldId, fieldName = '', fieldValue = '') {
                const fieldItem = document.createElement('div');
                fieldItem.className = 'custom-field-item';
                fieldItem.dataset.id = fieldId;
                
                // 检测初始值的类型，添加类型提示
                const typeInfo = detectValueType(fieldValue);
                let typeHint = '';
                if (typeInfo.type !== 'string') {
                    typeHint = `<span class="type-hint" style="font-size: 11px; color: #666; margin-left: 5px;">(${typeInfo.type})</span>`;
                }
                
                fieldItem.innerHTML = `
                    <input type="text" class="custom-field-name" placeholder="字段名" value="${fieldName}">
                    <div style="flex: 1; display: flex; align-items: center;">
                        <input type="text" class="custom-field-value" placeholder="字段值" value="${fieldValue}" style="flex: 1;">
                        ${typeHint}
                    </div>
                    <button class="button-cancel remove-custom-field">删除</button>
                `;
                
                liveCustomFieldsContainer.appendChild(fieldItem);
                
                // 添加删除事件
                fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                    fieldItem.remove();
                    delete liveCustomFields[fieldId];
                    updateConfigJson();
                });
                
                // 添加输入事件 - 增强类型检测
                const nameInput = fieldItem.querySelector('.custom-field-name');
                const valueInput = fieldItem.querySelector('.custom-field-value');
                
                const updateCustomField = function() {
                    const fieldNameVal = nameInput.value.trim();
                    const fieldValueVal = valueInput.value.trim();
                    
                    if (fieldNameVal) {
                        // 检测值的类型
                        const typeInfo = detectValueType(fieldValueVal);
                        
                        // 更新类型提示
                        let typeHintElement = fieldItem.querySelector('.type-hint');
                        if (typeInfo.type !== 'string' && fieldValueVal) {
                            if (!typeHintElement) {
                                typeHintElement = document.createElement('span');
                                typeHintElement.className = 'type-hint';
                                typeHintElement.style.cssText = 'font-size: 11px; color: #666; margin-left: 5px;';
                                valueInput.parentNode.insertBefore(typeHintElement, valueInput.nextSibling);
                            }
                            typeHintElement.textContent = `(${typeInfo.type})`;
                        } else if (typeHintElement) {
                            typeHintElement.remove();
                        }
                        
                        // 存储原始值（字符串）和类型信息
                        liveCustomFields[fieldId] = {
                            name: fieldNameVal,
                            value: fieldValueVal, // 存储原始字符串值
                            detectedType: typeInfo.type, // 存储检测到的类型
                            processedValue: typeInfo.value // 存储处理后的值
                        };
                    } else {
                        delete liveCustomFields[fieldId];
                    }
                    updateConfigJson();
                };
                
                nameInput.addEventListener('input', updateCustomField);
                valueInput.addEventListener('input', updateCustomField);
                
                // 如果提供了初始值，立即更新
                if (fieldName && fieldValue) {
                    liveCustomFields[fieldId] = {
                        name: fieldName,
                        value: fieldValue,
                        detectedType: typeInfo.type,
                        processedValue: typeInfo.value
                    };
                }
                
                return fieldItem;
            }
            
            // 创建解析地址自定义字段元素
            function createParseCustomFieldElement(fieldId, fieldName = '', fieldValue = '') {
                const fieldItem = document.createElement('div');
                fieldItem.className = 'custom-field-item';
                fieldItem.dataset.id = fieldId;
                
                // 检测初始值的类型，添加类型提示
                const typeInfo = detectValueType(fieldValue);
                let typeHint = '';
                if (typeInfo.type !== 'string') {
                    typeHint = `<span class="type-hint" style="font-size: 11px; color: #666; margin-left: 5px;">(${typeInfo.type})</span>`;
                }
                
                fieldItem.innerHTML = `
                    <input type="text" class="custom-field-name" placeholder="字段名" value="${fieldName}">
                    <div style="flex: 1; display: flex; align-items: center;">
                        <input type="text" class="custom-field-value" placeholder="字段值" value="${fieldValue}" style="flex: 1;">
                        ${typeHint}
                    </div>
                    <button class="button-cancel remove-custom-field">删除</button>
                `;
                
                parseCustomFieldsContainer.appendChild(fieldItem);
                
                // 添加删除事件
                fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                    fieldItem.remove();
                    delete parseCustomFields[fieldId];
                    updateConfigJson();
                });
                
                // 添加输入事件 - 增强类型检测
                const nameInput = fieldItem.querySelector('.custom-field-name');
                const valueInput = fieldItem.querySelector('.custom-field-value');
                
                const updateCustomField = function() {
                    const fieldNameVal = nameInput.value.trim();
                    const fieldValueVal = valueInput.value.trim();
                    
                    if (fieldNameVal) {
                        // 检测值的类型
                        const typeInfo = detectValueType(fieldValueVal);
                        
                        // 更新类型提示
                        let typeHintElement = fieldItem.querySelector('.type-hint');
                        if (typeInfo.type !== 'string' && fieldValueVal) {
                            if (!typeHintElement) {
                                typeHintElement = document.createElement('span');
                                typeHintElement.className = 'type-hint';
                                typeHintElement.style.cssText = 'font-size: 11px; color: #666; margin-left: 5px;';
                                valueInput.parentNode.insertBefore(typeHintElement, valueInput.nextSibling);
                            }
                            typeHintElement.textContent = `(${typeInfo.type})`;
                        } else if (typeHintElement) {
                            typeHintElement.remove();
                        }
                        
                        // 存储原始值（字符串）和类型信息
                        parseCustomFields[fieldId] = {
                            name: fieldNameVal,
                            value: fieldValueVal, // 存储原始字符串值
                            detectedType: typeInfo.type, // 存储检测到的类型
                            processedValue: typeInfo.value // 存储处理后的值
                        };
                    } else {
                        delete parseCustomFields[fieldId];
                    }
                    updateConfigJson();
                };
                
                nameInput.addEventListener('input', updateCustomField);
                valueInput.addEventListener('input', updateCustomField);
                
                // 如果提供了初始值，立即更新
                if (fieldName && fieldValue) {
                    parseCustomFields[fieldId] = {
                        name: fieldName,
                        value: fieldValue,
                        detectedType: typeInfo.type,
                        processedValue: typeInfo.value
                    };
                }
                
                return fieldItem;
            }

            // 初始化配置数据
            let config = {
                "spider": "",
                "sites": [],
                "lives": [],
                "parses": [],
                "flags": [
                    "youku",
                    "qq",
                    "iqiyi",
                    "qiyi",
                    "letv",
                    "sohu",
                    "tudou",
                    "pptv",
                    "mgtv",
                    "wasu"
                ],
                "categories": [], // 修改为默认空数组
                "ijk": [
                    {
                        "group": "软解码",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "0"
                            }
                        ]
                    },
                    {
                        "group": "硬解码",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "1"
                            }
                        ]
                    }
                ],
                "ads": [
                    "mimg.0c1q0l.cn",
                    "www.googletagmanager.com",
                    "www.google-analytics.com",
                    "mc.usihnbcq.cn",
                    "mg.g1mm3d.cn",
                    "mscs.svaeuzh.cn",
                    "cnzz.hhttm.top",
                    "tp.vinuxhome.com",
                    "cnzz.mmstat.com",
                    "www.baihuillq.com",
                    "s23.cnzz.com",
                    "z3.cnzz.com",
                    "c.cnzz.com",
                    "stj.v1vo.top",
                    "z12.cnzz.com",
                    "img.mosflower.cn",
                    "tips.gamevvip.com",
                    "ehwe.yhdtns.com",
                    "xdn.cqqc3.com",
                    "www.jixunkyy.cn",
                    "sp.chemacid.cn",
                    "hm.baidu.com",
                    "s9.cnzz.com",
                    "z6.cnzz.com",
                    "um.cavuc.com",
                    "mav.mavuz.com",
                    "wofwk.aoidf3.com",
                    "z5.cnzz.com",
                    "xc.hubeijieshikj.cn",
                    "tj.tianwenhu.com",
                    "xg.gars57.cn",
                    "k.jinxiuzhilv.com",
                    "cdn.bootcss.com",
                    "ppl.xunzhuo123.com",
                    "xomk.jiangjunmh.top",
                    "img.xunzhuo123.com",
                    "z1.cnzz.com",
                    "s13.cnzz.com",
                    "xg.huataisangao.cn",
                    "z7.cnzz.com",
                    "xg.huataisangao.cn",
                    "z2.cnzz.com",
                    "s96.cnzz.com",
                    "q11.cnzz.com",
                    "thy.dacedsfa.cn",
                    "xg.whsbpw.cn",
                    "s19.cnzz.com",
                    "z8.cnzz.com",
                    "s4.cnzz.com",
                    "f5w.as12df.top",
                    "ae01.alicdn.com",
                    "www.92424.cn",
                    "k.wudejia.com",
                    "vivovip.mmszxc.top",
                    "qiu.xixiqiu.com",
                    "cdnjs.hnfenxun.com",
                    "cms.qdwght.com"
                ],
                "wallpaper": ""
            };

            // ==================== 文本编辑器功能 ====================
            // 文本编辑器状态
            const textEditorState = {
                currentFile: null,
                importedFileContents: {},
                searchMatches: [],
                currentSearchIndex: 0,
                files: [],
                renamingFile: null
            };

            // 文本编辑器DOM元素
            const textEditorElements = {
                menuBtn: document.getElementById('textEditorMenuBtn'),
                menuPopup: document.getElementById('textEditorMenuPopup'),
                importItem: document.getElementById('textEditorImportItem'),
                newFileItem: document.getElementById('textEditorNewFileItem'),
                fileListContainer: document.getElementById('textEditorFileListContainer'),
                fileListWrapper: document.getElementById('textEditorFileListWrapper'),
                editorContainer: document.getElementById('textEditorEditorContainer'),
                editorFileName: document.getElementById('textEditorFileName'),
                editorContent: document.getElementById('textEditorContent'),
                saveBtn: document.getElementById('textEditorSaveBtn'),
                charCount: document.getElementById('textEditorCharCount'),
                searchBtn: document.getElementById('textEditorSearchBtn'),
                newFileModal: document.getElementById('textEditorNewFileModal'),
                newFileName: document.getElementById('textEditorNewFileName'),
                cancelNewFileBtn: document.getElementById('textEditorCancelNewFileBtn'),
                confirmNewFileBtn: document.getElementById('textEditorConfirmNewFileBtn'),
                renameModal: document.getElementById('textEditorRenameModal'),
                renameFileName: document.getElementById('textEditorRenameFileName'),
                cancelRenameBtn: document.getElementById('textEditorCancelRenameBtn'),
                confirmRenameBtn: document.getElementById('textEditorConfirmRenameBtn'),
                searchModal: document.getElementById('textEditorSearchModal'),
                searchInput: document.getElementById('textEditorSearchInput'),
                searchConfirmBtn: document.getElementById('textEditorSearchConfirmBtn'),
                searchResult: document.getElementById('textEditorSearchResult'),
                prevSearchBtn: document.getElementById('textEditorPrevSearchBtn'),
                nextSearchBtn: document.getElementById('textEditorNextSearchBtn'),
                cancelSearchBtn: document.getElementById('textEditorCancelSearchBtn'),
                editorBackBtn: document.getElementById('textEditorEditorBackBtn'),
                backBtn: document.getElementById('textEditorBackBtn')
            };

            // 初始化文本编辑器
            function initTextEditor() {
                // 初始化文件列表
                initTextEditorFileList();
                
                // 初始化事件监听
                initTextEditorEventListeners();
                
                // 隐藏编辑器返回按钮
                textEditorElements.editorBackBtn.style.display = 'none';
                textEditorElements.backBtn.style.display = 'none';
            }

            // 初始化文本编辑器文件列表 - 不存储，每次重新打开都是空的
            function initTextEditorFileList() {
                // 清空所有本地存储的数据
                clearTextEditorStorage();
                
                // 初始化空文件列表
                textEditorState.files = [];
                textEditorState.importedFileContents = {};
                renderTextEditorFileList();
            }

            // 清除文本编辑器本地存储
            function clearTextEditorStorage() {
                // 清除文件列表
                localStorage.removeItem('textEditorFileList');
                
                // 清除所有文件内容
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('textEditor_file_')) {
                        localStorage.removeItem(key);
                    }
                }
            }

            // 初始化文本编辑器事件监听
            function initTextEditorEventListeners() {
                // 编辑器返回按钮事件
                textEditorElements.editorBackBtn.addEventListener('click', handleTextEditorBackButton);
                textEditorElements.backBtn.addEventListener('click', handleTextEditorBackButton);

                // 菜单按钮
                textEditorElements.menuBtn.addEventListener('click', toggleTextEditorMenu);
                document.addEventListener('click', (e) => {
                    if (!textEditorElements.menuBtn.contains(e.target) && !textEditorElements.menuPopup.contains(e.target)) {
                        textEditorElements.menuPopup.style.display = 'none';
                    }
                });

                // 菜单选项 - 已移除选择功能
                textEditorElements.importItem.addEventListener('click', handleTextEditorImport);
                textEditorElements.newFileItem.addEventListener('click', openTextEditorNewFileModal);

                // 编辑器相关
                textEditorElements.editorContent.addEventListener('input', updateTextEditorCharCount);
                textEditorElements.saveBtn.addEventListener('click', saveTextEditorFileContent);
                textEditorElements.searchBtn.addEventListener('click', openTextEditorSearchModal);

                // 弹窗相关
                textEditorElements.cancelNewFileBtn.addEventListener('click', closeTextEditorNewFileModal);
                textEditorElements.confirmNewFileBtn.addEventListener('click', createTextEditorNewFile);
                textEditorElements.cancelRenameBtn.addEventListener('click', closeTextEditorRenameModal);
                textEditorElements.confirmRenameBtn.addEventListener('click', confirmTextEditorRename);
                textEditorElements.cancelSearchBtn.addEventListener('click', closeTextEditorSearchModal);
                textEditorElements.searchConfirmBtn.addEventListener('click', performTextEditorSearch);
                textEditorElements.prevSearchBtn.addEventListener('click', goToTextEditorPrevSearch);
                textEditorElements.nextSearchBtn.addEventListener('click', goToTextEditorNextSearch);
                
                // 查找输入框回车触发查找
                textEditorElements.searchInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') performTextEditorSearch();
                });

                // 点击文件项打开编辑器
                textEditorElements.fileListContainer.addEventListener('click', (e) => {
                    const fileItem = e.target.closest('.text-editor-file-item');
                    if (fileItem) {
                        const fileName = fileItem.dataset.name;
                        enterTextEditorMode(fileName);
                    }
                });
            }

            // 加载文本编辑器文件列表
            function loadTextEditorFilesFromStorage() {
                try {
                    const savedFiles = localStorage.getItem('textEditorFileList');
                    if (savedFiles) {
                        // 清空文件列表，重新开始
                        textEditorState.files = [];
                        textEditorState.importedFileContents = {};
                        localStorage.removeItem('textEditorFileList');
                    } else {
                        textEditorState.files = [];
                    }
                } catch (e) {
                    console.error('加载文件列表失败:', e);
                    textEditorState.files = [];
                }
            }

            // 渲染文本编辑器文件列表
            function renderTextEditorFileList() {
                textEditorElements.fileListWrapper.innerHTML = '';
                textEditorState.files.forEach(file => {
                    createTextEditorFileElement(file);
                });
            }

            // 创建文本编辑器文件元素 - 修改：增加操作按钮间距
            function createTextEditorFileElement(file) {
                const wrapper = document.createElement('div');
                wrapper.className = 'text-editor-file-item-wrapper';
                wrapper.dataset.file = file.name;
                
                // 文件项
                const fileItem = document.createElement('div');
                fileItem.className = 'text-editor-file-item';
                fileItem.dataset.name = file.name;
                fileItem.dataset.time = file.time;
                fileItem.dataset.size = file.size || 0;
                
                // 创建文件信息部分
                const fileInfo = document.createElement('div');
                fileInfo.className = 'text-editor-file-info';
                fileInfo.innerHTML = `
                    <div class="text-editor-file-icon"><i class="fas fa-file-alt"></i></div>
                    <div class="text-editor-file-name">${file.name}</div>
                `;
                
                // 创建操作按钮部分 - 增加间距
                const fileActions = document.createElement('div');
                fileActions.className = 'text-editor-file-actions';
                fileActions.innerHTML = `
                    <button class="text-editor-file-action-btn text-editor-file-share-btn" data-action="share" data-file="${file.name}" title="分享">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="text-editor-file-action-btn text-editor-file-rename-btn" data-action="rename" data-file="${file.name}" title="重命名">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-editor-file-action-btn text-editor-file-delete-btn" data-action="delete" data-file="${file.name}" title="删除">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                // 组装文件项
                fileItem.appendChild(fileInfo);
                fileItem.appendChild(fileActions);
                wrapper.appendChild(fileItem);
                textEditorElements.fileListWrapper.appendChild(wrapper);
                
                // 为操作按钮添加事件监听
                const shareBtn = wrapper.querySelector('.text-editor-file-share-btn');
                const renameBtn = wrapper.querySelector('.text-editor-file-rename-btn');
                const deleteBtn = wrapper.querySelector('.text-editor-file-delete-btn');
                
                shareBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleTextEditorShare(file.name);
                });
                
                renameBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openTextEditorRenameModal(file.name);
                });
                
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm(`确定要删除文件 "${file.name}" 吗？`)) {
                        deleteTextEditorFile(file.name, wrapper);
                    }
                });
            }

            // 删除文本编辑器文件
            function deleteTextEditorFile(fileName, wrapper) {
                // 从文件列表中删除
                textEditorState.files = textEditorState.files.filter(f => f.name !== fileName);
                // 删除本地存储
                localStorage.removeItem(`textEditor_file_${fileName}`);
                delete textEditorState.importedFileContents[fileName];
                // 删除DOM元素
                if (wrapper) wrapper.remove();
                // 如果删除的是当前编辑的文件，返回文件列表
                if (fileName === textEditorState.currentFile) {
                    showTextEditorFileList();
                }
            }

            // 文本编辑器菜单切换
            function toggleTextEditorMenu() {
                textEditorElements.menuPopup.style.display = textEditorElements.menuPopup.style.display === 'block' ? 'none' : 'block';
            }

            // 处理文本编辑器返回按钮
            function handleTextEditorBackButton() {
                showTextEditorFileList();
            }

            // 显示文本编辑器文件列表
            function showTextEditorFileList() {
                textEditorElements.editorContainer.style.display = 'none';
                textEditorElements.fileListContainer.style.display = 'block';
                document.getElementById('textEditorPageTitle').textContent = '文件列表';
                textEditorState.currentFile = null;
                textEditorElements.searchModal.style.display = 'none';
                // 显示菜单按钮（文件列表页面）
                textEditorElements.menuBtn.style.display = 'flex';
                // 隐藏编辑器返回按钮
                textEditorElements.editorBackBtn.style.display = 'none';
                textEditorElements.backBtn.style.display = 'none';
            }

            // 进入文本编辑器模式
            function enterTextEditorMode(fileName) {
                textEditorState.currentFile = fileName;
                textEditorElements.editorFileName.textContent = fileName;
                const content = textEditorState.importedFileContents[fileName] || localStorage.getItem(`textEditor_file_${fileName}`) || '';
                
                textEditorElements.editorContent.value = content;
                textEditorElements.fileListContainer.style.display = 'none';
                textEditorElements.editorContainer.style.display = 'flex';
                document.getElementById('textEditorPageTitle').textContent = '文本编辑';
                
                // 更新字符计数
                updateTextEditorCharCount();
                
                // 滚动到顶部
                setTimeout(() => {
                    textEditorElements.editorContent.scrollTop = 0;
                }, 10);
                
                textEditorElements.searchModal.style.display = 'none';
                // 隐藏菜单按钮（编辑器页面）
                textEditorElements.menuBtn.style.display = 'none';
                // 显示编辑器返回按钮，但隐藏左边的返回按钮
                textEditorElements.editorBackBtn.style.display = 'flex';
                textEditorElements.backBtn.style.display = 'none'; // 隐藏文件名称左边的返回按钮
            }

            // 文本编辑器导入文件
            function handleTextEditorImport() {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.multiple = true;
                fileInput.accept = '*';
                fileInput.onchange = (e) => {
                    const files = e.target.files;
                    if (files.length > 0) {
                        Array.from(files).forEach(file => {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                const content = event.target.result;
                                const fileName = file.name;
                                const fileSize = file.size;
                                
                                // 添加到文件列表
                                textEditorState.files.push({
                                    name: fileName,
                                    time: new Date().toISOString().split('T')[0],
                                    size: fileSize
                                });
                                
                                // 存储文件内容到内存
                                textEditorState.importedFileContents[fileName] = content;
                                
                                // 渲染文件列表
                                renderTextEditorFileList();
                            };
                            reader.readAsText(file, 'utf-8');
                        });
                    }
                };
                fileInput.click();
                textEditorElements.menuPopup.style.display = 'none';
            }

            // 文本编辑器新建文件
            function openTextEditorNewFileModal() {
                textEditorElements.newFileName.value = '';
                textEditorElements.newFileModal.style.display = 'flex';
                textEditorElements.menuPopup.style.display = 'none';
            }

            function closeTextEditorNewFileModal() {
                textEditorElements.newFileModal.style.display = 'none';
            }

            function createTextEditorNewFile() {
                let fileName = textEditorElements.newFileName.value.trim();
                if (!fileName) fileName = '未命名文件.txt';
                
                // 检查是否已存在同名文件
                if (textEditorState.files.some(f => f.name === fileName)) {
                    alert('已存在同名文件');
                    return;
                }
                
                // 添加到文件列表
                textEditorState.files.push({
                    name: fileName,
                    time: new Date().toISOString().split('T')[0],
                    size: 0
                });
                
                // 创建文件元素
                renderTextEditorFileList();
                closeTextEditorNewFileModal();
            }

            // 文本编辑器重命名
            function openTextEditorRenameModal(fileName) {
                textEditorState.renamingFile = fileName;
                textEditorElements.renameFileName.value = fileName;
                textEditorElements.renameModal.style.display = 'flex';
            }

            function closeTextEditorRenameModal() {
                textEditorElements.renameModal.style.display = 'none';
                textEditorState.renamingFile = null;
            }

            function confirmTextEditorRename() {
                const newName = textEditorElements.renameFileName.value.trim();
                if (!newName) {
                    alert('文件名不能为空');
                    return;
                }
                
                if (newName === textEditorState.renamingFile) {
                    closeTextEditorRenameModal();
                    return;
                }
                
                // 检查是否已存在同名文件
                if (textEditorState.files.some(f => f.name === newName)) {
                    alert('已存在同名文件');
                    return;
                }
                
                // 更新文件列表
                const fileIndex = textEditorState.files.findIndex(f => f.name === textEditorState.renamingFile);
                if (fileIndex !== -1) {
                    // 迁移文件内容
                    const oldStorageKey = `textEditor_file_${textEditorState.renamingFile}`;
                    const newStorageKey = `textEditor_file_${newName}`;
                    if (localStorage.getItem(oldStorageKey)) {
                        localStorage.setItem(newStorageKey, localStorage.getItem(oldStorageKey));
                        localStorage.removeItem(oldStorageKey);
                    }
                    if (textEditorState.importedFileContents[textEditorState.renamingFile]) {
                        textEditorState.importedFileContents[newName] = textEditorState.importedFileContents[textEditorState.renamingFile];
                        delete textEditorState.importedFileContents[textEditorState.renamingFile];
                    }
                    
                    // 更新文件对象
                    textEditorState.files[fileIndex].name = newName;
                    textEditorState.files[fileIndex].time = new Date().toISOString().split('T')[0];
                    
                    // 重新渲染文件列表
                    renderTextEditorFileList();
                    
                    // 更新当前文件名称（如果正在编辑的是这个文件）
                    if (textEditorState.currentFile === textEditorState.renamingFile) {
                        textEditorState.currentFile = newName;
                        textEditorElements.editorFileName.textContent = newName;
                    }
                }
                closeTextEditorRenameModal();
            }

            // 文本编辑器文件分享功能
            function handleTextEditorShare(fileName) {
                // 获取文件内容
                const content = textEditorState.importedFileContents[fileName] || localStorage.getItem(`textEditor_file_${fileName}`) || '';
                
                // 检查浏览器是否支持 Web Share API
                if (navigator.share) {
                    // 使用 Web Share API
                    const blob = new Blob([content], { type: 'text/plain' });
                    const file = new File([blob], fileName, { 
                        type: blob.type,
                        lastModified: Date.now()
                    });
                    
                    const filesArray = [file];
                    
                    if (navigator.canShare && navigator.canShare({ files: filesArray })) {
                        // 只分享文件，不包含额外的文本和标题
                        navigator.share({
                            files: filesArray
                        }).catch(err => {
                            console.log('分享失败:', err);
                            // 如果分享失败，静默下载，不显示提示
                            silentTextEditorDownload(fileName, content);
                        });
                    } else {
                        // 如果不支持分享文件，静默下载
                        silentTextEditorDownload(fileName, content);
                    }
                } else {
                    // 静默下载
                    silentTextEditorDownload(fileName, content);
                }
            }

            // 静默下载文本编辑器文件函数 - 不显示任何提示
            function silentTextEditorDownload(fileName, content) {
                // 检查文件是否有扩展名
                const hasExtension = fileName.includes('.');
                
                // 如果没有扩展名，默认添加.txt
                const downloadName = hasExtension ? fileName : fileName + '.txt';
                
                // 创建Blob对象
                const blob = new Blob([content], { type: 'text/plain' });
                
                // 创建下载链接
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = downloadName;
                document.body.appendChild(a);
                
                // 触发下载
                a.click();
                
                // 清理
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }

            // 更新文本编辑器字数统计
            function updateTextEditorCharCount() {
                const count = textEditorElements.editorContent.value.length;
                const wordCount = textEditorElements.editorContent.value.trim().split(/\s+/).filter(w => w).length;
                textEditorElements.charCount.textContent = `字数: ${count} | 单词: ${wordCount}`;
            }

            // 保存文本编辑器文件内容
            function saveTextEditorFileContent() {
                if (!textEditorState.currentFile) return;
                const content = textEditorElements.editorContent.value;
                localStorage.setItem(`textEditor_file_${textEditorState.currentFile}`, content);
                if (textEditorState.importedFileContents[textEditorState.currentFile]) {
                    textEditorState.importedFileContents[textEditorState.currentFile] = content;
                }
                
                // 更新文件大小和修改时间
                const fileIndex = textEditorState.files.findIndex(f => f.name === textEditorState.currentFile);
                if (fileIndex !== -1) {
                    textEditorState.files[fileIndex].size = content.length;
                    textEditorState.files[fileIndex].time = new Date().toISOString().split('T')[0];
                    // 重新渲染文件列表以更新显示
                    renderTextEditorFileList();
                }
                
                alert('保存成功');
            }

            // 文本编辑器查找功能
            function openTextEditorSearchModal() {
                textEditorElements.searchInput.value = '';
                textEditorElements.searchResult.textContent = '找到 0 个匹配项';
                textEditorElements.searchModal.style.display = 'flex';
                
                // 延迟设置焦点
                setTimeout(() => {
                    textEditorElements.searchInput.focus();
                }, 100);
            }

            function closeTextEditorSearchModal() {
                textEditorElements.searchModal.style.display = 'none';
            }

            function performTextEditorSearch() {
                const searchText = textEditorElements.searchInput.value.trim();
                if (!searchText) {
                    textEditorElements.searchResult.textContent = '找到 0 个匹配项';
                    return;
                }

                const content = textEditorElements.editorContent.value;
                const regex = new RegExp(`(${searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                
                // 查找所有匹配项
                textEditorState.searchMatches = [];
                let match;
                while ((match = regex.exec(content)) !== null) {
                    textEditorState.searchMatches.push({
                        start: match.index,
                        end: match.index + match[1].length
                    });
                }

                const count = textEditorState.searchMatches.length;
                textEditorElements.searchResult.textContent = `找到 ${count} 个匹配项`;
                
                if (count > 0) {
                    textEditorState.currentSearchIndex = 0;
                    scrollToTextEditorCurrentSearch();
                }
            }

            function goToTextEditorPrevSearch() {
                if (textEditorState.searchMatches.length === 0) return;
                textEditorState.currentSearchIndex = (textEditorState.currentSearchIndex - 1 + textEditorState.searchMatches.length) % textEditorState.searchMatches.length;
                scrollToTextEditorCurrentSearch();
            }

            function goToTextEditorNextSearch() {
                if (textEditorState.searchMatches.length === 0) return;
                textEditorState.currentSearchIndex = (textEditorState.currentSearchIndex + 1) % textEditorState.searchMatches.length;
                scrollToTextEditorCurrentSearch();
            }

            function scrollToTextEditorCurrentSearch() {
                if (textEditorState.searchMatches.length === 0) return;
                const match = textEditorState.searchMatches[textEditorState.currentSearchIndex];
                const content = textEditorElements.editorContent.value;
                
                // 计算匹配位置所在的行
                const textBeforeMatch = content.substring(0, match.start);
                const lines = textBeforeMatch.split('\n');
                const lineNumber = lines.length;
                
                // 将光标移动到匹配位置
                textEditorElements.editorContent.focus();
                textEditorElements.editorContent.setSelectionRange(match.start, match.end);
                
                // 滚动到匹配位置（使匹配行在编辑器中间）
                const lineHeight = 24;
                const editorHeight = textEditorElements.editorContent.clientHeight;
                const linesVisible = Math.floor(editorHeight / lineHeight);
                const scrollTop = Math.max(0, (lineNumber - Math.floor(linesVisible / 2)) * lineHeight);
                textEditorElements.editorContent.scrollTop = scrollTop;
                
                // 更新结果文本
                textEditorElements.searchResult.textContent = `找到 ${textEditorState.searchMatches.length} 个匹配项 (${textEditorState.currentSearchIndex + 1}/${textEditorState.searchMatches.length})`;
            }

            // 初始化文本编辑器
            initTextEditor();

            // ==================== TVBOX配置编辑器原有功能 ====================
            // DOM元素
            const tabBtns = document.querySelectorAll('.tab-btn');
            const addVodBtn = document.getElementById('add-vod-btn');
            const uploadJsonBtn = document.getElementById('upload-json-btn');
            const uploadJsonInput = document.getElementById('upload-json-input');
            const updateVodBtn = document.getElementById('update-vod-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const addLiveChannelBtn = document.getElementById('add-live-channel-btn');
            const updateLiveChannelBtn = document.getElementById('update-live-channel-btn');
            const cancelLiveEditBtn = document.getElementById('cancel-live-edit-btn');
            const addParseBtn = document.getElementById('add-parse-btn');
            const updateParseBtn = document.getElementById('update-parse-btn');
            const cancelParseEditBtn = document.getElementById('cancel-parse-edit-btn');
            const addUrlBtn = document.getElementById('add-url-btn');
            const copyBtn = document.getElementById('copy-btn');
            const toggleJsonBtn = document.getElementById('toggle-json-btn');
            const configJson = document.getElementById('config-json');
            const vodItems = document.getElementById('vod-items');
            const liveChannelsList = document.getElementById('live-channels-list');
            const parseList = document.getElementById('parse-list');
            const liveUrlsList = document.getElementById('live-urls-list');
            const addCategoryBtn = document.getElementById('add-category-btn');
            const categorySelect = document.getElementById('category-select');
            const customCategoryInput = document.getElementById('custom-category');
            const categoriesList = document.getElementById('categories-list');
            const parseUrlInput = document.getElementById('parse-url');
            const parseExtInput = document.getElementById('parse-ext');
            const wallpaperUrlInput = document.getElementById('wallpaper-url');
            const liveChannelNameInput = document.getElementById('live-channel-name');
            const liveTypeSelect = document.getElementById('live-type');
            const vipFlagsInput = document.getElementById('vip-flags');
            const ijkGroupSelect = document.getElementById('ijk-group');
            const ijkOptionsTextarea = document.getElementById('ijk-options');
            const adDomainsTextarea = document.getElementById('ad-domains');
            const globalSpiderInput = document.getElementById('global-spider');
            const vodExtInput = document.getElementById('vod-ext');
            const vodJarInput = document.getElementById('vod-jar');
            const addIjkOptionBtn = document.querySelector('.add-ijk-option');
            const updateIjkOptionBtn = document.querySelector('.update-ijk-option');
            const cancelIjkEditBtn = document.querySelector('.cancel-ijk-edit');
            const ijkCategorySelect = document.querySelector('.ijk-category');
            const ijkNameInput = document.querySelector('.ijk-name');
            const ijkValueInput = document.querySelector('.ijk-value');
            const ijkOptionsList = document.getElementById('ijk-options-list');
            const addVodCustomFieldBtn = document.getElementById('add-vod-custom-field-btn');
            const vodCustomFieldsContainer = document.getElementById('vod-custom-fields-container');
            const addLiveCustomFieldBtn = document.getElementById('add-live-custom-field-btn');
            const liveCustomFieldsContainer = document.getElementById('live-custom-fields-container');
            const addParseCustomFieldBtn = document.getElementById('add-parse-custom-field-btn');
            const parseCustomFieldsContainer = document.getElementById('parse-custom-fields-container');

            // 新增点播源导航相关DOM元素
            const vodNavigation = document.getElementById('vod-navigation');
            const vodNavButtons = document.getElementById('vod-nav-buttons');
            const clearConfigBtnSmall = document.getElementById('clear-config-btn-small'); // 新的小按钮

            // 新增确认对话框相关DOM元素
            const confirmDialog = document.getElementById('confirm-dialog');
            const confirmYesBtn = document.getElementById('confirm-yes');
            const confirmNoBtn = document.getElementById('confirm-no');

            // 加解密工具相关DOM元素
            const cryptoOperationSelect = document.getElementById('crypto-operation');
            const cryptoProcessBtn = document.getElementById('crypto-process-btn');
            const cryptoCopyBtn = document.getElementById('crypto-copy-btn');
            const cryptoClearBtn = document.getElementById('crypto-clear-btn');
            const cryptoInput = document.getElementById('crypto-input');
            const cryptoOutput = document.getElementById('crypto-output');
            const cryptoKeyInput = document.getElementById('crypto-key');
            const cryptoIvInput = document.getElementById('crypto-iv');
            const cryptoUploadBtn = document.getElementById('crypto-upload-btn');
            const cryptoFileInput = document.getElementById('crypto-file-input');

            // 快速匹配信息相关DOM元素
            const quickMatchHeader = document.getElementById('quick-match-header');
            const quickMatchContent = document.getElementById('quick-match-content');
            const quickMatchTextarea = document.getElementById('quick-match-textarea');
            const quickMatchBtn = document.getElementById('quick-match-btn');
            const quickMatchClearBtn = document.getElementById('quick-match-clear-btn');

            // 新增自定义一键配置相关DOM元素
            const customBatchFieldName = document.getElementById('custom-batch-field-name');
            const customBatchFieldValue = document.getElementById('custom-batch-field-value');
            const customBatchBtn = document.getElementById('custom-batch-btn');
            const customBatchSelectedBtn = document.getElementById('custom-batch-selected-btn');

            // 新增点播源选择相关DOM元素
            const vodSelectionArea = document.getElementById('vod-selection-area');
            const vodSelectionButtons = document.getElementById('vod-selection-buttons');
            const selectAllBtn = document.getElementById('select-all-btn');
            const deselectAllBtn = document.getElementById('deselect-all-btn');
            const confirmSelectionBtn = document.getElementById('confirm-selection-btn');

            // 编辑相关变量
            let draggedItem = null;
            let dragStartIndex = -1;
            let editingIndex = -1;
            let editingLiveIndex = -1;
            let editingParseIndex = -1;
            let editingIjkOptionIndex = -1;
            let currentIjkGroup = 'soft';
            let vodCustomFields = {}; // 存储点播源自定义字段
            let liveCustomFields = {}; // 存储直播源自定义字段
            let parseCustomFields = {}; // 存储解析地址自定义字段

            // 点播源导航拖拽相关变量
            let draggedNavBtn = null;
            let dragStartNavIndex = -1;

            // 新增：点播源选择相关变量
            let selectedVodIndexes = new Set(); // 存储选中的点播源索引

            // ==================== 新增：点播源选择功能 ====================
            // 初始化点播源选择区域
            function initVodSelectionArea() {
                // 全选按钮点击事件
                selectAllBtn.addEventListener('click', function() {
                    selectAllVodItems();
                });
                
                // 取消全选按钮点击事件
                deselectAllBtn.addEventListener('click', function() {
                    deselectAllVodItems();
                });
                
                // 确认选择按钮点击事件
                confirmSelectionBtn.addEventListener('click', function() {
                    confirmVodSelection();
                });
                
                // 为"一键配置到选中点播源"按钮添加事件
                customBatchSelectedBtn.addEventListener('click', function() {
                    applyBatchToSelectedVods();
                });
            }

            // 全选点播源
            function selectAllVodItems() {
                selectedVodIndexes.clear();
                config.sites.forEach((site, index) => {
                    selectedVodIndexes.add(index);
                });
                updateVodSelectionButtons();
            }

            // 取消全选点播源
            function deselectAllVodItems() {
                selectedVodIndexes.clear();
                updateVodSelectionButtons();
            }

            // 确认选择
            function confirmVodSelection() {
                if (selectedVodIndexes.size === 0) {
                    alert('请先选择要点播源！');
                    return;
                }
                
                // 隐藏选择区域，显示"一键配置到选中点播源"按钮
                vodSelectionArea.style.display = 'none';
                customBatchSelectedBtn.style.display = 'block';
                
                alert(`已选择 ${selectedVodIndexes.size} 个点播源，可以点击"一键配置到选中点播源"按钮进行配置。`);
            }

            // 更新点播源选择按钮显示
            function updateVodSelectionButtons() {
                vodSelectionButtons.innerHTML = '';
                
                if (config.sites.length === 0) {
                    vodSelectionArea.style.display = 'none';
                    customBatchSelectedBtn.style.display = 'none';
                    return;
                }
                
                vodSelectionArea.style.display = 'block';
                
                config.sites.forEach((site, index) => {
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'vod-select-btn';
                    selectBtn.dataset.index = index;
                    
                    // 修改：限制按钮文字长度，超过5个字符显示省略号
                    let displayName = site.name;
                    if (displayName.length > 5) {
                        displayName = displayName.substring(0, 5) + '…';
                    }
                    selectBtn.textContent = displayName;
                    selectBtn.title = site.name; // 添加完整名称作为提示
                    
                    // 如果已选中，添加selected类
                    if (selectedVodIndexes.has(index)) {
                        selectBtn.classList.add('selected');
                    }
                    
                    // 点击切换选择状态 - 修复：第二次点击恢复白色
                    selectBtn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        if (selectedVodIndexes.has(index)) {
                            selectedVodIndexes.delete(index);
                            this.classList.remove('selected');
                        } else {
                            selectedVodIndexes.add(index);
                            this.classList.add('selected');
                        }
                    });
                    
                    vodSelectionButtons.appendChild(selectBtn);
                });
            }

            // 应用到选中的点播源
            function applyBatchToSelectedVods() {
                const fieldName = customBatchFieldName.value.trim();
                const fieldValue = customBatchFieldValue.value.trim();
                
                if (!fieldName) {
                    alert('请输入字段名称！');
                    return;
                }
                
                if (!fieldValue) {
                    alert('请输入字段值！');
                    return;
                }
                
                if (selectedVodIndexes.size === 0) {
                    alert('请先选择要配置的点播源！');
                    return;
                }
                
                // 确认对话框
                const confirmed = confirm(`确定要将 "${fieldName}: ${fieldValue}" 同步到选中的 ${selectedVodIndexes.size} 个点播源中吗？`);
                
                if (!confirmed) {
                    return;
                }
                
                // 同步到选中的点播源
                let updatedCount = 0;
                selectedVodIndexes.forEach(index => {
                    if (index < config.sites.length) {
                        const site = config.sites[index];
                        // 设置字段值，使用智能类型检测
                        const typeInfo = detectValueType(fieldValue);
                        site[fieldName] = typeInfo.value;
                        updatedCount++;
                    }
                });
                
                // 更新UI
                updateConfigJson();
                loadVodItems();
                updateVodNavigation();
                updateVodSelectionButtons();
                
                alert(`✅ 成功将 "${fieldName}: ${fieldValue}" 同步到 ${updatedCount} 个选中的点播源中！`);
                
                // 清空选择并隐藏按钮
                selectedVodIndexes.clear();
                customBatchSelectedBtn.style.display = 'none';
            }

            // ==================== 修复：自定义一键配置功能 ====================
            // 一键配置到所有点播源按钮点击事件
            customBatchBtn.addEventListener('click', function() {
                const fieldName = customBatchFieldName.value.trim();
                const fieldValue = customBatchFieldValue.value.trim();
                
                if (!fieldName) {
                    alert('请输入字段名称！');
                    return;
                }
                
                if (!fieldValue) {
                    alert('请输入字段值！');
                    return;
                }
                
                if (config.sites.length === 0) {
                    alert('当前没有点播源可以配置！');
                    return;
                }
                
                // 确认对话框
                const confirmed = confirm(`确定要将 "${fieldName}: ${fieldValue}" 同步到所有 ${config.sites.length} 个点播源中吗？`);
                
                if (!confirmed) {
                    return;
                }
                
                // 同步到所有点播源，使用智能类型检测
                const typeInfo = detectValueType(fieldValue);
                let updatedCount = 0;
                config.sites.forEach(site => {
                    // 设置字段值，使用处理后的值
                    site[fieldName] = typeInfo.value;
                    updatedCount++;
                });
                
                // 更新UI
                updateConfigJson();
                loadVodItems();
                updateVodNavigation();
                
                alert(`✅ 成功将 "${fieldName}: ${fieldValue}" 同步到 ${updatedCount} 个点播源中！`);
                
                // 显示选择区域供用户选择
                updateVodSelectionButtons();
            });

            // ==================== 新增：清除配置功能 ====================
            // 清除配置按钮点击事件（新的小按钮）
            clearConfigBtnSmall.addEventListener('click', function() {
                showConfirmDialog();
            });

            // 显示确认对话框
            function showConfirmDialog() {
                confirmDialog.classList.remove('hidden');
            }

            // 隐藏确认对话框
            function hideConfirmDialog() {
                confirmDialog.classList.add('hidden');
            }

            // 确认清除所有配置
            confirmYesBtn.addEventListener('click', function() {
                clearAllConfig();
                hideConfirmDialog();
            });

            // 取消清除配置
            confirmNoBtn.addEventListener('click', function() {
                hideConfirmDialog();
            });

            // ==================== 修改：清除所有配置的函数 ====================
            function clearAllConfig() {
                // 重置配置数据到初始状态
                config = {
                    "spider": "",
                    "sites": [],
                    "lives": [],
                    "parses": [],
                    "flags": [
                        "youku",
                        "qq",
                        "iqiyi",
                        "qiyi",
                        "letv",
                        "sohu",
                        "tudou",
                        "pptv",
                        "mgtv",
                        "wasu"
                    ],
                    "categories": [],
                    "ijk": [
                        {
                            "group": "软解码",
                            "options": [
                                {
                                    "category": 4,
                                    "name": "opensles",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "overlay-format",
                                    "value": "842225234"
                                },
                                {
                                    "category": 4,
                                    "name": "framedrop",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "soundtouch",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "start-on-prepared",
                                    "value": "1"
                                },
                                {
                                    "category": 1,
                                    "name": "http-detect-range-support",
                                    "value": "0"
                                },
                                {
                                    "category": 1,
                                    "name": "fflags",
                                    "value": "fastseek"
                                },
                                {
                                    "category": 2,
                                    "name": "skip_loop_filter",
                                    "value": "48"
                                },
                                {
                                    "category": 4,
                                    "name": "reconnect",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "max-buffer-size",
                                    "value": "5242880"
                                },
                                {
                                    "category": 4,
                                    "name": "enable-accurate-seek",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec-auto-rotate",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec-handle-resolution-change",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec-hevc",
                                    "value": "0"
                                }
                            ]
                        },
                        {
                            "group": "硬解码",
                            "options": [
                                {
                                    "category": 4,
                                    "name": "opensles",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "overlay-format",
                                    "value": "842225234"
                                },
                                {
                                    "category": 4,
                                    "name": "framedrop",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "soundtouch",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "start-on-prepared",
                                    "value": "1"
                                },
                                {
                                    "category": 1,
                                    "name": "http-detect-range-support",
                                    "value": "0"
                                },
                                {
                                    "category": 1,
                                    "name": "fflags",
                                    "value": "fastseek"
                                },
                                {
                                    "category": 2,
                                    "name": "skip_loop_filter",
                                    "value": "48"
                                },
                                {
                                    "category": 4,
                                    "name": "reconnect",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "max-buffer-size",
                                    "value": "5242880"
                                },
                                {
                                    "category": 4,
                                    "name": "enable-accurate-seek",
                                    "value": "0"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec-auto-rotate",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec-handle-resolution-change",
                                    "value": "1"
                                },
                                {
                                    "category": 4,
                                    "name": "mediacodec-hevc",
                                    "value": "1"
                                }
                            ]
                        }
                    ],
                    "ads": [
                        "mimg.0c1q0l.cn",
                        "www.googletagmanager.com",
                        "www.google-analytics.com",
                        "mc.usihnbcq.cn",
                        "mg.g1mm3d.cn",
                        "mscs.svaeuzh.cn",
                        "cnzz.hhttm.top",
                        "tp.vinuxhome.com",
                        "cnzz.mmstat.com",
                        "www.baihuillq.com",
                        "s23.cnzz.com",
                        "z3.cnzz.com",
                        "c.cnzz.com",
                        "stj.v1vo.top",
                        "z12.cnzz.com",
                        "img.mosflower.cn",
                        "tips.gamevvip.com",
                        "ehwe.yhdtns.com",
                        "xdn.cqqc3.com",
                        "www.jixunkyy.cn",
                        "sp.chemacid.cn",
                        "hm.baidu.com",
                        "s9.cnzz.com",
                        "z6.cnzz.com",
                        "um.cavuc.com",
                        "mav.mavuz.com",
                        "wofwk.aoidf3.com",
                        "z5.cnzz.com",
                        "xc.hubeijieshikj.cn",
                        "tj.tianwenhu.com",
                        "xg.gars57.cn",
                        "k.jinxiuzhilv.com",
                        "cdn.bootcss.com",
                        "ppl.xunzhuo123.com",
                        "xomk.jiangjunmh.top",
                        "img.xunzhuo123.com",
                        "z1.cnzz.com",
                        "s13.cnzz.com",
                        "xg.huataisangao.cn",
                        "z7.cnzz.com",
                        "xg.huataisangao.cn",
                        "z2.cnzz.com",
                        "s96.cnzz.com",
                        "q11.cnzz.com",
                        "thy.dacedsfa.cn",
                        "xg.whsbpw.cn",
                        "s19.cnzz.com",
                        "z8.cnzz.com",
                        "s4.cnzz.com",
                        "f5w.as12df.top",
                        "ae01.alicdn.com",
                        "www.92424.cn",
                        "k.wudejia.com",
                        "vivovip.mmszxc.top",
                        "qiu.xixiqiu.com",
                        "cdnjs.hnfenxun.com",
                        "cms.qdwght.com"
                    ],
                    "wallpaper": ""
                };
                
                // 清空表单
                clearVodForm();
                clearLiveForm();
                clearParseForm();
                clearIjkForm();
                
                // 清空自定义字段
                vodCustomFieldsContainer.innerHTML = '';
                vodCustomFields = {};
                liveCustomFieldsContainer.innerHTML = '';
                liveCustomFields = {};
                parseCustomFieldsContainer.innerHTML = '';
                parseCustomFields = {};
                globalCustomFieldsContainer.innerHTML = '';
                globalCustomFields = {};
                
                // 清空分类配置
                config.categories = [];
                loadCategories();
                
                // 修改：将分类选择框的值重置为"电影片"
                categorySelect.value = "电影片";
                customCategoryInput.value = "";
                
                // 清空自定义一键配置
                customBatchFieldName.value = '';
                customBatchFieldValue.value = '';
                
                // 清空点播源选择
                selectedVodIndexes.clear();
                updateVodSelectionButtons();
                customBatchSelectedBtn.style.display = 'none';
                
                // 重置表单默认值
                globalSpiderInput.value = '';
                vipFlagsInput.value = config.flags.join(',');
                adDomainsTextarea.value = config.ads.join('\n');
                wallpaperUrlInput.value = '';
                
                // 重置IJK配置显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // ==================== 修改：重置编辑状态 ====================
                // 重置点播源编辑状态
                editingIndex = -1;
                addVodBtn.style.display = 'inline-block';
                updateVodBtn.style.display = 'none';
                cancelEditBtn.style.display = 'none';
                
                // 重置直播源编辑状态
                editingLiveIndex = -1;
                addLiveChannelBtn.style.display = 'inline-block';
                updateLiveChannelBtn.style.display = 'none';
                cancelLiveEditBtn.style.display = 'none';
                
                // 重置解析地址编辑状态
                editingParseIndex = -1;
                addParseBtn.style.display = 'inline-block';
                updateParseBtn.style.display = 'none';
                cancelParseEditBtn.style.display = 'none';
                
                // 重置IJK解码编辑状态
                editingIjkOptionIndex = -1;
                addIjkOptionBtn.style.display = 'inline-block';
                updateIjkOptionBtn.style.display = 'none';
                cancelIjkEditBtn.style.display = 'none';
                
                // 取消导航按钮高亮
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // 退出导航编辑模式
                if (isNavEditMode) {
                    exitNavEditMode();
                }
                
                // 更新UI
                updateConfigJson();
                loadVodItems();
                loadLiveChannels();
                loadParses();
                
                // 隐藏点播源导航栏
                vodNavigation.style.display = 'none';
                
                alert('✅ 所有配置已清除！');
            }

            // ==================== 增强的ext字段处理函数 ====================
            /**
             * 增强的ext字段处理函数，支持多种格式：
             * 1. 普通字符串：直接返回
             * 2. JSON对象字符串：验证并返回原始JSON字符串
             * 3. 数字：转换为字符串
             * 4. 布尔值：转换为字符串
             * 5. null/undefined：返回空字符串
             * 6. 对象：尝试JSON序列化
             */
            function handleExtField(extValue) {
                console.log('处理ext字段，输入值:', extValue, '类型:', typeof extValue);
                
                if (extValue === undefined || extValue === null || extValue === '') {
                    console.log('ext为空，返回空字符串');
                    return '';
                }
                
                // 如果是字符串
                if (typeof extValue === 'string') {
                    const trimmed = extValue.trim();
                    
                    // 空字符串
                    if (trimmed === '') {
                        console.log('ext为空白字符串，返回空字符串');
                        return '';
                    }
                    
                    // 尝试判断是否为JSON对象
                    if ((trimmed.startsWith('{') && trimmed.endsWith('}')) || 
                        (trimmed.startsWith('[') && trimmed.endsWith(']'))) {
                        try {
                            // 验证是否为有效JSON
                            const parsed = JSON.parse(trimmed);
                            console.log('ext是有效的JSON，返回原始JSON字符串');
                            // 返回原始JSON字符串（保持原始格式）
                            return trimmed;
                        } catch (e) {
                            console.log('ext看起来像JSON但解析失败，作为普通字符串处理');
                            // 看起来像JSON但解析失败，作为普通字符串返回
                            return trimmed;
                        }
                    }
                    
                    // 尝试判断是否为数字
                    if (!isNaN(trimmed) && trimmed !== '') {
                        console.log('ext是数字字符串，返回:', trimmed);
                        return trimmed;
                    }
                    
                    // 判断是否为布尔值字符串
                    if (trimmed.toLowerCase() === 'true' || trimmed.toLowerCase() === 'false') {
                        console.log('ext是布尔值字符串，返回:', trimmed);
                        return trimmed;
                    }
                    
                    // 普通字符串
                    console.log('ext是普通字符串，返回:', trimmed);
                    return trimmed;
                }
                
                // 如果是数字
                if (typeof extValue === 'number') {
                    console.log('ext是数字，转换为字符串:', String(extValue));
                    return String(extValue);
                }
                
                // 如果是布尔值
                if (typeof extValue === 'boolean') {
                    console.log('ext是布尔值，转换为字符串:', String(extValue));
                    return String(extValue);
                }
                
                // 如果是对象
                if (typeof extValue === 'object') {
                    try {
                        const jsonStr = JSON.stringify(extValue);
                        console.log('ext是对象，JSON序列化:', jsonStr);
                        return jsonStr;
                    } catch (e) {
                        console.log('ext对象序列化失败，返回空字符串');
                        return '';
                    }
                }
                
                // 其他类型
                console.log('ext是其他类型，转换为字符串:', String(extValue));
                return String(extValue);
            }
            
            /**
             * 从JSON文本中提取ext字段的增强版本
             */
            function extractExtFromJson(text) {
                console.log('开始提取ext字段...');
                
                // 方法1: 尝试直接解析完整的JSON
                try {
                    const jsonObj = JSON.parse(text);
                    if (jsonObj.ext !== undefined) {
                        console.log('直接解析到ext:', jsonObj.ext, '类型:', typeof jsonObj.ext);
                        return handleExtField(jsonObj.ext);
                    }
                } catch (e) {
                    // 继续尝试其他方法
                }
                
                // 方法2: 尝试从sites数组中提取
                try {
                    const jsonObj = JSON.parse(text);
                    if (jsonObj.sites && Array.isArray(jsonObj.sites) && jsonObj.sites.length > 0) {
                        const site = jsonObj.sites[0];
                        if (site.ext !== undefined) {
                            console.log('从sites中提取到ext:', site.ext, '类型:', typeof site.ext);
                            return handleExtField(site.ext);
                        }
                    }
                } catch (e) {
                    // 继续尝试其他方法
                }
                
                // 方法3: 使用正则表达式提取 - 增强版，支持嵌套JSON
                const extRegex = /"ext"\s*:\s*(?:"([^"\\]*(?:\\.[^"\\]*)*)"|({[^{}]*(?:{[^{}]*}[^{}]*)*})|(\[.*?\])|([^,}\s]+))/is;
                const match = text.match(extRegex);
                
                if (match) {
                    // 字符串值
                    if (match[1] !== undefined) {
                        console.log('正则提取到字符串ext:', match[1]);
                        return match[1];
                    }
                    // JSON对象
                    else if (match[2] !== undefined) {
                        console.log('正则提取到JSON对象ext:', match[2]);
                        return match[2];
                    }
                    // JSON数组
                    else if (match[3] !== undefined) {
                        console.log('正则提取到JSON数组ext:', match[3]);
                        return match[3];
                    }
                    // 未加引号的值（数字、布尔值等）
                    else if (match[4] !== undefined) {
                        console.log('正则提取到未加引号ext:', match[4]);
                        return match[4];
                    }
                }
                
                console.log('未找到ext字段');
                return '';
            }
            
            /**
             * 安全地设置ext字段到输入框
             */
            function setExtToInput(extValue) {
                const processedExt = handleExtField(extValue);
                vodExtInput.value = processedExt;
                console.log('设置ext到输入框:', processedExt);
            }

            // ==================== 新增：增强的JSON解析函数，支持嵌套对象 ====================
            /**
             * 增强的JSON解析函数，支持嵌套对象和复杂结构
             * 输入：JSON字符串
             * 输出：解析后的对象
             */
            function parseComplexJsonEnhanced(text) {
                console.log('开始增强解析JSON...');
                
                // 尝试直接解析
                try {
                    const parsed = JSON.parse(text);
                    console.log('直接解析成功:', parsed);
                    return parsed;
                } catch (e) {
                    console.log('直接解析失败，尝试修复:', e.message);
                }
                
                // 如果直接解析失败，尝试修复常见问题
                let fixedText = text;
                
                // 1. 修复未加引号的属性名
                fixedText = fixedText.replace(/(\s*?)(\w+?)\s*?:/g, '$1"$2":');
                
                // 2. 修复尾随逗号
                fixedText = fixedText.replace(/,\s*}/g, '}');
                fixedText = fixedText.replace(/,\s*]/g, ']');
                
                // 3. 修复undefined值
                fixedText = fixedText.replace(/:\s*undefined/g, ': null');
                
                // 4. 修复单引号
                fixedText = fixedText.replace(/'/g, '"');
                
                try {
                    const parsed = JSON.parse(fixedText);
                    console.log('修复后解析成功:', parsed);
                    return parsed;
                } catch (e) {
                    console.log('修复后解析仍然失败:', e.message);
                    
                    // 最后尝试：提取第一个完整的JSON对象
                    const objectMatch = text.match(/\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}/s);
                    const arrayMatch = text.match(/\[[^\]]*(?:\[[^\]]*\][^\]]*)*\]/s);
                    
                    if (objectMatch) {
                        try {
                            const parsed = JSON.parse(objectMatch[0]);
                            console.log('提取对象解析成功:', parsed);
                            return parsed;
                        } catch (e2) {
                            console.log('对象提取解析失败:', e2.message);
                        }
                    }
                    
                    if (arrayMatch) {
                        try {
                            const parsed = JSON.parse(arrayMatch[0]);
                            console.log('提取数组解析成功:', parsed);
                            return parsed;
                        } catch (e2) {
                            console.log('数组提取解析失败:', e2.message);
                        }
                    }
                    
                    // 如果所有方法都失败，返回空对象
                    console.log('所有解析方法失败，返回空对象');
                    return {};
                }
            }
            
            /**
             * 从文本中提取完整的site对象，支持嵌套结构
             */
            function extractSiteFromText(text) {
                console.log('开始提取site对象...');
                
                // 尝试多种解析方式
                try {
                    // 1. 尝试直接解析为JSON对象
                    const parsed = parseComplexJsonEnhanced(text);
                    
                    // 检查是否是site对象
                    if (parsed.key && parsed.name && parsed.api !== undefined) {
                        console.log('直接解析到site对象');
                        return parsed;
                    }
                    
                    // 2. 检查是否是包含sites的对象
                    if (parsed.sites && Array.isArray(parsed.sites) && parsed.sites.length > 0) {
                        console.log('从sites数组中提取');
                        return parsed.sites[0];
                    }
                    
                    // 3. 检查是否是数组
                    if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].key && parsed[0].name) {
                        console.log('从数组中提取');
                        return parsed[0];
                    }
                } catch (e) {
                    console.log('提取失败:', e.message);
                }
                
                // 4. 尝试正则表达式提取
                try {
                    // 增强的正则表达式，支持嵌套对象
                    const sitePattern = /\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}/s;
                    const matches = text.match(new RegExp(sitePattern, 'g'));
                    
                    if (matches) {
                        for (const match of matches) {
                            try {
                                const parsed = JSON.parse(match);
                                if (parsed.key && parsed.name && parsed.api !== undefined) {
                                    console.log('正则提取到site对象');
                                    return parsed;
                                }
                            } catch (e) {
                                // 继续尝试下一个
                            }
                        }
                    }
                } catch (e) {
                    console.log('正则提取失败:', e.message);
                }
                
                console.log('未找到有效的site对象');
                return null;
            }

            // 增强容错能力：数据清洗函数 - 修复：如果配置中没有searchable、quickSearch、filterable这三个字段，则默认不显示
            function sanitizeConfig(config) {
                console.log('开始清洗配置数据...');
                
                // 确保必要的根级字段存在
                if (!config.sites) config.sites = [];
                if (!config.lives) config.lives = [];
                if (!config.parses) config.parses = [];
                if (!config.flags) config.flags = [];
                if (!config.categories) config.categories = [];
                if (!config.ijk) config.ijk = [];
                if (!config.ads) config.ads = [];
                
                // 清洗站点数据
                if (config.sites && Array.isArray(config.sites)) {
                    config.sites.forEach((site, index) => {
                        // 确保必要的字段存在且有有效值
                        if (!site.key) site.key = `site_${index}`;
                        if (!site.name) site.name = `站点${index}`;
                        if (site.type === undefined || site.type === null) site.type = 1;
                        if (!site.api) site.api = '';
                        
                        // 修改：如果配置中没有searchable、quickSearch、filterable这三个字段，则默认不显示
                        // 检查并处理searchable字段
                        if (!site.hasOwnProperty('searchable')) {
                            // 如果没有searchable字段，设置为-1（不显示）
                            site.searchable = -1;
                        } else if (site.searchable === undefined || site.searchable === null || site.searchable === 'undefined') {
                            site.searchable = -1;
                        }
                        
                        // 检查并处理quickSearch字段
                        if (!site.hasOwnProperty('quickSearch')) {
                            // 如果没有quickSearch字段，设置为-1（不显示）
                            site.quickSearch = -1;
                        } else if (site.quickSearch === undefined || site.quickSearch === null || site.quickSearch === 'undefined') {
                            site.quickSearch = -1;
                        }
                        
                        // 检查并处理filterable字段
                        if (!site.hasOwnProperty('filterable')) {
                            // 如果没有filterable字段，设置为-1（不显示）
                            site.filterable = -1;
                        } else if (site.filterable === undefined || site.filterable === null || site.filterable === 'undefined') {
                            site.filterable = -1;
                        }
                        
                        // 处理searchable、quickSearch、filterable字段
                        // 如果值为-1，则不包含在最终JSON中
                        if (site.searchable === -1) {
                            delete site.searchable;
                        }
                        
                        if (site.quickSearch === -1) {
                            delete site.quickSearch;
                        }
                        
                        if (site.filterable === -1) {
                            delete site.filterable;
                        }
                        
                        // 确保数字字段是数字类型
                        if (site.searchable !== undefined) {
                            site.searchable = parseInt(site.searchable) || 0;
                        }
                        if (site.quickSearch !== undefined) {
                            site.quickSearch = parseInt(site.quickSearch) || 0;
                        }
                        if (site.filterable !== undefined) {
                            site.filterable = parseInt(site.filterable) || 0;
                        }
                        site.type = parseInt(site.type) || 1;
                        
                        // 处理其他可选字段
                        if (!site.jar) site.jar = '';
                        
                        // 使用增强的ext字段处理函数
                        if (site.ext === undefined || site.ext === null) {
                            site.ext = '';
                        } else {
                            site.ext = handleExtField(site.ext);
                        }
                        
                        if (!site.categories || !Array.isArray(site.categories)) {
                            site.categories = [];
                        }
                        
                        console.log(`站点 ${index} 清洗完成:`, {
                            key: site.key,
                            searchable: site.searchable,
                            quickSearch: site.quickSearch,
                            filterable: site.filterable,
                            ext: site.ext
                        });
                    });
                }
                
                // 清洗其他数组数据
                ['lives', 'parses', 'flags', 'categories', 'ads'].forEach(key => {
                    if (!Array.isArray(config[key])) {
                        config[key] = [];
                    }
                });
                
                // 清洗字符串字段
                if (typeof config.spider !== 'string') config.spider = '';
                if (typeof config.wallpaper !== 'string') config.wallpaper = '';
                
                console.log('配置数据清洗完成');
                return config;
            }

            // 修复：改进的解析JSON中categories数组的函数
            function extractCategoriesFromJson(text) {
                console.log('开始提取categories字段...');
                
                // 尝试多种方式提取categories数组
                
                // 1. 尝试直接解析完整的JSON
                try {
                    const jsonObj = JSON.parse(text);
                    if (jsonObj.categories && Array.isArray(jsonObj.categories)) {
                        console.log('直接解析到categories:', jsonObj.categories);
                        return jsonObj.categories;
                    }
                } catch (e) {
                    // 继续尝试其他方法
                }
                
                // 2. 尝试从文本中提取categories数组
                const categoriesRegex = /"categories"\s*:\s*\[(.*?)\]/s;
                const match = text.match(categoriesRegex);
                
                if (match) {
                    try {
                        // 解析categories数组部分
                        const categoriesStr = '[' + match[1] + ']';
                        const categories = JSON.parse(categoriesStr);
                        console.log('通过正则提取到categories:', categories);
                        return categories;
                    } catch (e) {
                        console.log('正则提取但解析失败:', e.message);
                    }
                }
                
                // 3. 尝试提取站点中的categories（如果文本是单个站点配置）
                const siteCategoriesRegex = /"categories"\s*:\s*\[(.*?)\]/;
                const siteMatch = text.match(siteCategoriesRegex);
                
                if (siteMatch) {
                    try {
                        const categoriesStr = '[' + siteMatch[1] + ']';
                        const categories = JSON.parse(categoriesStr);
                        console.log('从站点中提取到categories:', categories);
                        return categories;
                    } catch (e) {
                        console.log('站点categories提取失败:', e.message);
                    }
                }
                
                // 4. 尝试更简单的提取方式：匹配方括号内的内容
                const simpleCategoriesRegex = /\[(.*?)\]/g;
                const matches = [...text.matchAll(simpleCategoriesRegex)];
                
                for (const match of matches) {
                    const potentialArrayStr = '[' + match[1] + ']';
                    try {
                        const parsed = JSON.parse(potentialArrayStr);
                        if (Array.isArray(parsed) && parsed.length > 0 && typeof parsed[0] === 'string') {
                            // 假设这是一个字符串数组
                            console.log('简单提取到categories:', parsed);
                            return parsed;
                        }
                    } catch (e) {
                        // 继续尝试下一个
                    }
                }
                
                console.log('未找到categories字段');
                return [];
            }

            // 快速匹配信息功能 - 修复：改进分类提取逻辑和嵌套对象支持
            function initQuickMatch() {
                // 切换展开/收缩状态
                quickMatchHeader.addEventListener('click', function() {
                    const isExpanded = quickMatchContent.classList.contains('expanded');
                    
                    if (isExpanded) {
                        quickMatchContent.classList.remove('expanded');
                        quickMatchHeader.classList.remove('expanded');
                    } else {
                        quickMatchContent.classList.add('expanded');
                        quickMatchHeader.classList.add('expanded');
                    }
                });
                
                // 处理快速匹配按钮点击
                quickMatchBtn.addEventListener('click', function() {
                    const text = quickMatchTextarea.value.trim();
                    
                    if (!text) {
                        alert('请输入点播源配置信息');
                        return;
                    }
                    
                    try {
                        let siteData = {};
                        
                        console.log('开始解析快速匹配文本...');
                        
                        // 使用增强的JSON解析函数
                        siteData = extractSiteFromText(text);
                        
                        if (!siteData) {
                            throw new Error('未找到有效的点播源配置信息');
                        }
                        
                        console.log('解析结果:', siteData);
                        
                        // 修复：单独提取categories字段
                        let categoriesFromText = [];
                        try {
                            categoriesFromText = extractCategoriesFromJson(text);
                            console.log('提取到的分类配置:', categoriesFromText);
                        } catch (e) {
                            console.log('分类提取失败:', e.message);
                        }
                        
                        // 检查当前是否处于编辑模式
                        const isEditing = editingIndex !== -1;
                        
                        // 如果是编辑模式，只更新匹配的字段，不清空表单
                        if (isEditing) {
                            // 只更新匹配到的字段，保留其他字段不变
                            if (siteData.key) document.getElementById('vod-key').value = siteData.key;
                            if (siteData.name) document.getElementById('vod-name').value = siteData.name;
                            if (siteData.type !== undefined) document.getElementById('vod-type').value = siteData.type;
                            if (siteData.api) document.getElementById('vod-api').value = siteData.api;
                            if (siteData.jar) vodJarInput.value = siteData.jar;
                            
                            // 处理searchable字段：如果没有这个字段，选择"不显示"
                            if (siteData.searchable !== undefined) {
                                document.getElementById('vod-searchable').value = siteData.searchable;
                            } else {
                                document.getElementById('vod-searchable').value = '-1'; // 不显示
                            }
                            
                            // 处理quickSearch字段：如果没有这个字段，选择"不显示"
                            if (siteData.quickSearch !== undefined) {
                                document.getElementById('vod-quickSearch').value = siteData.quickSearch;
                            } else {
                                document.getElementById('vod-quickSearch').value = '-1'; // 不显示
                            }
                            
                            // 处理filterable字段：如果没有这个字段，选择"不显示"
                            if (siteData.filterable !== undefined) {
                                document.getElementById('vod-filterable').value = siteData.filterable;
                            } else {
                                document.getElementById('vod-filterable').value = '-1'; // 不显示
                            }
                            
                            // 使用增强的ext字段处理函数
                            if (siteData.ext !== undefined) {
                                setExtToInput(siteData.ext);
                            }
                            
                            // 修复：更新分类配置
                            // 优先使用从siteData中提取的分类，如果没有则使用从文本中提取的分类
                            if (siteData.categories && Array.isArray(siteData.categories) && siteData.categories.length > 0) {
                                config.categories = [...siteData.categories];
                            } else if (categoriesFromText && categoriesFromText.length > 0) {
                                config.categories = [...categoriesFromText];
                            } else {
                                config.categories = [];
                            }
                            loadCategories();
                            
                            // 更新自定义字段（如果存在）- 使用增强的智能类型检测
                            const standardFields = ['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'];
                            
                            for (const key in siteData) {
                                if (!standardFields.includes(key)) {
                                    const value = siteData[key];
                                    // 对于嵌套对象，序列化为JSON字符串
                                    const displayValue = (typeof value === 'object' && value !== null) ? JSON.stringify(value, null, 2) : String(value);
                                    
                                    // 查找是否已存在该自定义字段
                                    let existingField = null;
                                    Object.keys(vodCustomFields).forEach(fieldId => {
                                        if (vodCustomFields[fieldId].name === key) {
                                            existingField = fieldId;
                                        }
                                    });
                                    
                                    if (existingField) {
                                        // 更新现有字段
                                        const fieldItem = document.querySelector(`.custom-field-item[data-id="${existingField}"]`);
                                        if (fieldItem) {
                                            const valueInput = fieldItem.querySelector('.custom-field-value');
                                            // 设置值，使用增强的智能类型检测显示
                                            const typeInfo = detectValueType(displayValue);
                                            valueInput.value = displayValue;
                                            
                                            // 更新类型提示
                                            let typeHintElement = fieldItem.querySelector('.type-hint');
                                            if (typeInfo.type !== 'string' && displayValue) {
                                                if (!typeHintElement) {
                                                    typeHintElement = document.createElement('span');
                                                    typeHintElement.className = 'type-hint';
                                                    typeHintElement.style.cssText = 'font-size: 11px; color: #666; margin-left: 5px;';
                                                    valueInput.parentNode.insertBefore(typeHintElement, valueInput.nextSibling);
                                                }
                                                typeHintElement.textContent = `(${typeInfo.type})`;
                                            } else if (typeHintElement) {
                                                typeHintElement.remove();
                                            }
                                            
                                            // 更新vodCustomFields对象
                                            vodCustomFields[existingField] = {
                                                name: key,
                                                value: displayValue,
                                                detectedType: typeInfo.type,
                                                processedValue: typeInfo.value
                                            };
                                        }
                                    } else {
                                        // 添加新字段
                                        const fieldId = 'custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                        createVodCustomFieldElement(fieldId, key, displayValue);
                                    }
                                }
                            }
                            
                            alert('配置信息已成功同步到编辑表单中！');
                        } else {
                            // 非编辑模式，清空表单并填充新数据
                            clearVodForm();
                            
                            // 填充表单字段
                            if (siteData.key) document.getElementById('vod-key').value = siteData.key;
                            if (siteData.name) document.getElementById('vod-name').value = siteData.name;
                            if (siteData.type !== undefined) document.getElementById('vod-type').value = siteData.type;
                            if (siteData.api) document.getElementById('vod-api').value = siteData.api;
                            if (siteData.jar) vodJarInput.value = siteData.jar;
                            
                            // 处理searchable字段：如果没有这个字段，选择"不显示"
                            if (siteData.searchable !== undefined) {
                                document.getElementById('vod-searchable').value = siteData.searchable;
                            } else {
                                document.getElementById('vod-searchable').value = '-1'; // 不显示
                            }
                            
                            // 处理quickSearch字段：如果没有这个字段，选择"不显示"
                            if (siteData.quickSearch !== undefined) {
                                document.getElementById('vod-quickSearch').value = siteData.quickSearch;
                            } else {
                                document.getElementById('vod-quickSearch').value = '-1'; // 不显示
                            }
                            
                            // 处理filterable字段：如果没有这个字段，选择"不显示"
                            if (siteData.filterable !== undefined) {
                                document.getElementById('vod-filterable').value = siteData.filterable;
                            } else {
                                document.getElementById('vod-filterable').value = '-1'; // 不显示
                            }
                            
                            // 使用增强的ext字段处理函数
                            if (siteData.ext !== undefined) {
                                setExtToInput(siteData.ext);
                            }
                            
                            // 修复：更新分类配置
                            // 优先使用从siteData中提取的分类，如果没有则使用从文本中提取的分类
                            if (siteData.categories && Array.isArray(siteData.categories) && siteData.categories.length > 0) {
                                config.categories = [...siteData.categories];
                            } else if (categoriesFromText && categoriesFromText.length > 0) {
                                config.categories = [...categoriesFromText];
                            } else {
                                config.categories = [];
                            }
                            loadCategories();
                            
                            // 清空并重新添加自定义字段
                            vodCustomFieldsContainer.innerHTML = '';
                            vodCustomFields = {};
                            
                            // 获取自定义字段（排除标准字段）- 使用增强的智能类型检测
                            const standardFields = ['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'];
                            
                            for (const key in siteData) {
                                if (!standardFields.includes(key)) {
                                    const value = siteData[key];
                                    // 对于嵌套对象，序列化为JSON字符串
                                    const displayValue = (typeof value === 'object' && value !== null) ? JSON.stringify(value, null, 2) : String(value);
                                    
                                    const fieldId = 'custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                    createVodCustomFieldElement(fieldId, key, displayValue);
                                }
                            }
                            
                            alert('配置信息已成功同步到表单中！');
                        }
                        
                        // 更新配置JSON
                        updateConfigJson();
                        
                        // 清空文本框内容
                        quickMatchTextarea.value = '';
                        
                        // 收缩快速匹配区域
                        quickMatchContent.classList.remove('expanded');
                        quickMatchHeader.classList.remove('expanded');
                        
                    } catch (error) {
                        console.error('解析配置失败:', error);
                        alert('解析配置失败: ' + error.message + '\n\n原始文本:\n' + text.substring(0, 200) + '...');
                    }
                });
                
                // 清除按钮功能
                quickMatchClearBtn.addEventListener('click', function() {
                    quickMatchTextarea.value = '';
                });
            }

            // 初始化快速匹配功能
            initQuickMatch();

            // 新增：点播源导航栏拖拽功能
            function initVodNavigationDrag() {
                // 为导航按钮添加拖拽事件
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.addEventListener('dragstart', handleNavDragStart);
                    btn.addEventListener('dragover', handleNavDragOver);
                    btn.addEventListener('dragleave', handleNavDragLeave);
                    btn.addEventListener('drop', handleNavDrop);
                    btn.addEventListener('dragend', handleNavDragEnd);
                });
            }

            // 导航按钮拖拽开始
            function handleNavDragStart(e) {
                draggedNavBtn = this;
                dragStartNavIndex = parseInt(this.dataset.index);
                
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.outerHTML);
                
                // 设置拖拽图像为按钮本身
                e.dataTransfer.setDragImage(this, 20, 20);
            }

            // 导航按钮拖拽经过
            function handleNavDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const targetBtn = e.target.closest('.vod-nav-btn');
                if (targetBtn && targetBtn !== draggedNavBtn) {
                    targetBtn.classList.add('drag-over');
                }
            }

            // 导航按钮拖拽离开
            function handleNavDragLeave(e) {
                const targetBtn = e.target.closest('.vod-nav-btn');
                if (targetBtn) {
                    targetBtn.classList.remove('drag-over');
                }
            }

            // 导航按钮拖拽放置
            function handleNavDrop(e) {
                e.preventDefault();
                
                const targetBtn = e.target.closest('.vod-nav-btn');
                if (!targetBtn || targetBtn === draggedNavBtn) {
                    // 移除所有按钮的drag-over类
                    document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                        btn.classList.remove('drag-over');
                    });
                    return;
                }
                
                const dragEndNavIndex = parseInt(targetBtn.dataset.index);
                
                if (dragStartNavIndex !== dragEndNavIndex) {
                    // 从原位置移除拖动的项目
                    const [movedItem] = config.sites.splice(dragStartNavIndex, 1);
                    
                    // 插入到新位置
                    config.sites.splice(dragEndNavIndex, 0, movedItem);
                    
                    // 立即更新UI
                    loadVodItems();
                    updateVodNavigation();
                    updateVodSelectionButtons();
                    updateConfigJson();
                }
                
                // 移除所有按钮的drag-over类
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('drag-over');
                });
            }

            // 导航按钮拖拽结束 - 修复位置偏移问题
            function handleNavDragEnd(e) {
                if (draggedNavBtn) {
                    draggedNavBtn.classList.remove('dragging');
                    // 确保按钮回到原始位置
                    draggedNavBtn.style.transform = '';
                    draggedNavBtn = null;
                }
                
                // 移除所有按钮的drag-over类
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('drag-over');
                });
            }

            // 新增：更新点播源导航栏 - 修改：限制按钮文字长度为5个字符
            function updateVodNavigation() {
                vodNavButtons.innerHTML = '';
                
                if (config.sites.length === 0) {
                    vodNavigation.style.display = 'none';
                    return;
                }
                
                vodNavigation.style.display = 'block';
                
                config.sites.forEach((site, index) => {
                    const navBtn = document.createElement('button');
                    navBtn.className = 'vod-nav-btn';
                    navBtn.dataset.index = index;
                    
                    // 修改：限制按钮文字长度，超过5个字符显示省略号
                    let displayName = site.name;
                    if (displayName.length > 5) {
                        displayName = displayName.substring(0, 5) + '…';
                    }
                    navBtn.textContent = displayName;
                    navBtn.title = site.name; // 添加完整名称作为提示
                    
                    navBtn.draggable = true;
                    
                    navBtn.addEventListener('click', function() {
                        // 滚动到对应的点播源项目
                        const targetItem = document.querySelector(`.source-item[data-index="${index}"]`);
                        if (targetItem) {
                            // 移除所有按钮的active类
                            document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            
                            // 添加active类到当前按钮
                            this.classList.add('active');
                            
                            // 滚动到目标元素
                            targetItem.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                            
                            // 添加高亮效果
                            targetItem.style.boxShadow = '0 0 0 2px var(--primary-color)';
                            setTimeout(() => {
                                targetItem.style.boxShadow = '';
                            }, 2000);
                        }
                    });
                    
                    vodNavButtons.appendChild(navBtn);
                });
                
                // 初始化拖拽功能
                initVodNavigationDrag();
                
                // 更新点播源选择区域
                updateVodSelectionButtons();
            }

            // 新增：高亮导航按钮
            function highlightNavButton(index) {
                // 移除所有按钮的active类
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // 添加active类到当前按钮
                const targetBtn = document.querySelector(`.vod-nav-btn[data-index="${index}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }
            }

            // JSON显示/隐藏切换 - 修改后的版本
            let isJsonVisible = false;
            toggleJsonBtn.addEventListener('click', function() {
                const buttonPosition = this.getBoundingClientRect().top + window.pageYOffset;
                
                isJsonVisible = !isJsonVisible;
                if (isJsonVisible) {
                    configJson.classList.remove('hidden');
                    this.textContent = '隐藏JSON';
                    // 滚动到底部显示代码栏全貌
                    setTimeout(() => {
                        window.scrollTo({
                            top: document.body.scrollHeight,
                            behavior: 'smooth'
                        });
                    }, 50);
                } else {
                    configJson.classList.add('hidden');
                    this.textContent = '显示JSON';
                    // 滚动回按钮位置显示按钮全貌
                    setTimeout(() => {
                        window.scrollTo({
                            top: buttonPosition - 20, // 减去20px让按钮上方有点空间
                            behavior: 'smooth'
                        });
                    }, 50);
                }
            });

            // ==================== 修改：上传JSON/TXT文件 - 增强解析能力，支持嵌套对象 ====================
            uploadJsonBtn.addEventListener('click', function() {
                uploadJsonInput.click();
            });

            uploadJsonInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let uploadedConfig;
                        let fileContent = e.target.result;
                        
                        // 根据文件扩展名决定处理方式
                        const fileName = file.name.toLowerCase();
                        
                        if (fileName.endsWith('.txt')) {
                            // 处理TXT文件 - 尝试多种JSON格式解析
                            try {
                                // 首先尝试直接解析为JSON对象
                                uploadedConfig = JSON.parse(fileContent);
                            } catch (e1) {
                                try {
                                    // 尝试从文本中提取JSON对象
                                    const jsonMatch = fileContent.match(/\{[\s\S]*\}/);
                                    if (jsonMatch) {
                                        uploadedConfig = JSON.parse(jsonMatch[0]);
                                    } else {
                                        throw new Error('TXT文件中未找到有效的JSON配置');
                                    }
                                } catch (e2) {
                                    // 尝试处理base64编码的内容
                                    try {
                                        const decodedContent = atob(fileContent.trim());
                                        uploadedConfig = JSON.parse(decodedContent);
                                    } catch (e3) {
                                        throw new Error('无法解析TXT文件内容，请确保文件包含有效的JSON配置');
                                    }
                                }
                            }
                        } else {
                            // 处理JSON文件 - 使用增强的解析函数
                            try {
                                uploadedConfig = parseComplexJsonEnhanced(fileContent);
                                console.log('JSON解析成功:', uploadedConfig);
                            } catch (parseError) {
                                console.log('JSON解析失败，尝试修复...', parseError);
                                // 尝试修复常见的JSON格式错误
                                const fixedJson = fileContent
                                    .replace(/"filterable": undefined/g, '"filterable": 0')
                                    .replace(/"searchable": undefined/g, '"searchable": 0')
                                    .replace(/"quickSearch": undefined/g, '"quickSearch": 0')
                                    .replace(/"type": undefined/g, '"type": 1')
                                    .replace(/"ext": undefined/g, '"ext": ""')
                                    .replace(/"jar": undefined/g, '"jar": ""')
                                    .replace(/"categories": undefined/g, '"categories": []')
                                    .replace(/,(\s*})/g, '$1'); // 移除尾随逗号
                                
                                uploadedConfig = JSON.parse(fixedJson);
                                console.log('JSON修复成功');
                            }
                        }
                        
                        // 验证上传的JSON是否包含点播源信息
                        if (!uploadedConfig.sites || !Array.isArray(uploadedConfig.sites)) {
                            // 如果sites不存在，尝试从其他可能的字段名获取
                            if (uploadedConfig.vodSites && Array.isArray(uploadedConfig.vodSites)) {
                                uploadedConfig.sites = uploadedConfig.vodSites;
                            } else if (uploadedConfig.data && Array.isArray(uploadedConfig.data)) {
                                uploadedConfig.sites = uploadedConfig.data;
                            } else {
                                // 尝试提取单个site对象
                                const siteData = extractSiteFromText(fileContent);
                                if (siteData) {
                                    uploadedConfig.sites = [siteData];
                                } else {
                                    throw new Error('上传的文件格式不正确，缺少点播源信息(sites数组)');
                                }
                            }
                        }

                        // 数据清洗 - 修复：如果配置中没有searchable、quickSearch、filterable这三个字段，则默认不显示
                        uploadedConfig = sanitizeConfig(uploadedConfig);
                        
                        // ==================== 修改：默认全配置同步 ====================
                        // 1. 将上传的点播源信息追加到现有列表后面
                        config.sites = [...config.sites, ...uploadedConfig.sites];
                        
                        // 2. 默认同步其他配置信息（如果与编辑器代码匹配）
                        let syncMessages = [];
                        
                        // 同步直播源配置 - 检查数据结构是否匹配
                        if (uploadedConfig.lives && Array.isArray(uploadedConfig.lives)) {
                            const hasValidLives = uploadedConfig.lives.every(live => 
                                live.name && live.type !== undefined && live.url
                            );
                            if (hasValidLives) {
                                config.lives = uploadedConfig.lives;
                                loadLiveChannels();
                                syncMessages.push('直播源');
                            }
                        }
                        
                        // 同步解析地址配置 - 检查数据结构是否匹配
                        if (uploadedConfig.parses && Array.isArray(uploadedConfig.parses)) {
                            const hasValidParses = uploadedConfig.parses.every(parse => 
                                parse.name && parse.type !== undefined && parse.url
                            );
                            if (hasValidParses) {
                                config.parses = uploadedConfig.parses;
                                loadParses();
                                syncMessages.push('解析地址');
                            }
                        }
                        
                        // 同步VIP解析标识 - 检查数据结构是否匹配
                        if (uploadedConfig.flags && Array.isArray(uploadedConfig.flags)) {
                            const hasValidFlags = uploadedConfig.flags.every(flag => 
                                typeof flag === 'string'
                            );
                            if (hasValidFlags) {
                                config.flags = uploadedConfig.flags;
                                vipFlagsInput.value = uploadedConfig.flags.join(',');
                                syncMessages.push('VIP标识');
                            }
                        }
                        
                        // 同步IJK解码配置 - 检查数据结构是否匹配
                        if (uploadedConfig.ijk && Array.isArray(uploadedConfig.ijk)) {
                            const hasValidIjk = uploadedConfig.ijk.every(ijkGroup => 
                                ijkGroup.group && Array.isArray(ijkGroup.options)
                            );
                            if (hasValidIjk) {
                                config.ijk = uploadedConfig.ijk;
                                updateIjkOptionsTextarea();
                                loadIjkOptions();
                                syncMessages.push('IJK配置');
                            }
                        }
                        
                        // 同步广告过滤配置 - 检查数据结构是否匹配
                        if (uploadedConfig.ads && Array.isArray(uploadedConfig.ads)) {
                            const hasValidAds = uploadedConfig.ads.every(ad => 
                                typeof ad === 'string'
                            );
                            if (hasValidAds) {
                                config.ads = uploadedConfig.ads;
                                adDomainsTextarea.value = uploadedConfig.ads.join('\n');
                                syncMessages.push('广告过滤');
                            }
                        }
                        
                        // 同步spider信息
                        if (uploadedConfig.spider && typeof uploadedConfig.spider === 'string') {
                            globalSpiderInput.value = uploadedConfig.spider;
                            config.spider = uploadedConfig.spider;
                            syncMessages.push('Spider');
                        }
                        
                        // 同步壁纸信息
                        if (uploadedConfig.wallpaper && typeof uploadedConfig.wallpaper === 'string') {
                            wallpaperUrlInput.value = uploadedConfig.wallpaper;
                            config.wallpaper = uploadedConfig.wallpaper;
                            syncMessages.push('壁纸');
                        }
                        
                        // ==================== 新增：同步全局自定义字段 ====================
                        // 识别并同步所有不在标准字段中的根级字段
                        const standardRootFields = ['spider', 'sites', 'lives', 'parses', 'flags', 'categories', 'ijk', 'ads', 'wallpaper'];
                        let globalFieldCount = 0;
                        
                        for (const key in uploadedConfig) {
                            if (!standardRootFields.includes(key)) {
                                // 这是全局自定义字段
                                const value = uploadedConfig[key];
                                
                                // 查找是否已存在该全局自定义字段
                                let existingField = null;
                                Object.keys(globalCustomFields).forEach(fieldId => {
                                    if (globalCustomFields[fieldId].name === key) {
                                        existingField = fieldId;
                                    }
                                });
                                
                                if (existingField) {
                                    // 更新现有字段
                                    const fieldItem = document.querySelector(`#global-custom-fields-container .custom-field-item[data-id="${existingField}"]`);
                                    if (fieldItem) {
                                        const valueInput = fieldItem.querySelector('.custom-field-value');
                                        // 设置值，使用智能类型检测显示
                                        const displayValue = (typeof value === 'object' && value !== null) ? JSON.stringify(value, null, 2) : String(value);
                                        const typeInfo = detectValueType(displayValue);
                                        valueInput.value = displayValue;
                                        
                                        // 更新类型提示
                                        let typeHintElement = fieldItem.querySelector('.type-hint');
                                        if (typeInfo.type !== 'string' && displayValue) {
                                            if (!typeHintElement) {
                                                typeHintElement = document.createElement('span');
                                                typeHintElement.className = 'type-hint';
                                                typeHintElement.style.cssText = 'font-size: 11px; color: #666; margin-left: 5px;';
                                                valueInput.parentNode.insertBefore(typeHintElement, valueInput.nextSibling);
                                            }
                                            typeHintElement.textContent = `(${typeInfo.type})`;
                                        } else if (typeHintElement) {
                                            typeHintElement.remove();
                                        }
                                        
                                        // 更新globalCustomFields对象
                                        globalCustomFields[existingField] = {
                                            name: key,
                                            value: displayValue,
                                            detectedType: typeInfo.type,
                                            processedValue: typeInfo.value
                                        };
                                    }
                                } else {
                                    // 添加新字段
                                    const fieldId = 'global-custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                    const displayValue = (typeof value === 'object' && value !== null) ? JSON.stringify(value, null, 2) : String(value);
                                    createGlobalCustomFieldElement(fieldId, key, displayValue);
                                }
                                
                                globalFieldCount++;
                            }
                        }
                        
                        if (globalFieldCount > 0) {
                            syncMessages.push(`${globalFieldCount}个全局字段`);
                        }
                        
                        // 更新UI
                        updateConfigJson();
                        loadVodItems();
                        loadCategories(); // 这会清空分类显示
                        updateVodNavigation(); // 更新导航栏
                        
                        // 显示导入成功的消息
                        let successMessage = `✅ 成功导入${uploadedConfig.sites.length}个点播源配置！`;
                        if (syncMessages.length > 0) {
                            successMessage += `\n已同步以下配置：${syncMessages.join('、')}。`;
                        } else {
                            successMessage += `\n未找到其他可同步的配置。`;
                        }
                        alert(successMessage);
                        
                    } catch (err) {
                        console.error('导入失败:', err);
                        alert('导入失败: ' + err.message + '\n\n请检查文件格式是否正确。');
                    }
                };
                
                reader.onerror = function() {
                    alert('文件读取失败，请重试');
                };
                
                reader.readAsText(file);
            });

            // ==================== 修改：点播源添加自定义字段 - 使用增强函数 ====================
            addVodCustomFieldBtn.addEventListener('click', function() {
                const fieldId = 'vod-custom-field-' + Date.now();
                createVodCustomFieldElement(fieldId);
            });

            // ==================== 修改：直播源添加自定义字段 - 使用增强函数 ====================
            addLiveCustomFieldBtn.addEventListener('click', function() {
                const fieldId = 'live-custom-field-' + Date.now();
                createLiveCustomFieldElement(fieldId);
            });

            // ==================== 修改：解析地址添加自定义字段 - 使用增强函数 ====================
            addParseCustomFieldBtn.addEventListener('click', function() {
                const fieldId = 'parse-custom-field-' + Date.now();
                createParseCustomFieldElement(fieldId);
            });

            // 标签页切换
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.config-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(`${tab}-config`).classList.add('active');
                });
            });

            // 加解密工具初始化
            function initCrypto() {
                // 初始化IV为当前时间戳
                cryptoIvInput.value = new Date().getTime();
                
                // 处理按钮事件
                cryptoProcessBtn.addEventListener('click', processCryptoData);
                
                // 复制按钮事件
                cryptoCopyBtn.addEventListener('click', copyCryptoResult);
                
                // 清除按钮事件
                cryptoClearBtn.addEventListener('click', clearCryptoFields);
                
                // 上传文件按钮事件
                cryptoUploadBtn.addEventListener('click', function() {
                    cryptoFileInput.click();
                });
                
                // 文件选择事件
                cryptoFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        cryptoInput.value = e.target.result;
                    };
                    reader.readAsText(file);
                });
                
                function clearCryptoFields() {
                    cryptoInput.value = '';
                    cryptoOutput.value = '';
                }
                
                function padTo16Byte(str) {
                    return CryptoJS.enc.Utf8.parse(str.toString().padEnd(16, '0'));
                }
                
                function Encrypt(word, keyStr, ivStr) {
                    const key = padTo16Byte(keyStr);
                    const iv = padTo16Byte(ivStr);
                    const encrypted = CryptoJS.AES.encrypt(word, key, { iv });
                    return encrypted.ciphertext.toString(CryptoJS.enc.Hex);
                }
                
                function Decrypt(word, keyStr, ivStr) {
                    const key = padTo16Byte(keyStr);
                    const iv = padTo16Byte(ivStr);
                    const ciphertext = CryptoJS.enc.Hex.parse(word);
                    const decrypt = CryptoJS.AES.decrypt({ ciphertext }, key, { iv });
                    return decrypt.toString(CryptoJS.enc.Utf8);
                }
                
                function decryptAesBCB(encryptedData) {
                    var dataArr = encryptedData.split("");
                    var prefixCode = CryptoJS.enc.Utf8.parse("$#").toString();
                    var suffixCode = CryptoJS.enc.Utf8.parse("#$").toString();
                    var pwdMix = dataArr
                      .splice(0, encryptedData.indexOf(suffixCode) + 4)
                      .join("");
                    var roundtimeInHax = dataArr.splice(dataArr.length - 26, 26).join("");
                    var encryptedText = dataArr.join("");
                    var pwdInHax = pwdMix.substring(
                      prefixCode.length,
                      pwdMix.length - suffixCode.length
                    );
                    var roundTime = CryptoJS.enc.Utf8.stringify(
                      CryptoJS.enc.Hex.parse(roundtimeInHax)
                    );
                    var pwd = CryptoJS.enc.Utf8.stringify(CryptoJS.enc.Hex.parse(pwdInHax));
                    var iv = CryptoJS.enc.Utf8.parse(roundTime.padEnd(16, "0"));
                    var pkBlocks = CryptoJS.enc.Utf8.parse(pwd.padEnd(16, "0"));
                    var cipherParams = CryptoJS.lib.CipherParams.create({
                      ciphertext: CryptoJS.enc.Hex.parse(encryptedText),
                    });
                    var decryptedData = CryptoJS.enc.Utf8.stringify(
                      CryptoJS.AES.decrypt(cipherParams, pkBlocks, {
                        iv: iv,
                        mode: CryptoJS.mode.CBC,
                        padding: CryptoJS.pad.Pkcs7,
                      })
                    );
                    return decryptedData;
                }
                
                function convertToHex(value) {
                    return CryptoJS.enc.Hex.stringify(CryptoJS.enc.Utf8.parse(value));
                }
                
                function processCryptoData() {
                    const inputText = cryptoInput.value.trim();
                    const operation = cryptoOperationSelect.value;
                    const key = cryptoKeyInput.value;
                    const iv = cryptoIvInput.value;
                    
                    if (!inputText) {
                        alert('请输入要处理的文本');
                        return;
                    }
                    
                    try {
                        let result;
                        
                        if (operation === 'encrypt') {
                            const resultData = Encrypt(inputText, key, iv);
                            const keyHex = convertToHex(`$#${key}#$`);
                            const ivHex = convertToHex(iv);
                            result = `${keyHex}${resultData}${ivHex}`;
                        } else {
                            let encryptedData = inputText;
                            result = decryptAesBCB(encryptedData);
                        }
                        
                        cryptoOutput.value = result;
                    } catch (err) {
                        console.error(err);
                        alert('处理失败: ' + err.message);
                    }
                }
                
                function copyCryptoResult() {
                    cryptoOutput.select();
                    document.execCommand('copy');
                    alert('已复制到剪贴板');
                }
            }

            // 初始化加解密工具
            initCrypto();

            // 添加点播源
            addVodBtn.addEventListener('click', function() {
                const key = document.getElementById('vod-key').value.trim();
                const name = document.getElementById('vod-name').value.trim();
                const api = document.getElementById('vod-api').value.trim();
                const jar = vodJarInput.value.trim();
                const ext = vodExtInput.value.trim();
                
                if (!key || !name || !api) {
                    alert('请填写完整的点播源信息!');
                    return;
                }
                
                const newSite = {
                    key: key,
                    name: name,
                    type: parseInt(document.getElementById('vod-type').value),
                    api: api
                };
                
                // 只有当searchable不是-1时才添加到配置中
                const searchableValue = parseInt(document.getElementById('vod-searchable').value);
                if (searchableValue !== -1) {
                    newSite.searchable = searchableValue;
                }
                
                // 只有当quickSearch不是-1时才添加到配置中
                const quickSearchValue = parseInt(document.getElementById('vod-quickSearch').value);
                if (quickSearchValue !== -1) {
                    newSite.quickSearch = quickSearchValue;
                }
                
                // 只有当filterable不是-1时才添加到配置中
                const filterableValue = parseInt(document.getElementById('vod-filterable').value);
                if (filterableValue !== -1) {
                    newSite.filterable = filterableValue;
                }
                
                if (jar) {
                    newSite.jar = jar;
                }
                
                // 使用增强的ext字段处理函数
                if (ext) {
                    newSite.ext = handleExtField(ext);
                }
                
                // 添加自定义字段到配置 - 使用增强的智能类型检测
                Object.values(vodCustomFields).forEach(field => {
                    if (field.name && field.value) {
                        newSite[field.name] = field.processedValue !== undefined ? field.processedValue : field.value;
                    }
                });
                
                // 只有当用户添加了分类时才保存到配置中，否则不保存categories字段
                if (config.categories && config.categories.length > 0) {
                    newSite.categories = [...config.categories];
                }
                
                config.sites.push(newSite);
                updateConfigJson();
                loadVodItems();
                updateVodNavigation(); // 新增：更新导航栏
                
                // 添加点播源后，清空表单字段和分类配置，并恢复Type、可搜索、可快速搜索、可筛选到默认状态
                clearVodForm();
                config.categories = []; // 清空分类配置
                loadCategories(); // 更新分类显示
                
                // 恢复分类选择框默认值为"电影片"
                categorySelect.value = "电影片";
                customCategoryInput.value = "";
            });

            // 更新点播源
            updateVodBtn.addEventListener('click', function() {
                if (editingIndex === -1) return;
                
                const key = document.getElementById('vod-key').value.trim();
                const name = document.getElementById('vod-name').value.trim();
                const api = document.getElementById('vod-api').value.trim();
                const jar = vodJarInput.value.trim();
                const ext = vodExtInput.value.trim();
                
                if (!key || !name || !api) {
                    alert('请填写完整的点播源信息!');
                    return;
                }
                
                const updatedSite = {
                    key: key,
                    name: name,
                    type: parseInt(document.getElementById('vod-type').value),
                    api: api
                };
                
                // 只有当searchable不是-1时才添加到配置中
                const searchableValue = parseInt(document.getElementById('vod-searchable').value);
                if (searchableValue !== -1) {
                    updatedSite.searchable = searchableValue;
                } else {
                    // 如果原来是有的，现在选择不显示，则删除该字段
                    delete updatedSite.searchable;
                }
                
                // 只有当quickSearch不是-1时才添加到配置中
                const quickSearchValue = parseInt(document.getElementById('vod-quickSearch').value);
                if (quickSearchValue !== -1) {
                    updatedSite.quickSearch = quickSearchValue;
                } else {
                    // 如果原来是有的，现在选择不显示，则删除该字段
                    delete updatedSite.quickSearch;
                }
                
                // 只有当filterable不是-1时才添加到配置中
                const filterableValue = parseInt(document.getElementById('vod-filterable').value);
                if (filterableValue !== -1) {
                    updatedSite.filterable = filterableValue;
                } else {
                    // 如果原来是有的，现在选择不显示，则删除该字段
                    delete updatedSite.filterable;
                }
                
                if (jar) {
                    updatedSite.jar = jar;
                }
                
                // 使用增强的ext字段处理函数
                if (ext) {
                    updatedSite.ext = handleExtField(ext);
                }
                
                // 添加自定义字段到配置 - 使用增强的智能类型检测
                Object.values(vodCustomFields).forEach(field => {
                    if (field.name && field.value) {
                        updatedSite[field.name] = field.processedValue !== undefined ? field.processedValue : field.value;
                    }
                });
                
                // 只有当用户添加了分类时才保存到配置中，否则不保存categories字段
                if (config.categories && config.categories.length > 0) {
                    updatedSite.categories = [...config.categories];
                }
                
                config.sites[editingIndex] = updatedSite;
                updateConfigJson();
                loadVodItems();
                updateVodNavigation(); // 新增：更新导航栏
                
                // 修改：更新点播源后，恢复分类配置为默认值
                cancelEdit();
            });

            // 取消编辑
            cancelEditBtn.addEventListener('click', function() {
                cancelEdit();
            });

            function cancelEdit() {
                editingIndex = -1;
                addVodBtn.style.display = 'inline-block';
                updateVodBtn.style.display = 'none';
                cancelEditBtn.style.display = 'none';
                clearVodForm();
                // 修改：清空分类配置，恢复到默认设置
                config.categories = [];
                loadCategories();
                // 恢复分类选择框默认值为"电影片"
                categorySelect.value = "电影片";
                customCategoryInput.value = "";
                // 取消导航按钮高亮
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }

            function clearVodForm() {
                document.getElementById('vod-key').value = '';
                document.getElementById('vod-name').value = '';
                document.getElementById('vod-api').value = '';
                vodJarInput.value = '';
                vodExtInput.value = '';
                // 恢复Type、可搜索、可快速搜索、可筛选到默认状态
                document.getElementById('vod-type').value = '1';
                document.getElementById('vod-searchable').value = '1';
                document.getElementById('vod-quickSearch').value = '1';
                document.getElementById('vod-filterable').value = '1';
                vodCustomFieldsContainer.innerHTML = '';
                vodCustomFields = {};
            }

            // 添加Urls按钮 - 修改：改为添加Url
            addUrlBtn.addEventListener('click', function() {
                const urlItem = document.createElement('div');
                urlItem.className = 'url-item';
                urlItem.innerHTML = `
                    <input type="text" class="live-url" placeholder="直播源Url">
                    <button class="remove-url button-cancel">删除</button>
                `;
                liveUrlsList.appendChild(urlItem);
                
                urlItem.querySelector('.remove-url').addEventListener('click', function() {
                    urlItem.remove();
                });
            });

            // 添加直播频道 - 修改：去掉组名，改为新的数据结构
            addLiveChannelBtn.addEventListener('click', function() {
                const name = liveChannelNameInput.value.trim();
                const type = parseInt(liveTypeSelect.value);
                const urlInputs = document.querySelectorAll('.live-url');
                const url = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url).join(''); // 修改：改为单个url字符串
                
                if (!name || !url) {
                    alert('请填写完整的直播频道信息!');
                    return;
                }
                
                const newLive = {
                    name: name,
                    type: type,
                    url: url  // 修改：改为url字段
                };
                
                // 添加自定义字段到配置 - 使用增强的智能类型检测
                Object.values(liveCustomFields).forEach(field => {
                    if (field.name && field.value) {
                        newLive[field.name] = field.processedValue !== undefined ? field.processedValue : field.value;
                    }
                });
                
                config.lives.push(newLive);
                
                updateConfigJson();
                loadLiveChannels();
                
                clearLiveForm();
            });

            // 更新直播频道
            updateLiveChannelBtn.addEventListener('click', function() {
                if (editingLiveIndex === -1) return;
                
                const name = liveChannelNameInput.value.trim();
                const type = parseInt(liveTypeSelect.value);
                const urlInputs = document.querySelectorAll('.live-url');
                const url = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url).join(''); // 修改：改为单个url字符串
                
                if (!name || !url) {
                    alert('请填写完整的直播频道信息!');
                    return;
                }
                
                const updatedLive = {
                    name: name,
                    type: type,
                    url: url  // 修改：改为url字段
                };
                
                // 添加自定义字段到配置 - 使用增强的智能类型检测
                Object.values(liveCustomFields).forEach(field => {
                    if (field.name && field.value) {
                        updatedLive[field.name] = field.processedValue !== undefined ? field.processedValue : field.value;
                    }
                });
                
                config.lives[editingLiveIndex] = updatedLive;
                
                updateConfigJson();
                loadLiveChannels();
                
                cancelLiveEdit();
            });

            // 取消直播编辑
            cancelLiveEditBtn.addEventListener('click', function() {
                cancelLiveEdit();
            });

            function cancelLiveEdit() {
                editingLiveIndex = -1;
                addLiveChannelBtn.style.display = 'inline-block';
                updateLiveChannelBtn.style.display = 'none';
                cancelLiveEditBtn.style.display = 'none';
                clearLiveForm();
            }

            function clearLiveForm() {
                liveChannelNameInput.value = '';
                liveTypeSelect.value = '0';
                liveUrlsList.innerHTML = `
                    <div class="url-item">
                        <input type="text" class="live-url" placeholder="直播源Url">
                        <button class="remove-url button-cancel">删除</button>
                    </div>
                `;
                liveCustomFieldsContainer.innerHTML = '';
                liveCustomFields = {};
                
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
            }

            // 添加解析地址
            addParseBtn.addEventListener('click', function() {
                const name = document.getElementById('parse-name').value.trim();
                const type = parseInt(document.getElementById('parse-type').value);
                const url = parseUrlInput.value.trim();
                const ext = parseExtInput.value.trim();
                
                if (!name || !url) {
                    alert('请填写完整的解析地址信息!');
                    return;
                }
                
                const newParse = {
                    name: name,
                    type: type,
                    url: url
                };
                
                if (ext) {
                    newParse.ext = ext;
                }
                
                // 添加自定义字段到配置 - 使用增强的智能类型检测
                Object.values(parseCustomFields).forEach(field => {
                    if (field.name && field.value) {
                        newParse[field.name] = field.processedValue !== undefined ? field.processedValue : field.value;
                    }
                });
                
                config.parses.push(newParse);
                
                updateConfigJson();
                loadParses();
                
                clearParseForm();
            });

            // 更新解析地址
            updateParseBtn.addEventListener('click', function() {
                if (editingParseIndex === -1) return;
                
                const name = document.getElementById('parse-name').value.trim();
                const type = parseInt(document.getElementById('parse-type').value);
                const url = parseUrlInput.value.trim();
                const ext = parseExtInput.value.trim();
                
                if (!name || !url) {
                    alert('请填写完整的解析地址信息!');
                    return;
                }
                
                const updatedParse = {
                    name: name,
                    type: type,
                    url: url
                };
                
                if (ext) {
                    updatedParse.ext = ext;
                }
                
                // 添加自定义字段到配置 - 使用增强的智能类型检测
                Object.values(parseCustomFields).forEach(field => {
                    if (field.name && field.value) {
                        updatedParse[field.name] = field.processedValue !== undefined ? field.processedValue : field.value;
                    }
                });
                
                config.parses[editingParseIndex] = updatedParse;
                
                updateConfigJson();
                loadParses();
                
                cancelParseEdit();
            });

            // 取消解析编辑
            cancelParseEditBtn.addEventListener('click', function() {
                cancelParseEdit();
            });

            function cancelParseEdit() {
                editingParseIndex = -1;
                addParseBtn.style.display = 'inline-block';
                updateParseBtn.style.display = 'none';
                cancelParseEditBtn.style.display = 'none';
                clearParseForm();
            }

            function clearParseForm() {
                document.getElementById('parse-name').value = '';
                document.getElementById('parse-type').value = '0';
                parseUrlInput.value = '';
                parseExtInput.value = '';
                parseCustomFieldsContainer.innerHTML = '';
                parseCustomFields = {};
            }

            // 添加分类
            addCategoryBtn.addEventListener('click', function() {
                let category = customCategoryInput.value.trim();
                if (!category) {
                    // 如果没有自定义分类，使用下拉框中的分类
                    category = categorySelect.value;
                }
                
                if (!category) {
                    alert('请选择或输入分类名称');
                    return;
                }
                
                if (!config.categories) {
                    config.categories = [];
                }
                
                if (!config.categories.includes(category)) {
                    config.categories.push(category);
                    updateConfigJson();
                    loadCategories();
                    
                    // 清空自定义分类输入框
                    customCategoryInput.value = '';
                }
            });

            // 添加IJK解码选项
            addIjkOptionBtn.addEventListener('click', function() {
                const group = ijkGroupSelect.value;
                const category = ijkCategorySelect.value;
                const name = ijkNameInput.value.trim();
                const value = ijkValueInput.value.trim();
                
                if (!name || !value) {
                    alert('请填写完整的解码选项信息!');
                    return;
                }
                
                // 找到对应的解码组
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (!ijkGroup) {
                    alert('找不到对应的解码组!');
                    return;
                }
                
                // 添加新选项
                ijkGroup.options.push({
                    category: parseInt(category),
                    name: name,
                    value: value
                });
                
                // 更新文本区域显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 清空输入框
                clearIjkForm();
                
                // 自动更新配置
                updateConfigJson();
            });

            // 更新IJK解码选项
            updateIjkOptionBtn.addEventListener('click', function() {
                if (editingIjkOptionIndex === -1) return;
                
                const group = ijkGroupSelect.value;
                const category = ijkCategorySelect.value;
                const name = ijkNameInput.value.trim();
                const value = ijkValueInput.value.trim();
                
                if (!name || !value) {
                    alert('请填写完整的解码选项信息!');
                    return;
                }
                
                // 找到对应的解码组
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (!ijkGroup) {
                    alert('找不到对应的解码组!');
                    return;
                }
                
                // 更新选项
                ijkGroup.options[editingIjkOptionIndex] = {
                    category: parseInt(category),
                    name: name,
                    value: value
                };
                
                // 更新文本区域显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 取消编辑状态
                cancelIjkEdit();
                
                // 自动更新配置
                updateConfigJson();
            });

            // 取消IJK编辑
            cancelIjkEditBtn.addEventListener('click', function() {
                cancelIjkEdit();
            });

            function cancelIjkEdit() {
                editingIjkOptionIndex = -1;
                addIjkOptionBtn.style.display = 'inline-block';
                updateIjkOptionBtn.style.display = 'none';
                cancelIjkEditBtn.style.display = 'none';
                clearIjkForm();
            }

            function clearIjkForm() {
                ijkCategorySelect.value = '4';
                ijkNameInput.value = '';
                ijkValueInput.value = '';
            }

            // 更新IJK选项文本区域
            function updateIjkOptionsTextarea() {
                const group = ijkGroupSelect.value;
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (ijkGroup) {
                    ijkOptionsTextarea.value = 
                        ijkGroup.options.map(opt => `${opt.category}|${opt.name}|${opt.value}`).join('\n');
                }
            }

            // 加载IJK选项列表
            function loadIjkOptions() {
                ijkOptionsList.innerHTML = '';
                
                const group = ijkGroupSelect.value;
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (!ijkGroup || ijkGroup.options.length === 0) {
                    return;
                }
                
                ijkGroup.options.forEach((option, index) => {
                    const item = document.createElement('div');
                    item.className = 'ijk-option-item';
                    item.innerHTML = `
                        <select disabled>
                            <option value="1" ${option.category === 1 ? 'selected' : ''}>1-OPT_CATEGORY_FORMAT</option>
                            <option value="2" ${option.category === 2 ? 'selected' : ''}>2-OPT_CATEGORY_CODEC</option>
                            <option value="3" ${option.category === 3 ? 'selected' : ''}>3-OPT_CATEGORY_SWS</option>
                            <option value="4" ${option.category === 4 ? 'selected' : ''}>4-OPT_CATEGORY_PLAYER</option>
                        </select>
                        <input type="text" value="${option.name}" disabled>
                        <input type="text" value="${option.value}" disabled>
                        <button class="button-edit edit-ijk-option" data-index="${index}">编辑</button>
                        <button class="button-cancel delete-ijk-option" data-index="${index}">删除</button>
                    `;
                    ijkOptionsList.appendChild(item);
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-ijk-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const group = ijkGroupSelect.value;
                        const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                        const option = ijkGroup.options[index];
                        
                        // 填充表单
                        ijkCategorySelect.value = option.category;
                        ijkNameInput.value = option.name;
                        ijkValueInput.value = option.value;
                        
                        // 切换按钮状态
                        editingIjkOptionIndex = index;
                        addIjkOptionBtn.style.display = 'none';
                        updateIjkOptionBtn.style.display = 'inline-block';
                        cancelIjkEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-ijk-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const group = ijkGroupSelect.value;
                        const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                        
                        ijkGroup.options.splice(index, 1);
                        
                        // 更新文本区域显示
                        updateIjkOptionsTextarea();
                        loadIjkOptions();
                        updateConfigJson();
                    });
                });
            }

            // IJK解码组切换
            ijkGroupSelect.addEventListener('change', function() {
                updateIjkOptionsTextarea();
                loadIjkOptions();
                clearIjkForm();
            });

            // 加载分类列表
            function loadCategories() {
                categoriesList.innerHTML = '';
                
                if (!config.categories || config.categories.length === 0) {
                    return;
                }
                
                config.categories.forEach((category, index) => {
                    const tag = document.createElement('div');
                    tag.className = 'category-tag';
                    tag.innerHTML = `
                        ${category}
                        <button data-index="${index}" class="delete-category">×</button>
                    `;
                    categoriesList.appendChild(tag);
                });
                
                document.querySelectorAll('.delete-category').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.categories.splice(index, 1);
                        updateConfigJson();
                        loadCategories();
                    });
                });
            }
            
            // ==================== 修改：位置控制按钮功能 ====================
            /**
             * 移动点播源到指定位置
             * @param {number} currentIndex - 当前索引
             * @param {number} newIndex - 新索引
             */
            function moveVodItem(currentIndex, newIndex) {
                if (currentIndex === newIndex || newIndex < 0 || newIndex >= config.sites.length) {
                    return;
                }
                
                const [movedItem] = config.sites.splice(currentIndex, 1);
                config.sites.splice(newIndex, 0, movedItem);
                
                updateConfigJson();
                loadVodItems();
                updateVodNavigation();
                updateVodSelectionButtons();
            }
            
            /**
             * 置顶点播源
             * @param {number} index - 要置顶的索引
             */
            function moveVodToTop(index) {
                if (index <= 0) return;
                moveVodItem(index, 0);
            }
            
            /**
             * 上移点播源
             * @param {number} index - 要上移的索引
             */
            function moveVodUp(index) {
                if (index <= 0) return;
                moveVodItem(index, index - 1);
            }
            
            /**
             * 下移点播源
             * @param {number} index - 要下移的索引
             */
            function moveVodDown(index) {
                if (index >= config.sites.length - 1) return;
                moveVodItem(index, index + 1);
            }

            // 加载点播源列表 - 修复：只有当searchable、quickSearch、filterable这三个字段存在且值不为-1时才显示
            function loadVodItems() {
                vodItems.innerHTML = '';
                
                if (config.sites.length === 0) {
                    return;
                }
                
                config.sites.forEach((site, index) => {
                    const item = document.createElement('div');
                    item.className = 'source-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    // 创建位置控制按钮容器
                    const positionControls = document.createElement('div');
                    positionControls.className = 'position-controls';
                    
                    // 创建置顶按钮
                    const topBtn = document.createElement('button');
                    topBtn.className = 'position-btn';
                    topBtn.textContent = '置顶';
                    topBtn.title = '移动到最前面';
                    topBtn.disabled = index === 0; // 如果是第一个，禁用置顶按钮
                    topBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        moveVodToTop(index);
                    });
                    
                    // 创建上升按钮
                    const upBtn = document.createElement('button');
                    upBtn.className = 'position-btn';
                    upBtn.textContent = '上升';
                    upBtn.title = '向上移动一位';
                    upBtn.disabled = index === 0; // 如果是第一个，禁用上升按钮
                    upBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        moveVodUp(index);
                    });
                    
                    // 创建下降按钮
                    const downBtn = document.createElement('button');
                    downBtn.className = 'position-btn';
                    downBtn.textContent = '下降';
                    downBtn.title = '向下移动一位';
                    downBtn.disabled = index === config.sites.length - 1; // 如果是最后一个，禁用下降按钮
                    downBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        moveVodDown(index);
                    });
                    
                    // 添加按钮到容器
                    positionControls.appendChild(topBtn);
                    positionControls.appendChild(upBtn);
                    positionControls.appendChild(downBtn);
                    
                    let categoriesHtml = '';
                    // 只有当站点有分类配置时才显示分类信息
                    if (site.categories && site.categories.length > 0) {
                        categoriesHtml = `<p>分类: ${site.categories.join(', ')}</p>`;
                    }
                    
                    let jarHtml = site.jar ? `<p>JAR: ${site.jar}</p>` : '';
                    
                    // 增强的ext字段显示
                    let extHtml = '';
                    if (site.ext) {
                        const extValue = site.ext;
                        // 如果是JSON字符串，尝试格式化为易读形式
                        if (typeof extValue === 'string' && 
                           ((extValue.startsWith('{') && extValue.endsWith('}')) || 
                            (extValue.startsWith('[') && extValue.endsWith(']')))) {
                            try {
                                const parsed = JSON.parse(extValue);
                                extHtml = `<p>Ext: ${JSON.stringify(parsed, null, 2)}</p>`;
                            } catch (e) {
                                extHtml = `<p>Ext: ${extValue}</p>`;
                            }
                        } else {
                            extHtml = `<p>Ext: ${extValue}</p>`;
                        }
                    }
                    
                    // 修改：只有当searchable、quickSearch、filterable这三个字段存在且值不为-1时才显示
                    let searchableHtml = '';
                    if (site.hasOwnProperty('searchable')) {
                        searchableHtml = `<p>可搜索: ${site.searchable}</p>`;
                    }
                    
                    let quickSearchHtml = '';
                    if (site.hasOwnProperty('quickSearch')) {
                        quickSearchHtml = `<p>可快速搜索: ${site.quickSearch}</p>`;
                    }
                    
                    let filterableHtml = '';
                    if (site.hasOwnProperty('filterable')) {
                        filterableHtml = `<p>可筛选: ${site.filterable}</p>`;
                    }
                    
                    // 添加自定义字段显示 - 增强类型显示
                    let customFieldsHtml = '';
                    const customFields = {};
                    for (const key in site) {
                        if (!['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'].includes(key)) {
                            customFields[key] = site[key];
                        }
                    }
                    
                    if (Object.keys(customFields).length > 0) {
                        customFieldsHtml = Object.entries(customFields).map(([name, value]) => {
                            // 根据值类型决定显示格式
                            if (typeof value === 'number' || typeof value === 'boolean' || value === null) {
                                return `<p>${name}: <span style="color: #e74c3c; font-weight: bold;">${value}</span></p>`;
                            } else if (typeof value === 'object') {
                                return `<p>${name}: ${JSON.stringify(value, null, 2)}</p>`;
                            } else {
                                return `<p>${name}: ${value}</p>`;
                            }
                        }).join('');
                    }
                    
                    item.innerHTML = `
                        <div style="flex: 1;">
                            <h4>${site.name} (${site.key})</h4>
                            <p>API: ${site.api}</p>
                            ${jarHtml}
                            <p>类型: ${getTypeName(site.type)}</p>
                            ${searchableHtml}
                            ${quickSearchHtml}
                            ${filterableHtml}
                            ${extHtml}
                            ${categoriesHtml}
                            ${customFieldsHtml}
                        </div>
                        <div class="source-item-actions">
                            <button data-index="${index}" class="button-edit edit-vod">编辑</button>
                            <button data-index="${index}" class="button-cancel delete-vod">删除</button>
                        </div>
                    `;
                    
                    // 添加位置控制按钮到项目
                    item.appendChild(positionControls);
                    
                    vodItems.appendChild(item);
                    
                    // 保留拖拽功能
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('dragleave', handleDragLeave);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragend', handleDragEnd);
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-vod').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const site = config.sites[index];
                        
                        // 填充表单
                        document.getElementById('vod-key').value = site.key;
                        document.getElementById('vod-name').value = site.name;
                        document.getElementById('vod-type').value = site.type;
                        document.getElementById('vod-api').value = site.api;
                        vodJarInput.value = site.jar || '';
                        
                        // 处理searchable字段：如果没有这个字段，选择"不显示"
                        if (site.searchable !== undefined) {
                            document.getElementById('vod-searchable').value = site.searchable;
                        } else {
                            document.getElementById('vod-searchable').value = '-1'; // 不显示
                        }
                        
                        // 处理quickSearch字段：如果没有这个字段，选择"不显示"
                        if (site.quickSearch !== undefined) {
                            document.getElementById('vod-quickSearch').value = site.quickSearch;
                        } else {
                            document.getElementById('vod-quickSearch').value = '-1'; // 不显示
                        }
                        
                        // 处理filterable字段：如果没有这个字段，选择"不显示"
                        if (site.filterable !== undefined) {
                            document.getElementById('vod-filterable').value = site.filterable;
                        } else {
                            document.getElementById('vod-filterable').value = '-1'; // 不显示
                        }
                        
                        // 使用增强的ext字段处理函数
                        setExtToInput(site.ext);
                        
                        // 更新分类
                        if (site.categories && site.categories.length > 0) {
                            config.categories = [...site.categories];
                            loadCategories();
                        } else {
                            config.categories = [];
                            loadCategories();
                        }
                        
                        // 恢复分类选择框默认值为"电影片" - 新增修改
                        categorySelect.value = "电影片";
                        customCategoryInput.value = "";
                        
                        // 更新自定义字段 - 使用增强函数
                        vodCustomFieldsContainer.innerHTML = '';
                        vodCustomFields = {};
                        
                        // 获取自定义字段 - 排除ext字段，支持嵌套对象
                        for (const key in site) {
                            if (!['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'].includes(key)) {
                                const fieldId = 'vod-custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                const fieldValue = site[key];
                                // 对于嵌套对象，序列化为JSON字符串
                                const displayValue = (typeof fieldValue === 'object' && fieldValue !== null) ? JSON.stringify(fieldValue, null, 2) : String(fieldValue);
                                createVodCustomFieldElement(fieldId, key, displayValue);
                            }
                        }
                        
                        // 切换按钮状态
                        editingIndex = index;
                        addVodBtn.style.display = 'none';
                        updateVodBtn.style.display = 'inline-block';
                        cancelEditBtn.style.display = 'inline-block';
                        
                        // 高亮对应的导航按钮
                        highlightNavButton(index);
                        
                        // 滚动到点播源配置区域
                        document.getElementById('vod-config').scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-vod').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.sites.splice(index, 1);
                        updateConfigJson();
                        loadVodItems();
                        updateVodNavigation(); // 更新导航栏
                        updateVodSelectionButtons(); // 更新选择区域
                    });
                });
            }
            
            // 加载直播频道列表 - 修改：改为新的数据结构
            function loadLiveChannels() {
                liveChannelsList.innerHTML = '';
                
                if (config.lives.length === 0) {
                    return;
                }
                
                config.lives.forEach((live, index) => {
                    const item = document.createElement('div');
                    item.className = 'channel-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    // 添加自定义字段显示 - 增强类型显示
                    let customFieldsHtml = '';
                    const customFields = {};
                    for (const key in live) {
                        if (!['name', 'type', 'url'].includes(key)) {
                            customFields[key] = live[key];
                        }
                    }
                    
                    if (Object.keys(customFields).length > 0) {
                        customFieldsHtml = Object.entries(customFields).map(([name, value]) => {
                            // 根据值类型决定显示格式
                            if (typeof value === 'number' || typeof value === 'boolean' || value === null) {
                                return `<p>${name}: <span style="color: #e74c3c; font-weight: bold;">${value}</span></p>`;
                            } else if (typeof value === 'object') {
                                return `<p>${name}: ${JSON.stringify(value, null, 2)}</p>`;
                            } else {
                                return `<p>${name}: ${value}</p>`;
                            }
                        }).join('');
                    }
                    
                    item.innerHTML = `
                        <div style="flex: 1;">
                            <p><strong>name:</strong> ${live.name}</p>
                            <p><strong>类型:</strong> ${getLiveTypeName(live.type)}</p>
                            <p><strong>URL:</strong> ${live.url}</p>
                            ${customFieldsHtml}
                        </div>
                        <div class="channel-item-actions">
                            <button data-index="${index}" class="button-edit edit-live-channel">编辑</button>
                            <button data-index="${index}" class="button-cancel delete-live-channel">删除</button>
                        </div>
                    `;
                    liveChannelsList.appendChild(item);
                    
                    item.addEventListener('dragstart', handleLiveDragStart);
                    item.addEventListener('dragover', handleLiveDragOver);
                    item.addEventListener('dragleave', handleLiveDragLeave);
                    item.addEventListener('drop', handleLiveDrop);
                    item.addEventListener('dragend', handleLiveDragEnd);
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-live-channel').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const live = config.lives[index];
                        
                        // 填充表单
                        liveChannelNameInput.value = live.name;
                        liveTypeSelect.value = live.type;
                        
                        // 清空并添加URL输入框
                        liveUrlsList.innerHTML = '';
                        const urlItem = document.createElement('div');
                        urlItem.className = 'url-item';
                        urlItem.innerHTML = `
                            <input type="text" class="live-url" placeholder="直播源Url" value="${live.url}">
                            <button class="remove-url button-cancel">删除</button>
                        `;
                        liveUrlsList.appendChild(urlItem);
                        
                        urlItem.querySelector('.remove-url').addEventListener('click', function() {
                            urlItem.remove();
                        });
                        
                        // 清空并重新添加自定义字段 - 使用增强函数
                        liveCustomFieldsContainer.innerHTML = '';
                        liveCustomFields = {};
                        
                        // 获取自定义字段，支持嵌套对象
                        for (const key in live) {
                            if (!['name', 'type', 'url'].includes(key)) {
                                const fieldId = 'live-custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                const fieldValue = live[key];
                                // 对于嵌套对象，序列化为JSON字符串
                                const displayValue = (typeof fieldValue === 'object' && fieldValue !== null) ? JSON.stringify(fieldValue, null, 2) : String(fieldValue);
                                createLiveCustomFieldElement(fieldId, key, displayValue);
                            }
                        }
                        
                        // 切换按钮状态
                        editingLiveIndex = index;
                        addLiveChannelBtn.style.display = 'none';
                        updateLiveChannelBtn.style.display = 'inline-block';
                        cancelLiveEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-live-channel').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.lives.splice(index, 1);
                        updateConfigJson();
                        loadLiveChannels();
                    });
                });
            }
            
            // 加载解析地址列表
            function loadParses() {
                parseList.innerHTML = '';
                
                if (config.parses.length === 0) {
                    return;
                }
                
                config.parses.forEach((parse, index) => {
                    const item = document.createElement('div');
                    item.className = 'parse-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    let extHtml = parse.ext ? `<p><strong>Ext:</strong> ${parse.ext}</p>` : '';
                    
                    // 添加自定义字段显示 - 增强类型显示
                    let customFieldsHtml = '';
                    const customFields = {};
                    for (const key in parse) {
                        if (!['name', 'type', 'url', 'ext'].includes(key)) {
                            customFields[key] = parse[key];
                        }
                    }
                    
                    if (Object.keys(customFields).length > 0) {
                        customFieldsHtml = Object.entries(customFields).map(([name, value]) => {
                            // 根据值类型决定显示格式
                            if (typeof value === 'number' || typeof value === 'boolean' || value === null) {
                                return `<p>${name}: <span style="color: #e74c3c; font-weight: bold;">${value}</span></p>`;
                            } else if (typeof value === 'object') {
                                return `<p>${name}: ${JSON.stringify(value, null, 2)}</p>`;
                            } else {
                                return `<p>${name}: ${value}</p>`;
                            }
                        }).join('');
                    }
                    
                    item.innerHTML = `
                        <div style="flex: 1;">
                            <p><strong>name:</strong> ${parse.name} (类型: ${getParseTypeName(parse.type)})</p>
                            <p><strong>URL:</strong> ${parse.url}</p>
                            ${extHtml}
                            ${customFieldsHtml}
                        </div>
                        <div class="parse-item-actions">
                            <button data-index="${index}" class="button-edit edit-parse">编辑</button>
                            <button data-index="${index}" class="button-cancel delete-parse">删除</button>
                        </div>
                    `;
                    parseList.appendChild(item);
                    
                    item.addEventListener('dragstart', handleParseDragStart);
                    item.addEventListener('dragover', handleParseDragOver);
                    item.addEventListener('dragleave', handleParseDragLeave);
                    item.addEventListener('drop', handleParseDrop);
                    item.addEventListener('dragend', handleParseDragEnd);
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-parse').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const parse = config.parses[index];
                        
                        // 填充表单
                        document.getElementById('parse-name').value = parse.name;
                        document.getElementById('parse-type').value = parse.type;
                        parseUrlInput.value = parse.url;
                        parseExtInput.value = parse.ext || '';
                        
                        // 清空并重新添加自定义字段 - 使用增强函数
                        parseCustomFieldsContainer.innerHTML = '';
                        parseCustomFields = {};
                        
                        // 获取自定义字段，支持嵌套对象
                        for (const key in parse) {
                            if (!['name', 'type', 'url', 'ext'].includes(key)) {
                                const fieldId = 'parse-custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                const fieldValue = parse[key];
                                // 对于嵌套对象，序列化为JSON字符串
                                const displayValue = (typeof fieldValue === 'object' && fieldValue !== null) ? JSON.stringify(fieldValue, null, 2) : String(fieldValue);
                                createParseCustomFieldElement(fieldId, key, displayValue);
                            }
                        }
                        
                        // 切换按钮状态
                        editingParseIndex = index;
                        addParseBtn.style.display = 'none';
                        updateParseBtn.style.display = 'inline-block';
                        cancelParseEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-parse').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.parses.splice(index, 1);
                        updateConfigJson();
                        loadParses();
                    });
                });
            }
            
            // 点播源拖动相关函数
            function handleDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    // 从原位置移除拖动的项目
                    const [movedItem] = config.sites.splice(dragStartIndex, 1);
                    
                    // 插入到新位置
                    config.sites.splice(dragEndIndex, 0, movedItem);
                    
                    loadVodItems();
                    updateConfigJson();
                    updateVodNavigation(); // 更新导航栏
                    updateVodSelectionButtons(); // 更新选择区域
                }
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            // 直播频道拖动相关函数
            function handleLiveDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleLiveDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleLiveDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleLiveDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    // 从原位置移除拖动的项目
                    const [movedItem] = config.lives.splice(dragStartIndex, 1);
                    
                    // 插入到新位置
                    config.lives.splice(dragEndIndex, 0, movedItem);
                    
                    loadLiveChannels();
                    updateConfigJson();
                }
            }
            
            function handleLiveDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            // 解析地址拖动相关函数
            function handleParseDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleParseDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleParseDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleParseDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    // 从原位置移除拖动的项目
                    const [movedItem] = config.parses.splice(dragStartIndex, 1);
                    
                    // 插入到新位置
                    config.parses.splice(dragEndIndex, 0, movedItem);
                    
                    loadParses();
                    updateConfigJson();
                }
            }
            
            function handleParseDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            function getTypeName(type) {
                const types = {
                    0: 'xml',
                    1: 'json',
                    2: '爬虫源',
                    3: '自定义爬虫',
                    4: '服务器爬虫'
                };
                return types[type] || '未知';
            }
            
            function getLiveTypeName(type) {
                const types = {
                    0: '普通',
                    1: 'json',
                    2: '多json',
                    3: 'm3u8',
                    4: 'rtmp',
                    5: 'flv',
                    6: '其他格式'
                };
                return types[type] || '未知';
            }
            
            function getParseTypeName(type) {
                const types = {
                    0: '普通',
                    1: 'json',
                    2: '多json',
                    3: '聚合'
                };
                return types[type] || '未知';
            }

            // 修复后的更新配置JSON显示函数 - 增强的ext字段处理和全局自定义字段，支持嵌套对象
            function updateConfigJson() {
                const globalSpider = globalSpiderInput.value.trim();
                if (globalSpider) {
                    config.spider = globalSpider;
                } else {
                    config.spider = "";
                }
                
                config.flags = vipFlagsInput.value.split(',').map(f => f.trim()).filter(f => f);
                
                // 更新IJK配置时不再处理文本区域，因为现在直接操作config对象
                
                config.ads = adDomainsTextarea.value.split('\n').map(d => d.trim()).filter(d => d);
                
                const wallpaper = wallpaperUrlInput.value.trim();
                if (wallpaper) {
                    config.wallpaper = wallpaper;
                } else {
                    config.wallpaper = "";
                }
                
                // 手动构建JSON字符串，增强ext字段处理，支持嵌套对象
                let jsonString = '{\n';
                
                // 添加spider字段
                jsonString += `  "spider": "${config.spider}",\n`;
                
                // 添加sites数组
                jsonString += '  "sites": [\n';
                config.sites.forEach((site, siteIndex) => {
                    jsonString += '    {\n';
                    jsonString += `      "key": "${escapeJsonString(site.key)}",\n`;
                    jsonString += `      "name": "${escapeJsonString(site.name)}",\n`;
                    jsonString += `      "type": ${site.type},\n`;
                    jsonString += `      "api": "${escapeJsonString(site.api)}"`;
                    
                    // 只有当searchable存在时才添加
                    if (site.searchable !== undefined) {
                        jsonString += `,\n      "searchable": ${site.searchable}`;
                    }
                    
                    // 只有当quickSearch存在时才添加
                    if (site.quickSearch !== undefined) {
                        jsonString += `,\n      "quickSearch": ${site.quickSearch}`;
                    }
                    
                    // 只有当filterable存在时才添加
                    if (site.filterable !== undefined) {
                        jsonString += `,\n      "filterable": ${site.filterable}`;
                    }
                    
                    // 添加jar字段（如果有）
                    if (site.jar) {
                        jsonString += `,\n      "jar": "${escapeJsonString(site.jar)}"`;
                    }
                    
                    // 增强的ext字段处理
                    if (site.ext) {
                        const processedExt = handleExtField(site.ext);
                        if (processedExt) {
                            // 检查是否是JSON对象或数组
                            const trimmedExt = processedExt.trim();
                            if ((trimmedExt.startsWith('{') && trimmedExt.endsWith('}')) || 
                                (trimmedExt.startsWith('[') && trimmedExt.endsWith(']'))) {
                                try {
                                    // 验证是否为有效JSON
                                    JSON.parse(trimmedExt);
                                    // 直接添加JSON，不加引号
                                    jsonString += `,\n      "ext": ${trimmedExt}`;
                                } catch (e) {
                                    // 无效JSON，作为字符串处理
                                    jsonString += `,\n      "ext": "${escapeJsonString(processedExt)}"`;
                                }
                            } 
                            // 检查是否是数字（整数或小数）
                            else if (!isNaN(trimmedExt) && trimmedExt !== '' && 
                                    trimmedExt !== 'true' && trimmedExt !== 'false') {
                                // 数字，不加引号
                                jsonString += `,\n      "ext": ${trimmedExt}`;
                            }
                            // 检查是否是布尔值
                            else if (trimmedExt.toLowerCase() === 'true' || trimmedExt.toLowerCase() === 'false') {
                                // 布尔值，不加引号
                                jsonString += `,\n      "ext": ${trimmedExt.toLowerCase()}`;
                            }
                            // 其他情况作为字符串处理
                            else {
                                jsonString += `,\n      "ext": "${escapeJsonString(processedExt)}"`;
                            }
                        }
                    }
                    
                    // 添加自定义字段 - 使用增强的智能类型检测
                    for (const key in site) {
                        if (!['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'].includes(key)) {
                            const value = site[key];
                            // 使用增强的智能类型检测来决定是否加引号
                            const typeInfo = detectValueType(typeof value === 'object' ? JSON.stringify(value) : String(value));
                            const jsonValue = valueToJsonOutput(typeInfo);
                            jsonString += `,\n      "${key}": ${jsonValue}`;
                        }
                    }
                    
                    // 只有当站点有分类配置时才添加categories字段（在每个点播源内部）
                    if (site.categories && site.categories.length > 0) {
                        jsonString += `,\n      "categories": [\n`;
                        jsonString += site.categories.map(cat => `        "${escapeJsonString(cat)}"`).join(',\n');
                        jsonString += '\n      ]';
                    }
                    
                    jsonString += '\n    }';
                    if (siteIndex < config.sites.length - 1) {
                        jsonString += ',';
                    }
                    jsonString += '\n';
                });
                jsonString += '  ],\n';
                
                // 添加直播源配置
                jsonString += '  "lives": [\n';
                config.lives.forEach((live, liveIndex) => {
                    jsonString += '    {\n';
                    jsonString += `      "name": "${escapeJsonString(live.name)}",\n`;
                    jsonString += `      "type": ${live.type},\n`;
                    jsonString += `      "url": "${escapeJsonString(live.url)}"`; // 修改：改为url字段，不加方括号
                    
                    // 添加自定义字段 - 使用增强的智能类型检测
                    for (const key in live) {
                        if (!['name', 'type', 'url'].includes(key)) {
                            const value = live[key];
                            // 使用增强的智能类型检测来决定是否加引号
                            const typeInfo = detectValueType(typeof value === 'object' ? JSON.stringify(value) : String(value));
                            const jsonValue = valueToJsonOutput(typeInfo);
                            jsonString += `,\n      "${key}": ${jsonValue}`;
                        }
                    }
                    
                    jsonString += '\n    }';
                    if (liveIndex < config.lives.length - 1) {
                        jsonString += ',';
                    }
                    jsonString += '\n';
                });
                jsonString += '  ],\n';
                
                // 添加解析地址配置
                jsonString += '  "parses": [\n';
                config.parses.forEach((parse, parseIndex) => {
                    jsonString += '    {\n';
                    jsonString += `      "name": "${escapeJsonString(parse.name)}",\n`;
                    jsonString += `      "type": ${parse.type},\n`;
                    jsonString += `      "url": "${escapeJsonString(parse.url)}"`;
                    
                    if (parse.ext) {
                        jsonString += `,\n      "ext": "${escapeJsonString(parse.ext)}"`;
                    }
                    
                    // 添加自定义字段 - 使用增强的智能类型检测
                    for (const key in parse) {
                        if (!['name', 'type', 'url', 'ext'].includes(key)) {
                            const value = parse[key];
                            // 使用增强的智能类型检测来决定是否加引号
                            const typeInfo = detectValueType(typeof value === 'object' ? JSON.stringify(value) : String(value));
                            const jsonValue = valueToJsonOutput(typeInfo);
                            jsonString += `,\n      "${key}": ${jsonValue}`;
                        }
                    }
                    
                    jsonString += '\n    }';
                    if (parseIndex < config.parses.length - 1) {
                        jsonString += ',';
                    }
                    jsonString += '\n';
                });
                jsonString += '  ],\n';
                
                jsonString += '  "flags": ' + JSON.stringify(config.flags, null, 2).replace(/\n/g, '\n  ') + ',\n';
                // 注意：移除了顶级categories字段，不再输出
                jsonString += '  "ijk": ' + JSON.stringify(config.ijk, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += '  "ads": ' + JSON.stringify(config.ads, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += `  "wallpaper": "${config.wallpaper}"`;
                
                // ==================== 新增：添加全局自定义字段 ====================
                // 在wallpaper后面添加全局自定义字段
                Object.values(globalCustomFields).forEach((field, index) => {
                    if (field.name && field.value) {
                        const typeInfo = detectValueType(field.value);
                        const jsonValue = valueToJsonOutput(typeInfo);
                        
                        // 如果是第一个全局字段，需要先添加逗号
                        if (index === 0) {
                            jsonString += ',\n';
                        } else {
                            jsonString += ',\n';
                        }
                        
                        jsonString += `  "${field.name}": ${jsonValue}`;
                    }
                });
                
                jsonString += '\n}';
                
                configJson.value = jsonString;
            }
            
            // 辅助函数：转义JSON字符串中的特殊字符
            function escapeJsonString(str) {
                if (typeof str !== 'string') return str;
                return str
                    .replace(/\\/g, '\\\\')   // 反斜杠
                    .replace(/"/g, '\\"')     // 双引号
                    .replace(/\n/g, '\\n')    // 换行符
                    .replace(/\r/g, '\\r')    // 回车符
                    .replace(/\t/g, '\\t');   // 制表符
            }
            
            // 复制到剪贴板
            copyBtn.addEventListener('click', async function() {
                if (!configJson.value) {
                    alert("错误：没有可复制的配置内容！");
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(configJson.value);
                    alert('✅ 配置已复制到剪贴板！');
                } catch (err) {
                    console.error("复制失败:", err);
                    configJson.select();
                    try {
                        const success = document.execCommand('copy');
                        alert(success ? '✅ 配置已复制（兼容模式）！' : '❌ 复制失败，请手动选择文本复制');
                    } catch (e) {
                        alert('❌ 复制失败，请手动选择文本复制');
                    }
                }
            });

            // 输入框实时更新配置
            globalSpiderInput.addEventListener('input', updateConfigJson);
            parseUrlInput.addEventListener('input', updateConfigJson);
            parseExtInput.addEventListener('input', updateConfigJson);
            wallpaperUrlInput.addEventListener('input', updateConfigJson);
            liveChannelNameInput.addEventListener('input', updateConfigJson);
            liveTypeSelect.addEventListener('change', updateConfigJson);
            vipFlagsInput.addEventListener('input', updateConfigJson);
            ijkGroupSelect.addEventListener('change', function() {
                updateIjkOptionsTextarea();
                loadIjkOptions();
                updateConfigJson();
            });
            adDomainsTextarea.addEventListener('input', updateConfigJson);
            vodJarInput.addEventListener('input', updateConfigJson);
            vodExtInput.addEventListener('input', updateConfigJson);

            // 初始化表单值
            function initFormValues() {
                if (config.spider) {
                    globalSpiderInput.value = config.spider;
                }
                
                // 设置VIP标识默认值
                vipFlagsInput.value = config.flags.join(',');
                
                // 初始化IJK配置显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 设置广告过滤默认值
                adDomainsTextarea.value = config.ads.join('\n');
                
                // 加载分类
                loadCategories();
                
                // 加载列表
                loadVodItems();
                loadLiveChannels();
                loadParses();
                
                // 初始化URL删除事件
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
                
                // 初始化点播源导航栏
                updateVodNavigation();
                
                // 初始化点播源选择区域
                initVodSelectionArea();
            }

            // 初始化页面
            initFormValues();
            updateConfigJson();
        });
    </script>
</body>
</html>